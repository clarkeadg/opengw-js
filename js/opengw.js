(()=>{"use strict";var e={178:(e,t)=>{t.Nu=void 0,t.Nu="",Math.PI}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var i=function(t,i){if("object"!==e(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,"string");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(i)?i:String(i)}function s(e,i,s){return(i=t(i))in e?Object.defineProperty(e,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[i]=s,e}var r,n,a,o,m,l,d,u,h=1,c={x:0,y:0,z:0},f={r:0,g:0,b:0,a:1},y=[],v=[],p=[],g=60..toFixed(2),S=(271/8).toFixed(2),P=function(e){r=window.gl,0===e&&r.disable(r.DEPTH_TEST),1===e&&r.disable(r.BLEND)},M=function(e){window.webgl.lineWidth=e},w=function(e){window.webgl.pointSize=e},x=function(e,t,i,s){f.r=e,f.g=t,f.b=i,f.a=s},E=function(e){(r=window.gl).type=e,r.bindBuffer(r.ARRAY_BUFFER,null),y.length=0,v.length=0,p.length=0},L=function(e,t,i){v.push(e),v.push(t),v.push(i),y.push(f.r),y.push(f.g),y.push(f.b),y.push(f.a),p.push(4)},T=function(e,t,i){L(e,t,i)},k=function(){p.length&&(r=window.gl,h=window.webgl.pointSize,n=window.webgl.vertex_buffer,a=window.webgl.color_buffer,m=window.webgl.vertexCoordinates,o=window.webgl.vertexColor,l=window.webgl.vertexPointSize,d=window.webgl.cameraPosition,r.bindBuffer(r.ARRAY_BUFFER,n),r.vertexAttribPointer(m,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(m),r.bufferData(r.ARRAY_BUFFER,new Float32Array(v),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,a),r.vertexAttribPointer(o,4,r.FLOAT,!1,0,0),r.enableVertexAttribArray(o),r.bufferData(r.ARRAY_BUFFER,new Float32Array(y),r.STATIC_DRAW),r.uniform1f(l,h),r.uniform3f(d,c.x,c.y,c.z),0===r.type&&r.drawArrays(r.POINTS,0,p.length),1!==r.type&&2!==r.type||r.drawArrays(r.LINES,0,p.length),3===r.type&&r.drawArrays(r.LINE_LOOP,0,p.length),4===r.type&&r.drawArrays(r.TRIANGLE_STRIP,0,p.length))},b=i(178),_={},G={},R={},I="undefined"==typeof arguments?void 0:arguments,A=function(e){if(I&&I.length>1)return console.log(I[0],I[1]);console.log(e)},V=null,B={video_resolution:null,fullscreen:null,smooth_graphics:null,show_fps:null,language:null},N=function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null},C=0,D=0,W=0,O=function(){return D},Y=function(){var e=X();return e<W&&(W=e),e-W},X=function(){return Math.floor(Date.now())},H=function(e,t){return{x:e=e||0,y:t=t||0}},F=function(){return H(1,1)};function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j(e,i){for(var s=0;s<i.length;s++){var r=i[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,t(r.key),r)}}function q(e,t,i){return t&&j(e.prototype,t),i&&j(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var Z,$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var i=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=i(this._onTouchStart,this),this._$onTouchEnd=i(this._onTouchEnd,this),this._$onTouchMove=i(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=i(this._onMouseDown,this),this._$onMouseUp=i(this._onMouseUp,this),this._$onMouseMove=i(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}return q(e,[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var i=F();e*=i.x,t*=i.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var i=F();e*=i.x,t*=i.y,!0===this._pressed&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,i=e.clientY;return this._onDown(t,i)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,i=e.clientY;return this._onMove(t,i)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",e)){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var i=t.pageX,s=t.pageY;return this._onDown(i,s)}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length){var s=t[i];e.preventDefault();var r=s.pageX,n=s.pageY;return this._onMove(r,n)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}],[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}]),e}();(Z=$.prototype).addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},Z.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},Z.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),i=0;i<t.length;i++){var s=t[i].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==s)return s}};var K,J,Q,ee,te,ie,se,re,ne,ae=null,oe=!1,me={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda",87:"w",83:"s",68:"d",65:"a"},le=!1,de=function(e,t){return!!t&&!!e.enabled&&e.state[parseInt(t,10)]},ue=function(e){var t=Object.create(null);function i(i){if(e.hasOwnProperty(i.keyCode)){var s="keydown"==i.type;t[e[i.keyCode]]=s,i.preventDefault()}}return addEventListener("keydown",i),addEventListener("keyup",i),t},he="data/languages/english.json",ce=function(e){return new Promise((function(t,i){var s;A('lang_loadfile("%s")...'),(s=e,s=b.Nu+s,new Promise((function(e,t){if(R[s])e(R[s]);else{var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",s,!0),i.onreadystatechange=function(){if(4===i.readyState){var t={};try{t=JSON.parse(i.responseText)}catch(e){console.log("error parsing json",s)}R[s]=t,e(t)}},i.send(null)}}))).then((function(e){t(e)}))}))},fe=[],ye=0,ve=function(){return fe[ye-1]},pe=3.14159,ge=6.28318,Se=99999,Pe=function(){function e(t,i,s){U(this,e),this.x=t||0,this.y=i||0,this.z=s||0}return q(e,[{key:"copy",value:function(){return new e(this.x,this.y,this.z)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"multiply",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}}]),e}(),Me=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},we=(Math.tan(.8726638888888889),Math.tan(.6981311111111111),function(e,t){return Number((e-Math.floor(e/t)*t).toPrecision(8))}),xe=function(e,t){var i=e.x,s=e.y,r=i-t.x,n=s-t.y;return Math.sqrt(n*n+r*r)},Ee=function(e,t){var i=0,s=e.x,r=e.y,n=t.x-s,a=t.y-r;return(i=0==n?0==a?0:a>0?1.570795:3*pe/2:0==a?n>0?0:pe:n<0?Math.atan(a/n)+pe:a<0?Math.atan(a/n)+6.28318:Math.atan(a/n))>=ge&&(i-=ge),i},Le=function(e,t){var i=e.x,s=e.y;return new Pe(i*Math.cos(t)-s*Math.sin(t),i*Math.sin(t)+s*Math.cos(t))},Te=function(e,t){var i=t-e;return parseInt(ke()*(i+1)+e,10)},ke=function(){return Math.random()},be=function(e,t,i,s){for(var r=!1,n=t[0].copy().multiply(s),a=1;a<i;a++){var o=t[a].copy().multiply(s);0==o.z?((n.y<e.y&&o.y>=e.y||o.y<e.y&&n.y>=e.y)&&(n.x<=e.x||o.x<=e.x)&&(r^=n.x+(e.y-n.y)/(o.y-n.y)*(o.x-n.x)<e.x),n=o):n=t[++a].copy().multiply(s)}return r},_e=function(e,t,i){var s=t.copy().subtract(e),r=xe(new Pe(0,0,0),s),n=i.copy().subtract(e),a=Me(s,n)/(r*r);if(a<0)return Math.abs(xe(e,i));if(a>1)return Math.abs(xe(t,i));var o=e.copy().add(new Pe(s.x*a,s.y*a,0));return Math.abs(xe(o,i))},Ge=function(e){return.0174532925*e},Re=function(e,t){var i=e,s=xe(new Pe(0,0,0),i);if(s>t){var r=t/s;i.x*=r,i.y*=r}return i},Ie=function(e,t){var i=(e=we(e,Ge(360)))-(t=we(t,Ge(360)));return i>=Ge(180)?i-=Ge(360):i<=-Ge(180)&&(i+=Ge(360)),i},Ae=function(e,t,i){var s=t.copy().subtract(e),r=xe(new Pe(0,0,0),s),n=i.copy().subtract(e),a=Me(s,n)/(r*r);return a<0?e:a>1?t:e.copy().add(new Pe(s.x*a,s.y*a,0))},Ve=q((function e(){U(this,e),this.pos=new Pe(0,0,0),this.strength=0,this.zStrength=0,this.radius=0,this.enabled=!1,this.attractsParticles=!1})),Be=function(){function e(){U(this,e);var t=this;t.mNumAttractors=200,t.mAttractors=[];for(var i=0;i<t.mNumAttractors;i++)t.mAttractors.push(new Ve);t.clearAll()}return q(e,[{key:"getAttractor",value:function(){for(var e=this,t=0;t<e.mNumAttractors;t++)if(!e.mAttractors[t].enabled)return e.mAttractors[t];return null}},{key:"clearAll",value:function(){for(var e=0;e<this.mNumAttractors;e++)this.mAttractors[e].enabled=!1}},{key:"evaluateParticle",value:function(e){for(var t=new Pe(0,0,0),i=0;i<this.mNumAttractors;i++){var s=this.mAttractors[i];if(s.enabled&&s.attractsParticles){var r=new Pe(s.pos.x,s.pos.y,s.pos.z),n=Ee(e.posStream[0],r),a=xe(e.posStream[0],r),o=s.strength;a<s.radius&&(a=s.radius);var m=new Pe(-1/(a*a)*o*.5,0,0),l=Le(m,n+.35);t.x+=l.x,t.y+=l.y}}return t}}]),e}(),Ne=q((function e(t,i,s,r,n){U(this,e),this.r=t||1,this.g=i||1,this.b=s||1,this.a=r||1,this.radius=n||1})),Ce=function(){function e(t){U(this,e),this._matrix=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],t?this.Copy(t):this.Identity()}return q(e,[{key:"Copy",value:function(e){this._matrix[0][0]=e._matrix[0][0],this._matrix[0][1]=e._matrix[0][1],this._matrix[0][2]=e._matrix[0][2],this._matrix[0][3]=e._matrix[0][3],this._matrix[1][0]=e._matrix[1][0],this._matrix[1][1]=e._matrix[1][1],this._matrix[1][2]=e._matrix[1][2],this._matrix[1][3]=e._matrix[1][3],this._matrix[2][0]=e._matrix[2][0],this._matrix[2][1]=e._matrix[2][1],this._matrix[2][2]=e._matrix[2][2],this._matrix[2][3]=e._matrix[2][3],this._matrix[3][0]=e._matrix[3][0],this._matrix[3][1]=e._matrix[3][1],this._matrix[3][2]=e._matrix[3][2],this._matrix[3][3]=e._matrix[3][3]}},{key:"Identity",value:function(){this._matrix[0][0]=1,this._matrix[0][1]=0,this._matrix[0][2]=0,this._matrix[0][3]=0,this._matrix[1][0]=0,this._matrix[1][1]=1,this._matrix[1][2]=0,this._matrix[1][3]=0,this._matrix[2][0]=0,this._matrix[2][1]=0,this._matrix[2][2]=1,this._matrix[2][3]=0,this._matrix[3][0]=0,this._matrix[3][1]=0,this._matrix[3][2]=0,this._matrix[3][3]=1}},{key:"Multiply",value:function(e){var t,i,s=[[this._matrix[0][0],this._matrix[0][1],this._matrix[0][2],this._matrix[0][3]],[this._matrix[1][0],this._matrix[1][1],this._matrix[1][2],this._matrix[1][3]],[this._matrix[2][0],this._matrix[2][1],this._matrix[2][2],this._matrix[2][3]],[this._matrix[3][0],this._matrix[3][1],this._matrix[3][2],this._matrix[3][3]]];for(t=0;t<4;t++)for(i=0;i<4;i++)this._matrix[t][i]=s[t][0]*e._matrix[0][i]+s[t][1]*e._matrix[1][i]+s[t][2]*e._matrix[2][i]+s[t][3]*e._matrix[3][i]}},{key:"Scale",value:function(e,t,i){this._matrix[0][0]*=e,this._matrix[1][1]*=t,this._matrix[2][2]*=i}},{key:"Translate",value:function(e,t,i){this._matrix[3][0]+=e,this._matrix[3][1]+=t,this._matrix[3][2]+=i}},{key:"Rotate",value:function(t,i,s){var r=new e,n=new e,a=new e;r._matrix[1][1]=Math.cos(t),r._matrix[1][2]=Math.sin(t),r._matrix[2][0]=0,r._matrix[2][1]=-Math.sin(t),r._matrix[2][2]=Math.cos(t),n._matrix[0][0]=Math.cos(i),n._matrix[0][2]=-Math.sin(i),n._matrix[2][0]=Math.sin(i),n._matrix[2][2]=Math.cos(i),a._matrix[0][0]=Math.cos(s),a._matrix[0][1]=Math.sin(s),a._matrix[1][0]=-Math.sin(s),a._matrix[1][1]=Math.cos(s),this.Multiply(r),this.Multiply(n),this.Multiply(a)}},{key:"TransformVertex",value:function(e,t){var i=e.x*this._matrix[0][0]+e.y*this._matrix[1][0]+e.z*this._matrix[2][0]+this._matrix[3][0],s=e.x*this._matrix[0][1]+e.y*this._matrix[1][1]+e.z*this._matrix[2][1]+this._matrix[3][1],r=e.x*this._matrix[0][2]+e.y*this._matrix[1][2]+e.z*this._matrix[2][2]+this._matrix[3][2];t.x=i,t.y=s,t.z=r}},{key:"ProjectVertex",value:function(e,t,i){var s=t.z;0==s&&(s=1e-5),e.x=i*t.x/s,e.y=i*t.y/s}}]),e}(),De=q((function e(){U(this,e),this.from=0,this.to=0})),We=function(){function e(){U(this,e),this.mMatrix=new Ce,this.mMatrix.Identity(),this.mVertexList=0,this.mEdgeList=0,this.mNumVertex=0,this.mNumEdges=0,this.mIsLineLoop=!1}return q(e,[{key:"draw",value:function(e){x(e.r,e.g,e.b,e.a),M(.3*e.lineRadius),E(2);for(var t=0;t<this.mNumEdges;t++){var i=this.mVertexList[this.mEdgeList[t].from],s=this.mVertexList[this.mEdgeList[t].to],r=new Pe,n=new Pe;this.mMatrix.TransformVertex(i,r),this.mMatrix.TransformVertex(s,n),L(r.x,r.y,0),L(n.x,n.y,0)}k()}},{key:"emit",value:function(e){var t=this;x(e.r,e.g,e.b,e.a),E(1);for(var i=0;i<t.mNumEdges;i++){var s=t.mVertexList[t.mEdgeList[i].from],r=t.mVertexList[t.mEdgeList[i].to],n=new Pe,a=new Pe;t.mMatrix.TransformVertex(s,n),t.mMatrix.TransformVertex(r,a),L(n.x,n.y,0),L(a.x,a.y,0)}k()}},{key:"Identity",value:function(){this.mMatrix.Identity()}},{key:"Scale",value:function(e){this.mMatrix.Scale(e,e,e)}},{key:"Translate",value:function(e){this.mMatrix.Translate(e.x,e.y,e.z)}},{key:"Rotate",value:function(e){this.mMatrix.Rotate(0,0,e)}}]),e}(),Oe=12,Ye=13,ze=14,Xe=15,He=16,Fe=function(){function e(t){U(this,e),this.mParticles=t,this.mSpawnTime=50,this.mDestroyTime=0,this.mIndicateTime=100,this.mStateTimer=0,this.mAggression=1,this.mEdgeBounce=!1,this.mGridBound=!0,this.mGenId=0,this.mRotationRate=0,this.mAngle=0,this.mPen=new Ne,this.mModel=new We,this.mPos=new Pe(0,0,0),this.mSpeed=new Pe(0,0,0),this.mDrift=new Pe(0,0,0)}return q(e,[{key:"getType",value:function(){return this.mType}},{key:"getPos",value:function(){return this.mPos}},{key:"setPos",value:function(e){this.mPos=e}},{key:"getSpeed",value:function(){return this.mSpeed}},{key:"setSpeed",value:function(e){this.mSpeed=e}},{key:"getDrift",value:function(){return this.mDrift}},{key:"setDrift",value:function(e){this.mDrift=e}},{key:"getAngle",value:function(){return this.mAngle}},{key:"setAngle",value:function(e){this.mAngle=e}},{key:"getRotationRate",value:function(){return this.mRotationRate}},{key:"setRotationRate",value:function(e){this.mRotationRate=e}},{key:"getScale",value:function(){return this.mScale}},{key:"setScale",value:function(e){this.mScale=e}},{key:"getPen",value:function(){return this.mPen}},{key:"setPen",value:function(e){this.mPen=e}},{key:"getEnabled",value:function(){return 0!==this.mState}},{key:"setEnabled",value:function(e){this.mState=this.enabled?1:0}},{key:"getState",value:function(){return this.mState}},{key:"setState",value:function(e){this.mState=e}},{key:"getStateTimer",value:function(){return this.mStateTimer}},{key:"setStateTimer",value:function(e){this.mStateTimer=e}},{key:"getModel",value:function(){return this.mModel}},{key:"getScoreValue",value:function(){return this.mScoreValue}},{key:"getRadius",value:function(){return this.mRadius}},{key:"getAggression",value:function(){return this.mAggression}},{key:"setEdgeBounce",value:function(e){this.mEdgeBounce=e}},{key:"runTransition",value:function(){this.setState(4)}},{key:"run",value:function(){if(this.mAggression+=2e-4,this.mPos.add(this.mSpeed),this.mPos.add(this.mDrift),this.mAngle+=this.mRotationRate,this.mAngle=we(this.mAngle,6.28318),this.mGrid&&this.mGridBound){var e=0,t=this.mGrid.hitTest(this.mPos,0,new Pe,e);t&&(this.mPos=t.hitPoint,e=t.angle)}this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos),this.mDrift.multiply(.95)}},{key:"spawnTransition",value:function(){this.setState(2),this.mStateTimer=this.mSpawnTime,this.mSpeed=new Pe(0,0,0),this.mDrift=new Pe(0,0,0),this.mAngle=0,this.mRotationRate=0,this.mAggression=1,this.spawn(),this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos)}},{key:"spawn",value:function(){--this.mStateTimer<=0&&this.setState(4)}},{key:"destroyTransition",value:function(){this.setState(6),this.mStateTimer=this.mDestroyTime,++this.mGenId;var e=new Pe(this.mPos.x,this.mPos.y,this.mPos.z),t=new Pe(0,0,0),i=new Ne(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);i.r*=1.2,i.g*=1.2,i.b*=1.2,i.a=.9,i.lineRadius=5,this.mParticles.emitter(e,t,1.2,6.28318,50,i,150,!0,!0,.97,!0),this.mEnemies.explodeEntity(this)}},{key:"destroy",value:function(){--this.mStateTimer<=0&&this.setState(0)}},{key:"indicateTransition",value:function(){this.mStateTimer=this.mIndicateTime,this.setState(8)}},{key:"indicating",value:function(){--this.mStateTimer<=0&&this.setState(0)}},{key:"hit",value:function(e){var t=this,i=!1;if(e){var s=e;s.getType()<3?t.mScoreValue&&(0==s.mPlayerSource?t.mPlayers.mPlayer1.addKillAtLocation(t.mScoreValue,t.getPos()):1==s.mPlayerSource&&t.mPlayers.mPlayer2.addKillAtLocation(t.mScoreValue,t.getPos()),i=!0):e&&e.getType()==Oe||e&&1==e.getType()||e.getType()}else i=!0;if(this.setState(5),i)if(100*Math.random()<50){var r=t.mEnemies.getUnusedEnemyOfType(Xe);r&&(r.setState(1),r.setPos(this.getPos()),r.setRotationRate(.01*Math.random()-.05),r.setSpeed(new Pe(.1*Math.random()-.05,.1*Math.random()-.05,0)),r.setDrift(new Pe(1*Math.random()-.5,1*Math.random()-.5,0)))}else for(var n=0;n<2;n++){var a=t.mEnemies.getUnusedEnemyOfType(ze);a&&(a.setState(1),a.setPos(this.getPos()),a.setRotationRate(.01*Math.random()-.05),a.setSpeed(new Pe(.1*Math.random()-.05,.1*Math.random()-.05,0)),a.setDrift(new Pe(1*Math.random()-.5,1*Math.random()-.5,0)))}}},{key:"hitTest",value:function(e,t){var i=new Pe(0,0,0);return this.getModel().mMatrix.TransformVertex(new Pe(0,0,0),i),xe(e,i)<t+this.getRadius()?this:null}},{key:"draw",value:function(){if(8==this.getState())1&parseInt(this.mStateTimer/10,10)&&this.mModel.draw(this.mPen);else if(this.getEnabled()){var e=new Ne(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);if(2==this.getState()){var t=this.mScale,i=this.mPos,s=1/this.mSpawnTime,r=this.mStateTimer*s;M(.3*e.lineRadius),E(1);var n=r=1-r;n<0&&(n=0),n>1&&(n=1),e.a=n,this.mModel.Identity(),this.mModel.Scale(t*r*1),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),(n=1-(r+=.25))<0&&(n=0),n>1&&(n=1),e.a=n,this.mModel.Identity(),this.mModel.Scale(t*r*4),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),(n=1-(r+=.25))<0&&(n=0),n>1&&(n=1),e.a=n,this.mModel.Identity(),this.mModel.Scale(t*r*7),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),this.mModel.Identity(),this.mModel.Scale(t),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),k()}this.mPen.a=1,this.mModel.draw(this.mPen)}}},{key:"getParent",value:function(){return this}},{key:"getGenId",value:function(){return this.mGenId}},{key:"incGenId",value:function(){++this.mGenId}}]),e}();function Ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}function qe(){return qe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var s=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=je(e)););return e}(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},qe.apply(this,arguments)}function Ze(e,t){return Ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ze(e,t)}function $e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ze(e,t)}function Ke(t,i){if(i&&("object"===e(i)||"function"==typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return Ue(t)}var Je=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t,i,n){var a;U(this,r),(a=s.call(this)).mAttractors=e,a.mEnemies=t,a.mGrid=i,a.mParticles=n,a.mScale=.16,a.mRadius=1,a.mType=0,a.mPlayerSource=1,a.mScoreValue=0,a.mSpawnTime=0,a.mDestroyTime=0,a.mType=3;var o=0;a.mModel.mNumVertex=3,a.mModel.mVertexList=[],a.mModel.mVertexList[o++]=new Pe(0,7.5),a.mModel.mVertexList[o++]=new Pe(2,-5.2),a.mModel.mVertexList[o++]=new Pe(-2,-5.2),a.mModel.mNumEdges=3,a.mModel.mEdgeList=[];for(var m=0;m<a.mModel.mNumEdges;m++)a.mModel.mEdgeList.push(new De);return o=0,a.mModel.mEdgeList[o].from=0,a.mModel.mEdgeList[o++].to=1,a.mModel.mEdgeList[o].from=1,a.mModel.mEdgeList[o++].to=2,a.mModel.mEdgeList[o].from=2,a.mModel.mEdgeList[o++].to=0,a}return q(r,[{key:"run",value:function(e,t,i){var s=this;this.mEnemies=e,this.mGrid=t,this.mParticles=i,this.mLastPos=this.mPos;var r=!1;if(s.mEnemies)for(var n=0;n<xt;n++)if(s.mEnemies[n]&&s.mEnemies[n].getType()==Oe&&4==s.mEnemies[n].getState()){var a=s.mEnemies[n];if(a.mActivated&&xe(s.mPos,a.getPos())<20){var o=new Pe(a.getPos().x,a.getPos().y,a.getPos().z),m=new Pe(s.mPos.x,s.mPos.y,s.mPos.z),l=mod(Ee(m,o),6.28318),d=mod(getAngle()+Ge(90),6.28318),u=Ie(l,d);Math.abs(u)<.8&&(s.mRotationRate+=.1*u,r=!0)}}if(s.mRotationRate*=.5,r){var h=new Pe(this.mVelocity,0,0);s.mSpeed=Le(h,s.mAngle+Ge(90))}if(this.mPos.add(this.mSpeed),this.mPos.add(this.mDrift),this.mAngle-=s.mRotationRate,this.mAngle=we(s.mAngle,6.28318),this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos),this.mDrift.multiply(.95),this.getEnabled()){for(var c=0;c<10;c++){var f=c/10,y=1-f,v=new Pe(s.mPos.x*f+s.mLastPos.x*y,s.mPos.y*f+s.mLastPos.y*y,0);if(s.mEnemies){var p=s.mEnemies.hitTestEnemiesAtPosition(v,s.getRadius(),!0);p&&(s.setState(5),p.hit(s))}}if(s.mGrid&&s.mGrid.hitTest(s.mPos,0)&&(s.setState(5),s.mSpeed=new Pe(0,0,0)),0==s.mType){var g=s.mAttractors.getAttractor();g&&(g.strength=5,g.zStrength=0,g.radius=5,g.pos=s.mPos,g.enabled=!0,g.attractsParticles=!1)}else if(1==s.mType){var S=s.mAttractors.getAttractor();S&&(S.strength=5,S.zStrength=0,S.radius=5,S.pos=s.mPos,S.enabled=!0,S.attractsParticles=!1)}else if(2==s.mType){var P=s.mAttractors.getAttractor();P&&(P.strength=50,P.zStrength=0,P.radius=5,P.pos=s.mPos,P.enabled=!0,P.attractsParticles=!1)}}}},{key:"spawnTransition",value:function(){this.spawn(),this.setState(4),this.mRotationRate=0,this.run()}},{key:"destroyTransition",value:function(){this.mStateTimer=this.mDestroyTime,qe(je(r.prototype),"destroy",this).call(this),this.setState(0)}},{key:"draw",value:function(){4==this.getState()&&(this.mPen=0==this.mPlayerSource?new Ne(1,.9,.2,.7,12):new Ne(.5,.5,1,.7,12),qe(je(r.prototype),"draw",this).call(this))}}]),r}(Fe);var Qe=!1,et=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;return U(this,r),Ue(i=s.call(this)),i.mGrid=t,i.mDrawSheild=!1,i.mDestroyTime=50,i.mMaxMissiles=500,i.setState(0),i.missiles=[],i.initPlayerForGame(),i}return q(r,[{key:"setGame",value:function(e){this.mGame=e}},{key:"setBomb",value:function(e){this.mBomb=e}},{key:"setEnemies",value:function(e){this.mEnemies=e}},{key:"setParticles",value:function(e){this.mParticles=e}},{key:"initPlayerForGame",value:function(){console.log("INIT PLAYER FOR GAME"),this.mNumBombs=5,this.mNumLives=5,this.mBombCounter=0,this.mLifeCounter=0,this.mBombInterimTimer=0,this.mGeoms=0,this.mScore=0,this.mMultiplier=1,this.mFiringTimer=0,this.mKillCounter=0,this.mLevelAdvanceCounter=0,this.mCurrentWeapon=0,this.mAngle=0,this.setState(1),this.mInput=function(){var e={type:0,enabled:!0};e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[];for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return e.keybmap=[],e.keybmap[1]=38,e.keybmap[2]=40,e.keybmap[3]=39,e.keybmap[4]=37,e.keybmap[5]=32,e.keybmap[6]=17,e.keybmap[7]=13,e.keybmap[8]=27,function(e){var t={};t.data=e,t.next=ae,ae=t}(e),e}()}},{key:"run",value:function(){if(this.getEnabled()){this.mGameMode!=$t&&(m=this.mInput,!!5&&!!m.enabled&&m.state[parseInt(5,10)]&&!m.oldstate[parseInt(5,10)]&&this.getNumBombs()>0&&this.mBombInterimTimer<=0&&(this.takeBomb(),this.mBombInterimTimer=50,this.mBomb.startBomb(new Pe(this.mPos.x,this.mPos.y,this.mPos.z),1,6,2,1e3,new Ne(1,1,1,.3,4))),this.mBombInterimTimer>0&&--this.mBombInterimTimer);var e=new Pe(0,0,0),t=this.mInput.state[10],i=0;if(t?i=xe(new Pe(0,0,0),t):(t=new Pe(0,0,0),de(this.mInput,12)&&(t.x=1,i=1),de(this.mInput,13)&&(t.x=-1,i=1),de(this.mInput,15)&&(t.y=1,i=1),de(this.mInput,14)&&(t.y=-1,i=1)),i>.1){i=i>.6?1:.5;var s=Ee(new Pe(0,0,0),t)+Ge(90),n=new Pe(.9*i,0,0);n=Le(n,s),s-=Ge(90),s=we(s,6.28318);var a=we(this.getAngle(),6.28318);a+=.2*Ie(s,a),this.setAngle(a),Qe||(Qe=!0),e=n,this.setPos(this.getPos().add(n))}var o=this.mInput.state[11];i=0,o?i=xe(new Pe(0,0,0),o):(o=new Pe(0,0,0),de(this.mInput,1)&&(o.x=1,i=1),de(this.mInput,2)&&(o.x=-1,i=1),de(this.mInput,4)&&(o.y=1,i=1),de(this.mInput,3)&&(o.y=-1,i=1)),i>.1&&this.firePattern3(o,e)}var m;this.runMissiles(),this.mDrawSheild=!1,this.mSheildTimer>0&&--this.mSheildTimer,this.mSheildTimer<60?this.mDrawSheild=this.mSheildTimer/6&1:this.mDrawSheild=!0,this.mSheildTimer;var l=this.mAttractors.getAttractor();l&&(l.strength=40,l.zStrength=0,l.radius=4,l.pos=this.mPos,l.enabled=!0,l.attractsParticles=!1),qe(je(r.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){this.mSheildTimer=250;var e=this.getAngle();qe(je(r.prototype),"spawnTransition",this).call(this),this.setAngle(e),this.mDrawSheild=!0}},{key:"spawn",value:function(){qe(je(r.prototype),"spawn",this).call(this),this.mDrawSheild=!0;var e=this.mAttractors.getAttractor();e&&(this.mStateTimer>this.mSpawnTime-25?(e.strength=-20,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0):this.mStateTimer>this.mSpawnTime-50&&this.mStateTimer<=this.mSpawnTime-25&&(e.strength=10,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0))}},{key:"destroyTransition",value:function(){qe(je(r.prototype),"destroyTransition",this).call(this),this.mStateTimer=this.mDestroyTime,this.mMultiplier=1;var e=this.mAttractors.getAttractor();e&&this.mStateTimer>20&&(e.strength=10,e.radius=20,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!1);var t=new Pe(this.mPos.x,this.mPos.y,this.mPos.z),i=new Pe(0,0,0),s=new Ne(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);s.r*=1.2,s.g*=1.2,s.b*=1.2,s.a=.8,s.lineRadius=5,this.mParticles.emitter(t,i,2,6.28318,200,s,300,!0,!0,.98,!0),this.setState(6),this.getNumLives()}},{key:"indicating",value:function(){--this.mStateTimer<=0&&this.setState(0)}},{key:"draw",value:function(){for(var e=0;e<this.mMaxMissiles;e++){var t=this.missiles[e];t.getEnabled()&&t.draw()}if(this.getEnabled()&&this.mDrawSheild){x(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a),E(3);for(var i=0;i<6.28318;i+=.05)T(this.mPos.x+2.5*Math.cos(i),this.mPos.y+2.5*Math.sin(i),0);k()}qe(je(r.prototype),"draw",this).call(this)}},{key:"addKillAtLocation",value:function(e,t){var i=e*this.mMultiplier;this.mScore+=i,this.mBombCounter+=i,this.mLifeCounter+=i,this.mBombCounter>=1e5&&(this.mBombCounter=0,this.addBomb()),this.mLifeCounter>=75e3&&(this.mLifeCounter=0,this.addLife()),++this.mKillCounter,this.mKillCounter>=25&&(this.mKillCounter=0,++this.mMultiplier)}},{key:"runMissiles",value:function(){for(var e=this,t=0;t<e.mMaxMissiles;t++){var i=e.missiles[t];if(i.getEnabled())switch(i.getState()){case 1:i.spawnTransition();break;case 2:i.spawn();break;case 3:i.runTransition();break;case 4:i.run(e.mEnemies,e.mGrid,e.mParticles);break;case 5:i.destroyTransition();break;case 6:i.destroy()}}}},{key:"shields",value:function(){return!0}},{key:"getNumLives",value:function(){return 1==this.mGame.mNumPlayers?this.mNumLives:this.mGame.m2PlayerNumLives}},{key:"getNumBombs",value:function(){return 1==this.mGame.mNumPlayers?this.mNumBombs:this.mGame.m2PlayerNumBombs}},{key:"getGeoms",value:function(){return this.mGeoms}},{key:"addLife",value:function(){1==this.mGame.mNumPlayers?++this.mNumLives:++this.mGame.m2PlayerNumLives}},{key:"takeLife",value:function(){1==this.mGame.mNumPlayers?--this.mNumLives:--this.mGame.m2PlayerNumLives}},{key:"addBomb",value:function(){1==this.mGame.mNumPlayers&&++this.mNumBombs}},{key:"takeBomb",value:function(){1==this.mGame.mNumPlayers&&--this.mNumBombs}},{key:"addGeom",value:function(e){this.mGeoms+=e}},{key:"clearGeoms",value:function(){this.mGeoms=0}},{key:"addPointsNoMultiplier",value:function(e){var t=parseInt(e,10);this.mScore+=t,this.mBombCounter+=t,this.mLifeCounter+=t}},{key:"switchWeapons",value:function(){0==this.mCurrentWeapon?this.mCurrentWeapon=1:this.mCurrentWeapon=100*Math.random()<50?1:2}},{key:"firePattern1",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){i.mFiringTimer=6;for(var s=null,r=0;r<i.mMaxMissiles;r++)if(!i.missiles[r].getEnabled()){(s=i.missiles[r]).setState(1),s.mType=0,s.mPlayerSource=i.mPlayerAssignment;break}for(var n=null,a=0;a<i.mMaxMissiles;a++)if(!i.missiles[a].getEnabled()){(n=i.missiles[a]).setState(1),n.mType=0,n.mPlayerSource=i.mPlayerAssignment;break}if(s&&n){var o=Ee(new Pe(0,0,0),e)+Ge(90),m=1.4,l=o+.4,d=o-.4,u=new Pe(m,0,0),h=new Pe(2,0,0),c=this.getPos().copy().add(Le(h,l));u=Le(u,o),s.setPos(c),s.setAngle(o-Ge(90)),s.setSpeed(u),s.mVelocity=m,u=new Pe(m,0,0),h=new Pe(2,0,0),c=this.getPos().copy().add(Le(h,d)),u=Le(u,o),n.setPos(c),n.setAngle(o-Ge(90)),n.setSpeed(u),n.mVelocity=m}}}},{key:"firePattern2",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){var s=!0;s=!s,i.mFiringTimer=s?4:1;var r=null,n=null,a=null;if(s){for(var o=0;o<i.mMaxMissiles;o++)if(!i.missiles[o].getEnabled()){(r=i.missiles[o]).setState(1),r.mType=1,r.mPlayerSource=i.mPlayerAssignment;break}for(var m=0;m<i.mMaxMissiles;m++)if(!i.missiles[m].getEnabled()){(n=i.missiles[m]).setState(1),n.mType=1,n.mPlayerSource=i.mPlayerAssignment;break}}else for(var l=0;l<i.mMaxMissiles;l++)if(!i.missiles[l].getEnabled()){(a=i.missiles[l]).setState(1),a.mType=1,a.mPlayerSource=i.mPlayerAssignment;break}var d=Ee(new Pe(0,0,0),e)+Ge(90);if(a){var u=new Pe,h=new Pe(1.6,0,0),c=new Pe(.5,0,0);u=this.getPos().copy().add(Le(c,d)),h=Le(h,d),a.setPos(u),a.setAngle(d-Ge(90)),a.setSpeed(h),a.mVelocity=1.6}}}},{key:"firePattern3",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){i.mFiringTimer=7;for(var s=null,r=null,n=null,a=null,o=null,m=0;m<i.mMaxMissiles;m++)if(!i.missiles[m].getEnabled()){(s=i.missiles[m]).setState(1),s.mType=2,s.mPlayerSource=i.mPlayerAssignment;break}for(var l=0;l<i.mMaxMissiles;l++)if(!i.missiles[l].getEnabled()){(r=i.missiles[l]).setState(1),r.mType=2,r.mPlayerSource=i.mPlayerAssignment;break}for(var d=0;d<i.mMaxMissiles;d++)if(!i.missiles[d].getEnabled()){(n=i.missiles[d]).setState(1),n.mType=2,n.mPlayerSource=i.mPlayerAssignment;break}for(var u=0;u<i.mMaxMissiles;u++)if(!i.missiles[u].getEnabled()){(a=i.missiles[u]).setState(1),a.mType=2,a.mPlayerSource=i.mPlayerAssignment;break}for(var h=0;h<i.mMaxMissiles;h++)if(!i.missiles[h].getEnabled()){(o=i.missiles[h]).setState(1),o.mType=2,o.mPlayerSource=i.mPlayerAssignment;break}if(s&&r&&n&&a&&o){var c=Ee(new Pe(0,0,0),e)+Ge(90),f=1.2,y=c+.1,v=c-.1,p=c+.05,g=c-.05,S=new Pe,P=new Pe(f,0,0),M=new Pe(2,0,0);S=this.getPos().copy().add(Le(M,c)),P=Le(P,c),s.setPos(S),s.setAngle(c-Ge(90)),s.setSpeed(P),s.mVelocity=f,S=new Pe,P=new Pe(f,0,0),M=new Pe(2,0,0),S=this.getPos().copy().add(Le(M,y)),P=Le(P,p),r.setPos(S),r.setAngle(c-Ge(90)),r.setSpeed(P),r.mVelocity=f,S=new Pe,P=new Pe(f,0,0),M=new Pe(2,0,0),S=this.getPos().copy().add(Le(M,v)),P=Le(P,g),n.setPos(S),n.setAngle(c-Ge(90)),n.setSpeed(P),n.mVelocity=f}}}}]),r}(Fe);var tt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t,i){var n;U(this,r);var a=Ue(n=s.call(this,e,t));n.mAttractors=e,n.mGrid=t,n.mParticles=i,n.mPlayerAssignment=0,n.mType=1,n.mScale=1.7,n.mRadius=2,n.mScoreValue=0,n.mSpawnTime=35,n.mSheildTimer=250;var o=0;n.mModel.mNumVertex=8,n.mModel.mVertexList=[],n.mModel.mVertexList[o++]=new Pe(0,-1),n.mModel.mVertexList[o++]=new Pe(1,-.15),n.mModel.mVertexList[o++]=new Pe(.5,.7),n.mModel.mVertexList[o++]=new Pe(.72,.02),n.mModel.mVertexList[o++]=new Pe(0,-.4),n.mModel.mVertexList[o++]=new Pe(-.72,.02),n.mModel.mVertexList[o++]=new Pe(-.5,.7),n.mModel.mVertexList[o++]=new Pe(-1,-.15),n.mModel.mNumEdges=8,n.mModel.mEdgeList=[];for(var m=0;m<n.mModel.mNumEdges;m++)n.mModel.mEdgeList.push(new De);o=0,n.mModel.mEdgeList[o].from=0,n.mModel.mEdgeList[o++].to=1,n.mModel.mEdgeList[o].from=1,n.mModel.mEdgeList[o++].to=2,n.mModel.mEdgeList[o].from=2,n.mModel.mEdgeList[o++].to=3,n.mModel.mEdgeList[o].from=3,n.mModel.mEdgeList[o++].to=4,n.mModel.mEdgeList[o].from=4,n.mModel.mEdgeList[o++].to=5,n.mModel.mEdgeList[o].from=5,n.mModel.mEdgeList[o++].to=6,n.mModel.mEdgeList[o].from=6,n.mModel.mEdgeList[o++].to=7,n.mModel.mEdgeList[o].from=7,n.mModel.mEdgeList[o++].to=0;for(var l=0;l<n.mMaxMissiles;l++){var d=new Je(a.mAttractors,a.mEnemies,a.mGrid,a.mParticles);d.setEnabled(!1),n.missiles.push(d)}return n}return q(r,[{key:"initPlayerForGame",value:function(){qe(je(r.prototype),"initPlayerForGame",this).call(this),this.mPen=new Ne(1,1,1,.5,12),this.mPos.x=this.mGrid.extentX()/2,this.mPos.y=this.mGrid.extentY()/2,this.mPos.z=0}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this)}},{key:"spawn",value:function(){qe(je(r.prototype),"spawn",this).call(this);var e=this.mAttractors.getAttractor();e&&(e.strength=-20,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0)}},{key:"run",value:function(){if(this.mDrawSheild){var e=this.mAttractors.getAttractor();e&&(e.strength=20,e.zStrength=0,e.radius=4,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!1)}qe(je(r.prototype),"run",this).call(this)}}]),r}(et);var it=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(){var e;U(this,r),(e=s.call(this)).mPlayerAssignment=1,e.mType=2,e.mScale=.1,e.mRadius=2,e.mScoreValue=0,e.mSpawnTime=35,e.mSheildTimer=250,e.mPen=new Ne(.5,.5,1,.7,12);var t=0;e.mModel.mNumVertex=13,e.mModel.mVertexList=[],e.mModel.mVertexList[t++]=new Pe(0,17.5),e.mModel.mVertexList[t++]=new Pe(6.5,5.5),e.mModel.mVertexList[t++]=new Pe(0,-6.5),e.mModel.mVertexList[t++]=new Pe(-6.5,5.5),e.mModel.mVertexList[t++]=new Pe(1.5,-10.5),e.mModel.mVertexList[t++]=new Pe(15,1.5),e.mModel.mVertexList[t++]=new Pe(9.2,-13.1),e.mModel.mVertexList[t++]=new Pe(-1.5,-10.5),e.mModel.mVertexList[t++]=new Pe(-15,1.5),e.mModel.mVertexList[t++]=new Pe(-9.2,-13.1),e.mModel.mVertexList[t++]=new Pe(5,-17.7),e.mModel.mVertexList[t++]=new Pe(0,-14.5),e.mModel.mVertexList[t++]=new Pe(-5,-17.7),e.mModel.mNumEdges=12,e.mModel.mEdgeList=[];for(var i=0;i<e.mModel.mNumEdges;i++)e.mModel.mEdgeList.push(new De);return t=0,e.mModel.mEdgeList[t].from=0,e.mModel.mEdgeList[t++].to=1,e.mModel.mEdgeList[t].from=1,e.mModel.mEdgeList[t++].to=2,e.mModel.mEdgeList[t].from=2,e.mModel.mEdgeList[t++].to=3,e.mModel.mEdgeList[t].from=3,e.mModel.mEdgeList[t++].to=0,e.mModel.mEdgeList[t].from=4,e.mModel.mEdgeList[t++].to=5,e.mModel.mEdgeList[t].from=5,e.mModel.mEdgeList[t++].to=6,e.mModel.mEdgeList[t].from=6,e.mModel.mEdgeList[t++].to=4,e.mModel.mEdgeList[t].from=7,e.mModel.mEdgeList[t++].to=9,e.mModel.mEdgeList[t].from=9,e.mModel.mEdgeList[t++].to=8,e.mModel.mEdgeList[t].from=8,e.mModel.mEdgeList[t++].to=7,e.mModel.mEdgeList[t].from=10,e.mModel.mEdgeList[t++].to=11,e.mModel.mEdgeList[t].from=11,e.mModel.mEdgeList[t++].to=12,e}return q(r)}(et);var st=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=1.5,i.mRadius=3,i.mScoreValue=50,i.mType=4,i.setState(0),i.mAnimationIndex=0,i.mPen=new Ne(.5,1,1,.7,12);var n=0;i.mModel.mNumVertex=4,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(0,1),i.mModel.mVertexList[n++]=new Pe(1,0),i.mModel.mVertexList[n++]=new Pe(0,-1),i.mModel.mVertexList[n++]=new Pe(-1,0),i.mModel.mNumEdges=4,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=3,i.mModel.mEdgeList[n++].to=0,i}return q(r,[{key:"run",value:function(){var e=this;if(this.getEnabled()){var t=Ee(e.mPos,e.mPlayers.mPlayer1.getPos()),i=new Pe(1,0,0);i=Le(i,t),e.mSpeed.add(i).multiply(.01),e.mSpeed=Re(e.mSpeed,.3*e.mAggression),e.mSpeed.multiply(20.99),e.mAnimationIndex+=.07,e.mScale=2+.4*Math.sin(this.mAnimationIndex)}qe(je(r.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this)}}]),r}(Fe);var rt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mGrid=i.mPlayers.mGrid;var n=Ue(i);i.mScale=1.7,i.mRadius=2.6,i.mScoreValue=25,i.mEdgeBounce=!0,i.mType=5,i.setState(0),i.mAnimationIndex=0,i.mPen=new Ne(.65,.5,1,.7,12);var a=0;if(i.mModel.mNumVertex=9,i.mModel.mVertexList=[],i.mModel.mVertexList[a++]=new Pe(0,0),i.mModel.mVertexList[a++]=new Pe(0,1),i.mModel.mVertexList[a++]=new Pe(1,1),i.mModel.mVertexList[a++]=new Pe(1,0),i.mModel.mVertexList[a++]=new Pe(1,-1),i.mModel.mVertexList[a++]=new Pe(0,-1),i.mModel.mVertexList[a++]=new Pe(-1,-1),i.mModel.mVertexList[a++]=new Pe(-1,0),i.mModel.mVertexList[a++]=new Pe(-1,1),i.mFlipped=Math.random()<.5,i.mFlipped)for(var o=0;o<n.mModel.mNumVertex;o++){var m=n.mModel.mVertexList[o].y;n.mModel.mVertexList[o].y=n.mModel.mVertexList[o].x,n.mModel.mVertexList[o].x=m}i.mModel.mNumEdges=12,i.mModel.mEdgeList=[];for(var l=0;l<i.mModel.mNumEdges;l++)i.mModel.mEdgeList.push(new De);return a=0,i.mModel.mEdgeList[a].from=0,i.mModel.mEdgeList[a++].to=1,i.mModel.mEdgeList[a].from=1,i.mModel.mEdgeList[a++].to=2,i.mModel.mEdgeList[a].from=2,i.mModel.mEdgeList[a++].to=0,i.mModel.mEdgeList[a].from=0,i.mModel.mEdgeList[a++].to=3,i.mModel.mEdgeList[a].from=3,i.mModel.mEdgeList[a++].to=4,i.mModel.mEdgeList[a].from=4,i.mModel.mEdgeList[a++].to=0,i.mModel.mEdgeList[a].from=0,i.mModel.mEdgeList[a++].to=5,i.mModel.mEdgeList[a].from=5,i.mModel.mEdgeList[a++].to=6,i.mModel.mEdgeList[a].from=6,i.mModel.mEdgeList[a++].to=0,i.mModel.mEdgeList[a].from=0,i.mModel.mEdgeList[a++].to=7,i.mModel.mEdgeList[a].from=7,i.mModel.mEdgeList[a++].to=8,i.mModel.mEdgeList[a].from=8,i.mModel.mEdgeList[a++].to=0,i}return q(r,[{key:"run",value:function(){var e=this;if(e.getEnabled()){40*Math.random()<1&&(e.mCurrentHeading=e.mCurrentHeading+(1.5*Math.random()-.75));var t=new Pe(1,0,0);(t=Le(t,e.mCurrentHeading)).multiply(.8),e.mSpeed.add(t).multiply(.02),e.mSpeed=Re(e.mSpeed,.3),e.mSpeed.multiply(.98),e.mGrid.hitTest(e.mPos,2*this.getRadius())&&(e.mCurrentHeading=6.28318*Math.random())}qe(je(r.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this),this.mSpeed=new Pe(0,0,0),this.mAngle=0,this.mCurrentHeading=6.28318*Math.random(),this.mAngle=0,this.mRotationRate=this.mFlipped?-.12:.12}}]),r}(Fe);var nt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=1.5,i.mRadius=2.4,i.mScoreValue=100,i.mType=6,i.setState(0),i.mAnimationIndex=0,i.mPen=new Ne(.3,1,.35,.5,12);var n=0;i.mModel.mNumVertex=8,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(0,1),i.mModel.mVertexList[n++]=new Pe(1,0),i.mModel.mVertexList[n++]=new Pe(0,-1),i.mModel.mVertexList[n++]=new Pe(-1,0),i.mModel.mVertexList[n++]=new Pe(-1,1),i.mModel.mVertexList[n++]=new Pe(1,1),i.mModel.mVertexList[n++]=new Pe(1,-1),i.mModel.mVertexList[n++]=new Pe(-1,-1),i.mModel.mNumEdges=8,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=3,i.mModel.mEdgeList[n++].to=0,i.mModel.mEdgeList[n].from=4,i.mModel.mEdgeList[n++].to=5,i.mModel.mEdgeList[n].from=5,i.mModel.mEdgeList[n++].to=6,i.mModel.mEdgeList[n].from=6,i.mModel.mEdgeList[n++].to=7,i.mModel.mEdgeList[n].from=7,i.mModel.mEdgeList[n++].to=4,i}return q(r,[{key:"run",value:function(){var e=this;if(e.getEnabled()){for(var t=0;t<e.mMaxMissiles;t++){var i=e.mPlayers.mPlayer1.missiles[t];if(i.getEnabled()){var s=Ee(i.getPos(),e.mPos),n=Ee(new Pe(0,0,0),i.getSpeed()),a=Ie(s,n);if(Math.abs(a)<1&&xe(i.getPos(),e.mPos)<25){var o=Ee(mPos,e.mPlayers.mPlayer1.getPos()),m=new Pe(.8,a>0?1.1:-1.1,0);m=Le(m,o+Ge(180)),m=Re(m,.08),e.mDrift.add(m)}}}var l=Ee(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),d=new Pe(1,0,0);d=Le(d,l),d=Re(d,.08),e.mSpeed.add(d),e.mSpeed=Re(e.mSpeed,.6*e.mAggression),e.mSpeed.multiply(.95)}qe(je(r.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this),this.mRotationRate=-.06}}]),r}(Fe);var at=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=1.6,i.mRadius=2.5,i.mScoreValue=100,i.mType=7,i.setState(0),i.mAnimationIndex=0,i.mPen=new Ne(1,.5,1,.7,12);var n=0;i.mModel.mNumVertex=5,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(0,0),i.mModel.mVertexList[n++]=new Pe(-1,1),i.mModel.mVertexList[n++]=new Pe(1,1),i.mModel.mVertexList[n++]=new Pe(1,-1),i.mModel.mVertexList[n++]=new Pe(-1,-1),i.mModel.mNumEdges=8,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=4,i.mModel.mEdgeList[n++].to=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=3,i.mModel.mEdgeList[n++].to=4,i.mModel.mEdgeList[n].from=4,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i}return q(r,[{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this)}},{key:"run",value:function(){var e=this;if(e.getEnabled()){var t=Ee(e.mPos,e.mPlayers.mPlayer1.getPos()),i=new Pe(1,0,0);i=Le(i,t),e.mSpeed.add(i.multiply(.2)),e.mSpeed=Re(e.mSpeed,.6*e.mAggression),e.mSpeed.multiply(.9),e.mAnimationIndex+=.12,e.mAngle=.5*Math.sin(e.mAnimationIndex)}qe(je(r.prototype),"run",this).call(this)}},{key:"destroyTransition",value:function(){var e=this,t=e.mPos;qe(je(r.prototype),"destroyTransition",this).call(this);var i=new Pe(12,0,0),s=Ee(t,e.mPlayers.mPlayer1.getPos());i=Le(i,s+Ge(90));var n=e.mEnemies.getUnusedEnemyOfType(8);n&&(n.setPos(i.copy().add(t)),n.setSpeed(i.copy().multiply(.2)),n.setState(1)),i=Le(i,s-Ge(90)),(n=e.mEnemies.getUnusedEnemyOfType(8))&&(n.setPos(i.copy().add(t)),n.setSpeed(i.copy().multiply(.2)),n.setState(1))}},{key:"hit",value:function(e){e&&e?qe(je(r.prototype),"hit",this).call(this,e):qe(je(r.prototype),"destroyTransition",this).call(this)}}]),r}(Fe);var ot=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;return U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=1,i.mRadius=2.2,i.mScoreValue=50,i.mVirtualPos=new Pe(0,0,0),i.mAnimationIndex=0,i.mType=8,i}return q(r,[{key:"draw",value:function(){8==this.getState()?1&(parseInt(this.mStateTimer/10),10)&&this.mModel.draw(this.mPen):this.getEnabled()&&(this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mVirtualPos),this.mModel.draw(this.mPen))}},{key:"run",value:function(){if(this.getEnabled()){var e=Ee(this.mPos,this.mPlayers.getPlayerClosestToPosition(this.mPos).getPos()),t=new Pe(1,0,0);t=Le(t,e),this.mSpeed.add(t).multiply(.02),this.mSpeed=Re(this.mSpeed,.3*mAggression),this.mSpeed.multiply(.9),this.mAnimationIndex+=.1;var i=new Pe(4,0,0);i=Le(i,this.mAnimationIndex),this.mVirtualPos=this.mPos+i,this.mAngle=2*this.mAnimationIndex}qe(je(r.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this)}},{key:"spawn",value:function(){if(qe(je(r.prototype),"spawn",this).call(this),this.mStateTimer>0){var e=this.mStateTimer/this.mSpawnTime;e=1*e+.5*(1-e),this.mPen=new Ne(1,e,1,.5,12),this.mStateTimer-=1,this.run()}mStateTimer<=0&&(this.mPen=new Ne(1,.5,1,.5,12))}},{key:"destroyTransition",value:function(){qe(je(r.prototype),"destroyTransition",this).call(this)}},{key:"destroy",value:function(){qe(je(r.prototype),"destroy",this).call(this)}}]),r}(Fe);var mt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=.8,i.mRadius=3,i.mTarget=new Pe,i.mScoreValue=50,i.mType=9,i.setState(0),i.mFlipTimer=15*Math.random(),i.mFlipDirection=1,i.mPen=new Ne(1,.5,1,.7,12);var n=0;i.mModel.mNumVertex=6,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(-.25,1.25),i.mModel.mVertexList[n++]=new Pe(.25,1.25),i.mModel.mVertexList[n++]=new Pe(1.2,-.5),i.mModel.mVertexList[n++]=new Pe(1,-.9),i.mModel.mVertexList[n++]=new Pe(-1,-.9),i.mModel.mVertexList[n++]=new Pe(-1.2,-.5),i.mModel.mNumEdges=3,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=4,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=5,i}return q(r,[{key:"run",value:function(){if(this.getEnabled()){--this.mFlipTimer<=0&&(this.mFlipTimer=15,this.mFlipDirection=-this.mFlipDirection,this.mTarget=new Pe(this.mPlayers.mPlayer1.getPos().x,this.mPlayers.mPlayer1.getPos().y,this.mPlayers.mPlayer1.getPos().z),this.mTarget.x+=30*Math.random()-15,this.mTarget.y+=30*Math.random()-15);var e=1.2*this.mFlipDirection-this.mAngle;this.mRotationRate+=.03*e,this.mRotationRate*=.9;var t=Ee(this.mPos,this.mTarget),i=new Pe(1,0,0);i=Le(i,t),this.mSpeed.add(i).multiply(.5),this.mSpeed=Re(this.mSpeed,.45*this.mAggression),this.mSpeed.multiply(.9)}qe(je(r.prototype),"run",this).call(this)}}]),r}(Fe);var lt=23,dt=q((function e(){U(this,e),this.pos=new Pe,this.angle=0})),ut=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles;var n=Ue(i);i.mScale=1,i.mRadius=1,i.mScoreValue=0,i.mTail=0,i.mDestroyTime=0,i.mType=11,i.mPen=new Ne(1,1,.8,.5,12);var a=0;i.mModel.mNumVertex=3,i.mModel.mVertexList=[],i.mModel.mVertexList[a++]=new Pe(0,.8),i.mModel.mVertexList[a++]=new Pe(.5,-.5),i.mModel.mVertexList[a++]=new Pe(-.5,-.5),i.mModel.mNumEdges=3,i.mModel.mEdgeList=[];for(var o=0;o<i.mModel.mNumEdges;o++)i.mModel.mEdgeList.push(new De);a=0,i.mModel.mEdgeList[a].from=0,i.mModel.mEdgeList[a++].to=1,i.mModel.mEdgeList[a].from=1,i.mModel.mEdgeList[a++].to=2,i.mModel.mEdgeList[a].from=2,i.mModel.mEdgeList[a++].to=0,i.mSegmentStream=[];for(var m=0;m<5;m++){var l=new dt;l.pos.x=n.mPos.x,l.pos.y=n.mPos.y,l.pos.z=n.mPos.z,l.angle=n.mAngle,n.mSegmentStream.push(l)}return i}return q(r,[{key:"runTransition",value:function(){qe(je(r.prototype),"runTransition",this).call(this)}},{key:"run",value:function(){var e=this;if(e.getEnabled()){xe(e.mPos,mTarget)<10&&e.updateTarget();var t=calculate2dAngle(e.mPos,mTarget)-Ge(90);Math.abs(t)>.1&&(e.mAngle<t?e.mRotationRate+=.005:e.mAngle>t&&(e.mRotationRate-=.005)),e.mRotationRate*=.98,e.mRotationRate>2?e.mRotationRate=2:mRotationRate<-2&&(e.mRotationRate=-2);var i=new Pe(0,1,0);i=Le(i,mAngle),e.mSpeed.add(i),e.mSpeed=Re(e.mSpeed,.5),e.mSpeed.multiply(.95);var s=new dt;s.pos=mPos,s.angle=mAngle,mSegments[0].setStreamHead(s);for(var n=21;n>=0;n--){var a=e.mSegments[n];e.mSegments[n+1].setStreamHead(a.getStreamTail())}for(var o=0;o<lt;o++)e.mSegments[o].run()}qe(je(r.prototype),"run",this).call(this)}},{key:"draw",value:function(){if(8==this.getState())1&(parseInt(mStateTimer/10),10)&&this.mModel.draw(this.mPen);else if(this.getEnabled()){var e=this.mPen;if(2==this.getState()){var t=this.mScale,i=this.mPos,s=1/this.mSpawnTime,r=this.mStateTimer*s,n=r=1-r;n<0&&(n=0),n>1&&(n=1),e.a=n,this.mModel.Identity(),this.mModel.Scale(t*r*1),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),this.mModel.Identity(),this.mModel.Rotate(this.mAngle),this.mModel.Scale(t),this.mModel.Translate(i)}this.mModel.draw(e)}if(2==this.getState())for(var a=0;a<lt;a++);else for(var o=0;o<lt;o++);}},{key:"spawnTransition",value:function(){var e=this;qe(je(r.prototype),"spawnTransition",this).call(this),e.mAngle=calculate2dAngle(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos())+Ge(-90),e.updateTarget();for(var t=0;t<lt;t++){e.mSegments[t].spawnTransition();var i=new Pe(0,-.2*(t+1),0);i=Le(i,e.mAngle),e.mSegments[t].setPos(e.mPos.copy().add(i)),e.mSegments[t].setAngle(mAngle),e.mSegments[t].postSpawnTransition()}}},{key:"spawn",value:function(){qe(je(r.prototype),"spawn",this).call(this);for(var e=0;e<lt;e++)this.mSegments[e].spawn()}},{key:"hitTest",value:function(e,t){var i=qe(je(r.prototype),"hitTest",this).call(this,e,t);if(i)return i;for(var s=0;s<lt;s++){var n=this.mSegments[s],a=new Pe(0,0,0);if(n.getModel().mMatrix.TransformVertex(new Pe(0,0,0),a),xe(e,a)<t+n.getRadius())return n}return null}},{key:"destroyTransition",value:function(){qe(je(r.prototype),"destroyTransition",this).call(this);for(var e=0;e<lt;e++)this.mSegments[e].destroyTransition()}},{key:"destroy",value:function(){qe(je(r.prototype),"destroy",this).call(this);for(var e=0;e<lt;e++)this.mSegments[e].destroy()}},{key:"indicateTransition",value:function(){qe(je(r.prototype),"indicateTransition",this).call(this);for(var e=0;e<lt;e++)this.mSegments[e].setState(8)}},{key:"updateTarget",value:function(){var e=Math.random()*(2*PI);this.mTarget=new Pe(40,0,0),this.mTarget=Le(this.mTarget,e),this.mTarget.add(this.mPos);var t=this.mGrid.extentX()-1-15,i=this.mGrid.extentY()-1-15;this.mTarget.x<15?this.mTarget.x=15:this.mTarget.x>t&&(this.mTarget.x=t),this.mTarget.y<15?this.mTarget.y=15:this.mTarget.y>i&&(this.mTarget.y=i)}}]),r}(Fe);var ht=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;return U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=1.5,i.mRadius=2.5,i.mEdgeBounce=!0,i.mScoreValue=50,i.mPen=new Ne(1,.5,.5,.7,4),i.mType=Oe,i.setState(0),i.mActivated=!1,i.mDestroyTime=0,i.mAnimationIndex=0,i.mAnimationSpeed=0,i.mAnimationDepth=0,i.mAttractorStrengthIndex=0,i.mStrength=1,i.mBalance=0,i.mBalanceRate=0,i.mHumLoopSoundId=-1,i}return q(r,[{key:"runTransition",value:function(){qe(je(r.prototype),"runTransition",this).call(this)}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this),this.mActivated=!1,this.mRadius=2.5,this.mStrength=1.5,this.mBalance=0,this.mBalanceRate=0,this.mFeedCount=0,this.mDestroyTime=0,this.mAnimationIndex=0,this.mAnimationSpeed=0,this.mAnimationDepth=0,this.mAttractorStrengthIndex=0,this.mBalance=0,this.mPoints=150,this.mHumSpeed=this.mStrength*this.mStrength/2,this.mHumSpeedTarget=this.mHumSpeed,this.mHumLoopSoundId=-1}},{key:"destroyTransition",value:function(){qe(je(r.prototype),"destroyTransition",this).call(this),this.mHumLoopSoundId=-1;for(var e=0;e<100;e++){var t=new Pe(this.mPos.x,this.mPos.y,this.mPos.z),i=new Pe(0,0,0),s=e/200*1e3,n=2*PI,a=300*Math.random(),o=this.mPen;o.lineRadius=5,z.mParticles.emitter(t,i,s,n,1,o,a)}var m=this.mAttractors.getAttractor();m&&(m.strength=20,m.zStrength=0,m.radius=30,m.pos=this.mPos,m.enabled=!0,m.attractsParticles=!1)}},{key:"indicateTransition",value:function(){qe(je(r.prototype),"indicateTransition",this).call(this),-1!=this.mHumLoopSoundId&&this.mSound.stopTrack(this.mHumLoopSoundId),this.mHumLoopSoundId=-1}},{key:"hitTest",value:function(e,t){return xe(e,mPos)<t+this.getRadius()?this:null}},{key:"feed",value:function(e){this.mPoints+=2*e,this.mStrength+=.05,this.mBalanceRate+=.2,++this.mFeedCount}},{key:"getRadius",value:function(){var e;return this.mActivated?(e=this.mRadius+Math.sin(mAnimationIndex)*mAnimationDepth,e*=this.mStrength+.1*this.mBalance):e=this.mRadius,e}},{key:"run",value:function(){var e=this;if(e.mAnimationSpeed=.5*e.mStrength,e.mAnimationDepth=.2,e.mSpeed=Re(e.mSpeed,.2),e.mSpeed.multiply(.96),e.mDrift=Re(e.mDrift,.8),e.mHumSpeedTarget=e.mStrength*e.mStrength/2,e.mHumSpeed<e.mHumSpeedTarget?e.mHumSpeed+=.01:mHumSpeed>e.mHumSpeedTarget&&(e.mHumSpeed-=.01),e.mActivated){if(e.mStrength+=3e-4,-1==e.mHumLoopSoundId&&(e.mHumLoopSoundId=e.mSound.playTrackGroup(SOUNDID_GRAVITYWELL_HUMLOOPA,SOUNDID_GRAVITYWELL_HUMLOOPF)),-1!=e.mHumLoopSoundId&&e.mSound.setTrackSpeed(e.mHumLoopSoundId,e.mHumSpeed+.2),e.mStrength>2.2&&(e.mSound.isTrackPlaying(SOUNDID_GRAVITYWELLALERT)||e.mSound.playTrack(SOUNDID_GRAVITYWELLALERT)),e.mStrength>2.3){e.setState(5),e.mSound.playTrack(SOUNDID_GRAVITYWELLEXPLODE);for(var t=0;t<20;t++){var i=e.mEnemies.getUnusedEnemyOfType(Ye);if(i){var s=10*Math.random(),n=Math.random()*(2*PI),a=new Pe(s,0,0);a=Le(a,n),i.setDrift(new Pe(100*a.x,100*a.y,0)),i.setPos(a.copy().add(mPos)),i.setState(1)}}return}e.mBalance>0?e.mBalanceRate-=.01:e.mBalance<0&&(e.mBalanceRate+=.01),e.mBalanceRate*=.95,e.mBalance+=e.mBalanceRate,e.mBalance*=.95;var o=100*Math.random()<10?-1:1,m=e.mAttractors.getAttractor();m&&(m.strength=-25*o,m.zStrength=0,m.radius=10,m.pos=e.mPos,m.enabled=!0,m.attractsParticles=!0)}var l=calculate2dAngle(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),d=new Pe(1,0,0);d=Le(d,l),e.mSpeed.add(d).multiply(.002),e.mSpeed.multiply(.98),e.mAnimationIndex+=e.mAnimationSpeed,qe(je(r.prototype),"run",this).call(this);var u=e.getRadius(),h=e.getRadius(),c=e.mGrid.extentX()-e.getRadius()-1,f=e.mGrid.extentY()-e.getRadius()-1;e.mPos.x<u?(e.mPos.x=u,e.mSpeed.x=-e.mSpeed.x):e.mPos.x>c&&(e.mPos.x=c,e.mSpeed.x=-e.mSpeed.x),e.mPos.y<h?(e.mPos.y=h,e.mSpeed.y=-e.mSpeed.y):e.mPos.y>f&&(e.z.mPos.y=f,e.mSpeed.y=-e.mSpeed.y)}},{key:"hit",value:function(e){var t=this,i=e;if(i){if(t.mActivated){t.mSound.playTrack(SOUNDID_GRAVITYWELLHIT),t.mStrength*=.985;var s=!1;if(t.mStrength<.7){if(t.setState(5),t.mSound.playTrack(SOUNDID_GRAVITYWELLDESTROYED),i){if(t.mPoints){var r=t.getPos();0==i.mPlayerSource?t.mPlayers.mPlayer1.addKillAtLocation(t.mPoints,r):1==i.mPlayerSource&&t.mPlayers.mPlayer2.addKillAtLocation(t.mPoints,r),s=!0}}else s=!0;if(s)for(var n=0;n<t.mFeedCount;n++)if(100*Math.random()<50)if(100*Math.random()<50){var a=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_MEDIUM);a&&(a.setState(1),a.setPos(t.getPos()),a.setRotationRate(.01*Math.random()-.05),a.setSpeed(new Pe(.1*Math.random()-.05,.1*Math.random()-.05,0)),a.setDrift(new Pe(1*Math.random()-.5,1*Math.random()-.5,0)))}else for(var o=0;o<2;o++){var m=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_SMALL);m&&(m.setState(1),m.setPos(t.getPos()),m.setRotationRate(.01*Math.random()-.05),m.setSpeed(new Pe(.1*Math.random()-.05,.1*Math.random()-.05,0)),m.setDrift(new Pe(1*Math.random()-.5,1*Math.random()-.5,0)))}else{var l=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_LARGE);l&&(l.setState(1),l.setPos(t.getPos()),l.setRotationRate(.01*Math.random()-.05),l.setSpeed(new Pe(.1*Math.random()-.05,.1*Math.random()-.05,0)),l.setDrift(new Pe(1*Math.random()-.5,1*Math.random()-.5,0)))}}}else t.mActivated=!0,t.mGameMode==GAMEMODE_PLAYING&&-1==t.mHumLoopSoundId&&(t.mHumLoopSoundId=t.mSound.playTrackGroup(SOUNDID_GRAVITYWELL_HUMLOOPA,SOUNDID_GRAVITYWELL_HUMLOOPF)),t.mBalance=2,t.mBalanceRate=0;var d;t.mActivated?(d=t.mRadius+Math.sin(mAnimationIndex)*mAnimationDepth,d*=t.mStrength+.1*t.mBalance):d=t.mRadius;for(var u=0;u<360;u++)if(100*Math.random()<10){var h=Ge(u),c=new Pe(0,d+1,0);(c=Le(c,h)).add(t.mPos);var f=new Pe(0,h,0),y=t.mPen;y.r=Math.random()+.5,y.g=Math.random()+.5,y.b=Math.random()+.5,y.a=.2,y.lineRadius=5,t.mParticles.emitter(c,f,30,0,1,y,100,!1,!0,.95)}t.mBalance-=.2}else if(e&&e.getType()==Oe){t.mActivated=!0,t.mBalance=2,t.mBalanceRate=0;var v=t.mAttractors.getAttractor();v&&(v.strength=20,v.zStrength=0,v.radius=20,v.pos=t.mPos,v.enabled=!0,v.attractsParticles=!1)}else t.destroyTransition()}},{key:"draw",value:function(){var e=this;if((8!=e.getState()||1&(parseInt(mStateTimer/10),10))&&e.getEnabled()){if(2==e.getState()){var t=e.mRadius,i=1/e.mSpawnTime,s=e.mStateTimer*i,r=s=1-s;r<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*s*1,e.drawRing(),(r=1-(s+=.25))<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*s*4,e.drawRing(),(r=1-(s+=.25))<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*s*7,e.drawRing(),e.mRadius=t}e.drawRing()}}},{key:"drawRing",value:function(){var e=8!=this.getState()&&this.mActivated;e?(this.mRadius+Math.sin(this.mAnimationIndex)*this.mAnimationDepth,this.mStrength+.1*this.mBalance):this.mRadius,e&&this.mState,2!=this.mState&&this.mPass,e&&this.mState}}]),r}(Fe);var ct=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(){var e;U(this,r),(e=s.call(this)).mScale=1,e.mRadius=1.2,e.mEdgeBounce=!0,e.mSpawnTime=0,e.mScoreValue=50,e.mDestroyTime=0,e.mPen=new Ne(.5,.6,1,.7,12),e.mType=Ye,e.setState(0),e.mModel.mNumVertex=16,e.mModel.mVertexList=[];for(var t=6.28318/e.mModel.mNumVertex,i=e.mScale.x*e.mRadius,n=0,a=0;n<e.mModel.mNumVertex;a+=t,n++)e.mModel.mVertexList[n]=new Pe(i*Math.cos(a),i*Math.sin(a));for(e.mModel.mNumEdges=4,e.mModel.mEdgeList=[],n=0;n<e.mModel.mNumEdges;n++)e.mModel.mEdgeList.push(new De);for(n=0;n<e.mModel.mNumEdges-1;++n)e.mModel.mEdgeList[n].from=n,e.mModel.mEdgeList[n].to=n+1;return e.mModel.mEdgeList[n].from=n,e.mModel.mEdgeList[n].to=0,e}return q(r,[{key:"run",value:function(){if(this.getEnabled()){var e=Ee(this.mPos,this.mPlayers.getPlayerClosestToPosition(mPos).getPos()),t=new Pe(1,0,0);t=Le(t,e),mSpeed.add(t).multiply(.1),mSpeed=Re(mSpeed,.6*mAggression)}}},{key:"spawnTransition",value:function(){qe(je(r.prototype),"spawnTransition",this).call(this),this.mDrift.x=4*Math.random()-2,this.mDrift.y=4*Math.random()-2}}]),r}(Fe);var ft=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(){var e;return U(this,r),(e=s.call(this)).setState(0),e.mEdgeBounce=!0,e.mLifetime=0,e.mPen=new Ne(1,1,0,.7,12),e}return q(r,[{key:"run",value:function(){var e=this;if(--e.mLifetime,e.mLifetime<=0&&(e.mState=0),e.getEnabled()){var t=e.mPlayers.getPlayerClosestToPosition(e.mPos);if(t){var i=xe(t.getPos(),e.mPos);if(i<17)if(e.mLifetime=250,i<4)e.mState=0,t.addGeom(e.mScoreValue);else{var s=Ee(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),n=new Pe(2,0,0);n=Le(n,s),e.mSpeed.add(n).multiply(.2),e.mSpeed.multiply(.8)}}}qe(je(r.prototype),"run",this).call(this)}},{key:"draw",value:function(){var e=.7;this.mLifetime<100&&(e=this.mLifetime/200*.7),this.mLifetime<200&&this.mLifetime/2&1&&(e/=2),this.mPen=new Ne(1,1,0,e,12),qe(je(r.prototype),"draw",this).call(this)}},{key:"hit",value:function(e){}},{key:"spawnTransition",value:function(){this.mLifetime=350,this.mState=4}}]),r}(Fe);var yt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=.4,i.mRadius=.5,i.mScoreValue=10,i.mType=ze;var n=0;i.mModel.mNumVertex=3,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(0,1),i.mModel.mVertexList[n++]=new Pe(1,-1),i.mModel.mVertexList[n++]=new Pe(-1,-1),i.mModel.mNumEdges=3,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=0,i}return q(r)}(ft);var vt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=.45,i.mRadius=.5,i.mScoreValue=20,i.mType=Xe;var n=0;i.mModel.mNumVertex=4,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(-2,0),i.mModel.mVertexList[n++]=new Pe(0,1),i.mModel.mVertexList[n++]=new Pe(2,0),i.mModel.mVertexList[n++]=new Pe(0,-1),i.mModel.mNumEdges=4,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=3,i.mModel.mEdgeList[n++].to=0,i}return q(r)}(ft);var pt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(e,t){var i;U(this,r),(i=s.call(this)).mPlayers=e,i.mEnemies=t,i.mParticles=t.mParticles,i.mScale=.4,i.mRadius=.5,i.mScoreValue=50,i.mType=He;var n=0;i.mModel.mNumVertex=12,i.mModel.mVertexList=[],i.mModel.mVertexList[n++]=new Pe(-.5,-2),i.mModel.mVertexList[n++]=new Pe(-.5,-.5),i.mModel.mVertexList[n++]=new Pe(-2,-.5),i.mModel.mVertexList[n++]=new Pe(-2,.5),i.mModel.mVertexList[n++]=new Pe(-.5,.5),i.mModel.mVertexList[n++]=new Pe(-.5,2),i.mModel.mVertexList[n++]=new Pe(.5,2),i.mModel.mVertexList[n++]=new Pe(.5,.5),i.mModel.mVertexList[n++]=new Pe(2,.5),i.mModel.mVertexList[n++]=new Pe(2,-.5),i.mModel.mVertexList[n++]=new Pe(.5,-.5),i.mModel.mVertexList[n++]=new Pe(.5,-2),i.mModel.mNumEdges=12,i.mModel.mEdgeList=[];for(var a=0;a<i.mModel.mNumEdges;a++)i.mModel.mEdgeList.push(new De);return n=0,i.mModel.mEdgeList[n].from=0,i.mModel.mEdgeList[n++].to=1,i.mModel.mEdgeList[n].from=1,i.mModel.mEdgeList[n++].to=2,i.mModel.mEdgeList[n].from=2,i.mModel.mEdgeList[n++].to=3,i.mModel.mEdgeList[n].from=3,i.mModel.mEdgeList[n++].to=4,i.mModel.mEdgeList[n].from=4,i.mModel.mEdgeList[n++].to=5,i.mModel.mEdgeList[n].from=5,i.mModel.mEdgeList[n++].to=6,i.mModel.mEdgeList[n].from=6,i.mModel.mEdgeList[n++].to=7,i.mModel.mEdgeList[n].from=7,i.mModel.mEdgeList[n++].to=8,i.mModel.mEdgeList[n].from=8,i.mModel.mEdgeList[n++].to=9,i.mModel.mEdgeList[n].from=9,i.mModel.mEdgeList[n++].to=10,i.mModel.mEdgeList[n].from=10,i.mModel.mEdgeList[n++].to=11,i.mModel.mEdgeList[n].from=11,i.mModel.mEdgeList[n++].to=0,i}return q(r)}(ft);var gt,St,Pt=function(e){$e(r,e);var t,i,s=(t=r,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,s=je(t);if(i){var r=je(this).constructor;e=Reflect.construct(s,arguments,r)}else e=s.apply(this,arguments);return Ke(this,e)});function r(){var e;U(this,r),(e=s.call(this)).mScale=1,e.mRadius=1,e.mEdgeBounce=!1,e.mGridBound=!1,e.mTimeToLive=0,e.mSpawnTime=0,e.mDestroyTime=0,e.mType=17,e.setState(0),e.mModel.mNumVertex=2,e.mModel.mVertexList=[],e.mModel.mVertexList[0]=new Pe(0,0),e.mModel.mVertexList[1]=new Pe(0,0),e.mModel.mNumEdges=1,e.mModel.mEdgeList=[];for(var t=0;t<e.mModel.mNumEdges;t++)e.mModel.mEdgeList.push(new De);return e.mModel.mEdgeList[0].from=0,e.mModel.mEdgeList[0].to=1,e.mPen=new Ne(1,0,0,1,1),e}return q(r,[{key:"spawnTransition",value:function(){this.setState(4),this.mTimeToLive=100,this.run()}},{key:"spawn",value:function(){}},{key:"runTransition",value:function(){}},{key:"run",value:function(){var e,t,i,s,n,a,o;this.mTimeToLive<50&&(this.mPen.a*=.95,e=this.mModel.mVertexList[0],t=this.mModel.mVertexList[1],.97,i=Ee(e,t)-Ge(90),s=.97*xe(e,t),n=new Pe((e.x+t.x)/2,(e.y+t.y)/2,0),a=new Pe(0,s/2,0),o=new Pe(0,-s/2,0),a=Le(a,i),o=Le(o,i),a+=new Pe(a.x+n.x,a.y+n.y,a.z+n.z),o+=new Pe(o.x+n.x,o.y+n.y,o.z+n.z),e.x=a.x,e.y=a.y,t.x=o.x,t.y=o.y,xe(this.mModel.mVertexList[0],this.mModel.mVertexList[1])<.1&&(this.mTimeToLive=0)),--this.mTimeToLive<=0&&(this.mTimeToLive=0,this.setState(6)),this.mSpeed.multiply(.98),qe(je(r.prototype),"run",this).call(this)}},{key:"destroyTransition",value:function(){}},{key:"destroy",value:function(){qe(je(r.prototype),"destroy",this).call(this)}},{key:"draw",value:function(){qe(je(r.prototype),"draw",this).call(this)}},{key:"addEndpoints",value:function(e,t){this.mModel.mVertexList[0]=new Pe(e.x,e.y,e.z),this.mModel.mVertexList[1]=new Pe(t.x,t.y,t.z)}}]),r}(Fe),Mt=function(e,t,i){switch(e){case 1:return new tt;case 2:return new it;case 3:return new Je;case 4:return new st(t,i);case 5:return new rt(t,i);case 6:return new nt(t,i);case 7:return new at(t,i);case 8:return new ot(t,i);case 9:return new mt(t,i);case 10:return new ut(t,i);case Oe:return new ht(t,i);case Ye:return new ct(t,i);case ze:return new yt(t,i);case Xe:return new vt(t,i);case He:return new pt(t,i);case 17:return new Pt;default:return new Fe}return 0},wt=function(){function e(){U(this,e),this.start=null,this.end=null}return q(e,[{key:"makeNode",value:function(){return{data:null,next:null}}},{key:"add",value:function(e){null===this.start?(this.start=this.makeNode(),this.end=this.start):(this.end.next=this.makeNode(),this.end=this.end.next),this.end.data=e}},{key:"remove",value:function(e){for(var t=this.start,i=this.start;null!==t;){if(e===t.data)return t===this.start?void(this.start=t.next):(t==this.end&&(this.end=i),void(i.next=t.next));i=t,t=t.next}}}]),e}(),xt=1092,Et=250,Lt=function(){function e(t,i){U(this,e);var s=this,r=0;s.mPlayers=t,s.mParticles=i,s.mEnemies=[],s.mLines=[],s.mActiveEnemies=new wt,s.idxWandererStart=r;for(var n=100,a=0;a<n;a++)r++,s.mEnemies.push(Mt(5,s.mPlayers,s));s.idxWandererEnd=r-1,s.idxGruntStart=r,n=100;for(var o=0;o<n;o++)r++,s.mEnemies.push(Mt(4,s.mPlayers,s));s.idxGruntEnd=r-1,s.idxSpinnerStart=r,n=25;for(var m=0;m<n;m++)r++,s.mEnemies.push(Mt(7,s.mPlayers,s));s.idxSpinnerEnd=r-1,s.idxTinySpinnerStart=r,n=50;for(var l=0;l<n;l++)r++,s.mEnemies.push(Mt(8,s.mPlayers,s));s.idxTinySpinnerEnd=r-1,s.idxWeaverStart=r,n=100;for(var d=0;d<n;d++)r++,s.mEnemies.push(Mt(6,s.mPlayers,s));s.idxWeaverEnd=r-1,s.idxSnakeStart=r,n=50;for(var u=0;u<n;u++)r++,s.mEnemies.push(Mt(10,s.mPlayers,s));s.idxSnakeEnd=r-1,s.idxMayflyStart=r,n=200;for(var h=0;h<n;h++)r++,s.mEnemies.push(Mt(9,s.mPlayers,s));s.idxMayflyEnd=r-1,s.idxProtonStart=r,n=200;for(var c=0;c<n;c++)r++,s.mEnemies.push(Mt(Ye,s.mPlayers,s));s.idxProtonEnd=r-1,s.idxGeomSmallStart=r,n=100;for(var f=0;f<n;f++)r++,s.mEnemies.push(Mt(ze,s.mPlayers,s));s.idxGeomSmallEnd=r-1,s.idxGeomMediumStart=r,n=100;for(var y=0;y<n;y++)r++,s.mEnemies.push(Mt(Xe,s.mPlayers,s));s.idxGeomMediumEnd=r-1,s.idxGeomLargeStart=r,n=100;for(var v=0;v<n;v++)r++,s.mEnemies.push(Mt(He,s.mPlayers,s));s.idxGeomLargeEnd=r-1;for(var p=r;p<xt;p++)s.mEnemies[p]=Mt(0);for(var g=0;g<Et;g++)s.mLines[g]=Mt(17)}return q(e,[{key:"run",value:function(){for(var e=this,t=0;t<xt;t++)switch(e.mEnemies[t].getState()){case 1:e.mActiveEnemies.add(e.mEnemies[t]),e.mEnemies[t].spawnTransition();break;case 2:e.mEnemies[t].spawn();break;case 3:e.mEnemies[t].runTransition();break;case 4:e.mEnemies[t].run();break;case 5:e.mActiveEnemies.remove(e.mEnemies[t]),e.mEnemies[t].destroyTransition();break;case 6:e.mEnemies[t].destroy();break;case 7:e.mEnemies[t].indicateTransition();break;case 8:e.mEnemies[t].indicating()}for(var i=0;i<Et;i++)switch(e.mLines[i].getState()){case 1:e.mLines[i].spawnTransition();break;case 2:e.mLines[i].spawn();break;case 3:e.mLines[i].runTransition();break;case 4:e.mLines[i].run();break;case 5:e.mLines[i].destroyTransition();break;case 6:e.mLines[i].destroy()}for(var s=0;s<xt;s++)if(e.mEnemies[s].getType()!=ze&&e.mEnemies[s].getType()!=Xe&&e.mEnemies[s].getType()!=He&&4==e.mEnemies[s].getState())for(var r=0;r<xt;r++)if(4==e.mEnemies[r].getState()&&r!=s){var n=e.mEnemies[s],a=e.mEnemies[r];if(xe(n.getPos(),a.getPos())<n.getRadius()+a.getRadius()){var o=Ee(a.getPos(),n.getPos()),m=new Pe(1,0,0);m=Le(m,o),n.getType()==Oe?n&&n.mActivated&&n.setSpeed(n.getSpeed().add(m).multiply(.2)):n.setPos(n.getPos().add(m).multiply(.02))}}}},{key:"draw",value:function(){for(var e=this,t=0;t<xt;t++)e.mEnemies[t].getEnabled()&&e.mEnemies[t].draw();for(var i=0;i<Et;i++)e.mLines[i].getEnabled()&&e.mLines[i].draw()}},{key:"hitTestEnemiesAtPosition",value:function(e,t,i){for(var s=this.mActiveEnemies.start;null!==s;){if(4===s.data.getState()){var r=s.data.hitTest(e,t);if(r)return r}s=s.next}return null}},{key:"getNumActiveEnemiesOfType",value:function(e){var t,i,s=this;switch(e){case 5:t=s.idxWandererStart,i=s.idxWandererEnd;break;case 4:t=s.idxGruntStart,i=s.idxGruntEnd;break;case 7:t=s.idxSpinnerStart,i=s.idxSpinnerEnd;break;case 8:t=s.idxTinySpinnerStart,i=s.idxTinySpinnerEnd;break;case 6:t=s.idxWeaverStart,i=s.idxWeaverEnd;break;case 10:t=s.idxSnakeStart,i=s.idxSnakeEnd;break;case Oe:t=s.idxBlackHoleStart,i=s.idxBlackHoleEnd;break;case 9:t=s.idxMayflyStart,i=s.idxMayflyEnd;break;case Ye:t=idxProtonStart,i=idxProtonEnd;break;case ze:t=s.idxGeomSmallStart,i=s.idxGeomSmallEnd;break;case Xe:t=s.idxGeomMediumStart,i=s.idxGeomMediumEnd;break;case He:t=s.idxGeomLargeStart,i=s.idxGeomLargeEnd}for(var r=0,n=t;n<=i;n++)0!==s.mEnemies[n].getState()&&++r;return r}},{key:"getUnusedEnemyOfType",value:function(e){var t,i,s=this;switch(e){case 5:t=s.idxWandererStart,i=s.idxWandererEnd;break;case 4:t=s.idxGruntStart,i=s.idxGruntEnd;break;case 7:t=s.idxSpinnerStart,i=s.idxSpinnerEnd;break;case 8:t=s.idxTinySpinnerStart,i=s.idxTinySpinnerEnd;break;case 6:t=s.idxWeaverStart,i=s.idxWeaverEnd;break;case 10:t=s.idxSnakeStart,i=s.idxSnakeEnd;break;case Oe:t=s.idxBlackHoleStart,i=s.idxBlackHoleEnd;break;case 9:t=s.idxMayflyStart,i=s.idxMayflyEnd;break;case Ye:t=s.idxProtonStart,i=s.idxProtonEnd;break;case ze:t=s.idxGeomSmallStart,i=s.idxGeomSmallEnd;break;case Xe:t=s.idxGeomMediumStart,i=s.idxGeomMediumEnd;break;case He:t=s.idxGeomLargeStart,i=s.idxGeomLargeEnd}for(var r=t;r<=i;r++)if(0===s.mEnemies[r].getState())return s.mEnemies[r];return null}},{key:"getUnusedLine",value:function(){for(var e=0;e<Et;e++)if(0===this.mLines[e].getState())return this.mLines[e];return null}},{key:"explodeEntity",value:function(e){var t=e.getModel(),i=new Pe(0,0,0),s=new Pe(0,0,0);t.mMatrix.TransformVertex(i,s);for(var r=t.mNumEdges,n=0;n<r;n++){var a=this.getUnusedLine();if(a){var o=e.getPen();a.setPen(o);var m=t.mVertexList[t.mEdgeList[n].from],l=t.mVertexList[t.mEdgeList[n].to],d=new Pe((m.x+l.x)/2,(m.y+l.y)/2,0);a.addEndpoints(m,l),a.setPos(s),a.setScale(e.getScale()),a.setAngle(e.getAngle());var u=Ee(new Pe(0,0,0),d),h=2*Math.random()-1,c=new Pe(0,.2,0);return(c=Le(c,u+h)).add(e.getDrift().multiply(.1)),a.setSpeed(c),void a.setState(1)}}}},{key:"disableAllEnemies",value:function(){for(var e=0;e<xt;e++)this.mEnemies[e].setState(0),this.mEnemies[e].incGenId()}}]),e}(),Tt=q((function e(){U(this,e),this.pos=new Pe,this.radius=1,this.thickness=1,this.speed=1,this.timeToLive=100,this.fadeStep=1,this.mPen=new Ne})),kt=function(){function e(t,i,s){U(this,e);var r=this;r.mParticles=i,r.mAttractors=t,r.mEnemies=s,r.mNumRings=20,r.mRings=[];for(var n=0;n<r.mNumRings;n++)r.mRings.push(new Tt);if(r.mRings)for(var a=0;a<r.mNumRings;a++)r.mRings[a].timeToLive=0}return q(e,[{key:"run",value:function(){for(var e=this,t=0;t<e.mNumRings;t++)if(e.mRings[t].timeToLive>0){if(--e.mRings[t].timeToLive,e.mRings[t].radius+=e.mRings[t].speed,e.mRings[t].thickness+=.03,e.mRings[t].radius<40){var i=e.mAttractors.getAttractor();i&&(i.strength=5,i.zStrength=0,i.radius=e.mRings[t].radius,i.pos=e.mRings[t].pos,i.enabled=!0,i.attractsParticles=!0)}for(var s=0;s<xt;s++)if(0!==e.mEnemies.mEnemies[s].getState()&&8!=e.mEnemies.mEnemies[s].getState()&&7!=e.mEnemies.mEnemies[s].getState()&&5!=e.mEnemies.mEnemies[s].getState()&&6!=e.mEnemies.mEnemies[s].getState()){var r=xe(e.mRings[t].pos,e.mEnemies.mEnemies[s].getPos());r>e.mRings[t].radius-10&&r<e.mRings[t].radius&&e.mEnemies.mEnemies[s].hit(null)}}}},{key:"draw",value:function(){for(var e=this,t=0;t<e.mNumRings;t++)if(e.mRings[t].timeToLive>0){var i=e.mRings[t];i.mPen.a-=i.fadeStep,i.mPen.a<=0?i.mPen.a=0:i.mPen.a>1&&(i.mPen.a=1),M(i.mPen.lineRadius),x(i.mPen.r,i.mPen.g,i.mPen.b,i.mPen.a),E(1);for(var s=0;s<360;s+=.5){var r=Ge(s),n=new Pe(0,i.radius,0);n=Le(n,r);var a=new Pe(0,i.radius+i.thickness,0);a=Le(a,r),n.add(i.pos),a.add(i.pos),L(n.x,n.y,0),L(a.x,a.y,0)}k()}}},{key:"startBomb",value:function(e,t,i,s,r,n){for(var a=this,o=null,m=0;m<a.mNumRings;m++)a.mRings[m].timeToLive<=0&&(o=a.mRings[m]);if(o){o.pos=e,o.radius=t,o.thickness=i,o.speed=s,o.timeToLive=r,o.fadeStep=1/o.timeToLive,o.mPen=n;var l=new Pe(0,0,0);r=100,o.mPen.lineRadius=5,o.mPen.a=.3,a.mParticles.emitter(e,l,s,6.28318,100,o.mPen,r,!1,!1,1,!0)}}}]),e}(),bt=function(){function e(t,i){U(this,e),this.mPlayers=t,this.mGrid=i,this.mCurrentPos=new Pe,this.mTargetPos=new Pe}return q(e,[{key:"center",value:function(){this.mCurrentZoom=50,this.mTargetZoom=50,this.mZoomOverride=0,this.mTargetPos=new Pe(this.mGrid.extentX()-.5,this.mGrid.extentY()-.5,this.mTargetZoom)}},{key:"followPlayer",value:function(){var e,t=(e=this.mPlayers.mPlayer1.getPos()).x/this.mGrid.extentX(),i=e.y/this.mGrid.extentY();this.mTargetPos.x=t*(this.mGrid.extentX()+-40)- -20,this.mTargetPos.y=i*(this.mGrid.extentY()+-40)- -20}},{key:"run",value:function(){this.mCurrentZoom+=(this.mTargetZoom-this.mCurrentZoom)/20,this.mCurrentPos.x+=(this.mTargetPos.x-this.mCurrentPos.x)/16,this.mCurrentPos.y+=(this.mTargetPos.y-this.mCurrentPos.y)/16,this.mCurrentPos.z=this.mCurrentZoom+this.mZoomOverride}}]),e}(),_t=new Pe(0,0,1),Gt=function(e){return 0!=e.z},Rt=function(e,t,i){return i.mGridInfo.grid[e+t*i.mGridInfo.divsX]},It=q((function e(t,i){U(this,e),this.pos=H(t,i),this.vel=0,this.isAnchor=!1,this.isVisible=!1})),At=function(){function e(t){U(this,e),this.mAttractors=t,this.mBrightness=0,this.mFadeStatus=0,this.mLevel=0,this.q=30,this.damping=2.6,this.mGridInfo={grid:null},this.initGrid(0)}return q(e,[{key:"initGrid",value:function(e){var t=this;t.mGridInfo.grid&&(t.mGridInfo.grid=null);var i=e>=14;if(e%=14,i&&0==e&&(e=1),0==[0,1,12,13,2,4,11,3,5,8,15,14,9,6][e]){var s=new Pe(0,0),r=[s,new Pe(0,8),new Pe(15,8),new Pe(15,0),s];t.mGridInfo.poly=r,t.mGridInfo.polyPoints=5,t.mGridInfo.scale=9,t.mGridInfo.divsX=81,t.mGridInfo.divsY=41,t.mGridInfo.brightGridColor=new Ne(.2,.2,1,.4,0),t.mGridInfo.dimGridColor=new Ne(.2,.2,1,.12,0)}t.mGridPointScaleX=0,t.mGridPointScaleY=0;for(var n=0,a=0,o=t.mGridInfo.poly[0].copy().multiply(t.mGridInfo.scale),m=1;m<t.mGridInfo.polyPoints;m++){var l=t.mGridInfo.poly[m].copy().multiply(t.mGridInfo.scale);Gt(l)?(m++,o=t.mGridInfo.poly[m].copy().multiply(t.mGridInfo.scale)):(o.x>n&&(n=o.x),l.x>n&&(n=l.x),o.y>a&&(a=o.y),l.y>a&&(a=l.y),o=l)}t.mGridExtentX=n,t.mGridExtentY=a,t.mGridPointScaleX=n/(t.mGridInfo.divsX-1),t.mGridPointScaleY=a/(t.mGridInfo.divsY-1),t.mGridInfo.grid=[];for(var d=0,u=t.mGridInfo.divsX*t.mGridInfo.divsY;d<u;d++)t.mGridInfo.grid.push(new It);for(var h=0;h<t.mGridInfo.divsY;++h)for(var c=0;c<t.mGridInfo.divsX;++c)Rt(c,h,t).pos=new Pe(c,h,0),Rt(c,h,t).vel=new Pe(0,0,0),Rt(c,h,t).isAnchor=!1;for(var f=0;f<t.mGridInfo.divsY;++f)for(var y=0;y<t.mGridInfo.divsX;++y){var v=new Pe(y*t.mGridPointScaleX,f*t.mGridPointScaleX,0);Rt(y,f,t).isVisible=be(v,t.mGridInfo.poly,t.mGridInfo.polyPoints,t.mGridInfo.scale)}for(var p=0;p<t.mGridInfo.divsY;++p)for(var g=0;g<t.mGridInfo.divsX;++g)for(var S=new Pe(g*t.mGridPointScaleX,p*t.mGridPointScaleX,0),P=t.mGridInfo.poly[0].copy().multiply(t.mGridInfo.scale),M=1;M<t.mGridInfo.polyPoints;M++){var w=t.mGridInfo.poly[M].copy().multiply(t.mGridInfo.scale);Gt(w)?(M++,P=t.mGridInfo.poly[M].copy().multiply(t.mGridInfo.scale)):(_e(P,w,S)<1&&(Rt(g,p,t).isVisible=!0,Rt(g,p,t).isAnchor=!0),P=w)}for(var x=[],E=0;E<300;++E)x.push(H());t.mGridInfo.polyInner=x;for(var L=t.getNumShapes(),T=0;T<L;T++){var k=void 0,b=void 0,_=t.getShapeIndexes(T,k,b);k=_.start,b=_.end;var G=void 0;for(G=k;G<=b;G++){var R=new Pe(t.mGridInfo.poly[G<=0?b:G-1]),I=new Pe(t.mGridInfo.poly[G]),A=new Pe(t.mGridInfo.poly[G>=b?k:G+1]),V=Ee(R,A)+Ge(90),B=new Pe(-.2,0,0);B=Le(B,V);var N=new Pe(I.x+B.x,I.y+B.y,I.z);t.mGridInfo.polyInner[G]=N}var C=t.mGridInfo.polyInner[k],D=t.mGridInfo.polyInner[b],W=new Pe((C.x+D.x)/2,(C.y+D.y)/2,0);t.mGridInfo.polyInner[k]=W,t.mGridInfo.polyInner[b]=W}for(var O=0;O<t.mGridInfo.polyPoints;O++){var Y=t.mGridInfo.poly[O].copy().multiply(t.mGridInfo.scale);Gt(Y)&&(t.mGridInfo.polyInner[O]=_t)}}},{key:"getNumShapes",value:function(){for(var e=this,t=1,i=0;i<e.mGridInfo.polyPoints;i++){var s=e.mGridInfo.poly[i].copy().multiply(e.mGridInfo.scale);Gt(s)&&++t}return t}},{key:"getShapeIndexes",value:function(e,t,i){var s=this;if(t=0,i=s.mGridInfo.polyPoints-1,1==s.getNumShapes())return{start:t,end:i};for(var r=0,n=0;n<s.mGridInfo.polyPoints;n++){var a=new Pe(s.mGridInfo.poly[n]);if(Gt(a)&&(++r,++n),r==e){t=n;break}}for(var o=t;o<s.mGridInfo.polyPoints;o++){var m=new Pe(s.mGridInfo.poly[o]);if(Gt(m)&&(++r,++o),r==e+1){i=o-2;break}}return{start:t,end:i}}},{key:"hitTest",value:function(e,t,i,s){var r=this;return i&&(i=e),s&&(s=0),0==t?!be(e,r.mGridInfo.poly,r.mGridInfo.polyPoints,r.mGridInfo.scale)&&(i&&(i=r.getHitPoint(e,t)),s&&(s=r.getHitAngle(e)),{hitPoint:i,angle:s}):!be(e,r.mGridInfo.polyInner,r.mGridInfo.polyPoints,r.mGridInfo.scale)&&(i&&(i=r.getHitPoint(e,t)),s&&(s=r.getHitAngle(e)),{hitPoint:i,angle:s})}},{key:"getHitPoint",value:function(e,t){var i=this;if(0==t){for(var s=new Pe,r=new Pe,n=Se,a=i.mGridInfo.poly[0].copy().multiply(i.mGridInfo.scale),o=1;o<i.mGridInfo.polyPoints;o++){var m=i.mGridInfo.poly[o].copy().multiply(i.mGridInfo.scale),l=_e(a,m,e);l<n&&(n=l,s=new Pe(a.x,a.y,a.z),r=new Pe(m.x,m.y,m.z)),a=new Pe(m.x,m.y,m.z)}return Ae(s,r,e)}for(var d=new Pe,u=new Pe,h=Se,c=i.mGridInfo.poly[0].copy().multiply(i.mGridInfo.scale),f=1;f<i.mGridInfo.polyPoints;f++){var y=i.mGridInfo.poly[f].copy().multiply(i.mGridInfo.scale);if(Gt(y))f++,c=i.mGridInfo.poly[f].copy().multiply(i.mGridInfo.scale);else{var v=_e(c,y,e);v<h&&(h=v,d=c,u=y),c=y}}return Ae(d,u,e)}},{key:"getHitAngle",value:function(e){for(var t,i,s=this,r=Se,n=s.mGridInfo.poly[0].copy().multiply(s.mGridInfo.scale),a=1;a<s.mGridInfo.polyPoints;a++){var o=s.mGridInfo.poly[a].copy().multiply(s.mGridInfo.scale),m=_e(n,o,e);m<r&&(r=m,t=n,i=o),n=o}return Ee(t,i)-Ge(90)}},{key:"run",value:function(){for(var e=this,t=0;t<this.mAttractors.mNumAttractors;t++){var i=e.mAttractors.mAttractors[t];if(i.enabled){var s=i.pos.x/e.mGridPointScaleX,r=i.pos.y/e.mGridPointScaleY,n=i.radius/e.mGridPointScaleX,a=s-2*n,o=s+2*n;if(a>o){var m=o;o=a,a=m}a<1?a=1:a>e.mGridInfo.divsX-2&&(a=e.mGridInfo.divsX-2),o<1?o=1:o>e.mGridInfo.divsX-2&&(o=e.mGridInfo.divsX-2);var l=r-2*n,d=r+2*n;if(l>d){var u=d;d=l,l=u}l<1?l=1:l>e.mGridInfo.divsY-2&&(l=e.mGridInfo.divsY-2),d<1?d=1:d>e.mGridInfo.divsY-2&&(d=e.mGridInfo.divsY-2),a=parseInt(a,10),o=parseInt(o,10),l=parseInt(l,10),d=parseInt(d,10);for(var h=l;h<d;++h)for(var c=a;c<o;++c){var f=Rt(c,h,e).pos,y=new Pe(i.pos.x/e.mGridPointScaleX,i.pos.y/e.mGridPointScaleY),v=Ee(f,y),p=xe(f,y),g=i.strength,S=i.zStrength,P=p;if(P<i.radius/e.mGridPointScaleX){(P*=P)<1&&(P+=.1);var M=new Pe(-P*g,0,0),w=Le(M,v);Rt(c,h,e).vel.x+=.008*w.x,Rt(c,h,e).vel.y+=.008*w.y,Rt(c,h,e).vel.z+=S}}}}switch(e.mFadeStatus){case 0:break;case 1:e.mBrightness>0&&(e.mBrightness*=.98);break;case 2:e.mBrightness<1&&(e.mBrightness+=.005)}for(var x=.1*-e.q,E=Math.exp(-.1*e.damping),L=1;L<e.mGridInfo.divsY-1;++L)for(var T=1;T<e.mGridInfo.divsX-1;++T){var k=Rt(T-1,L,e).pos,b=Rt(T+1,L,e).pos,_=Rt(T,L-1,e).pos,G=Rt(T,L+1,e).pos,R=(new Pe).add(k).add(b).add(_).add(G).multiply(.25);Rt(T,L,e).isAnchor||(Rt(T,L,e).vel.add(Rt(T,L,e).pos.copy().subtract(R).multiply(x)),Rt(T,L,e).vel.multiply(E),Rt(T,L,e).pos.add(Rt(T,L,e).vel.copy().multiply(.1)))}}},{key:"draw",value:function(){var e=this;if(!(e.mBrightness<=.01)){e.mBrightness=1;var t=e.mBrightness;M(5),w(3);for(var i=0;i<e.mGridInfo.divsY;++i){i%5==0?x(e.mGridInfo.brightGridColor.r,e.mGridInfo.brightGridColor.g,e.mGridInfo.brightGridColor.b,e.mGridInfo.brightGridColor.a*t):x(e.mGridInfo.dimGridColor.r,e.mGridInfo.dimGridColor.g,e.mGridInfo.dimGridColor.b,e.mGridInfo.dimGridColor.a*t),E(1);for(var s=0;s<e.mGridInfo.divsX-1;++s)if(Rt(s,i,e).isVisible&&Rt(s+1,i,e).isVisible){var r=Rt(s,i,e).pos,n=Rt(s+1,i,e).pos;L(r.x*e.mGridPointScaleX,r.y*e.mGridPointScaleY,0),L(n.x*e.mGridPointScaleX,n.y*e.mGridPointScaleY,0)}k()}for(var a=0;a<e.mGridInfo.divsX;++a){a%5==0?x(e.mGridInfo.brightGridColor.r,e.mGridInfo.brightGridColor.g,e.mGridInfo.brightGridColor.b,e.mGridInfo.brightGridColor.a*t):x(e.mGridInfo.dimGridColor.r,e.mGridInfo.dimGridColor.g,e.mGridInfo.dimGridColor.b,e.mGridInfo.dimGridColor.a*t),E(1);for(var o=0;o<e.mGridInfo.divsY-1;++o)if(Rt(a,o,e).isVisible&&Rt(a,o+1,e).isVisible){var m=Rt(a,o,e).pos,l=Rt(a,o+1,e).pos;L(m.x*e.mGridPointScaleX,m.y*e.mGridPointScaleY,0),L(l.x*e.mGridPointScaleX,l.y*e.mGridPointScaleY,0)}k()}x(1,1,1,1*t),M(5),E(1);for(var d=e.mGridInfo.poly[0].copy().multiply(e.mGridInfo.scale),u=1;u<e.mGridInfo.polyPoints;u++){var h=e.mGridInfo.poly[u].copy().multiply(e.mGridInfo.scale);Gt(h)?(u++,d=e.mGridInfo.poly[u].copy().multiply(e.mGridInfo.scale)):(L(d.x,d.y,0),L(h.x,h.y,0),d=h)}k()}}},{key:"startLevel",value:function(e){this.mLevel=e,this.initGrid(this.mLevel),this.mBrightness=0,this.mFadeStatus=2}},{key:"endLevel",value:function(){this.mFadeStatus=1}},{key:"extentX",value:function(){return this.mGridExtentX}},{key:"extentY",value:function(){return this.mGridExtentY}},{key:"brightness",value:function(){return this.mBrightness}}]),e}(),Vt=2e3,Bt=200,Nt=q((function e(){U(this,e),this.lastPos=new Pe,this.pos=new Pe,this.lastProjected=new Pe,this.projected=new Pe,this.color=new Ne})),Ct=function(){function e(t){U(this,e);var i=this;i.mCamera=t,i.mStars=[];for(var s=0;s<Vt;s++)i.mStars.push(new Nt),i.mStars[s].lastPos.x=i.mStars[s].pos.x=Math.random()*Bt-100,i.mStars[s].lastPos.y=i.mStars[s].pos.y=Math.random()*Bt-100,i.mStars[s].lastPos.z=i.mStars[s].pos.z=Math.random()*Bt-100,i.mStars[s].color=new Ne(Math.random()+.5,Math.random()+.5,Math.random()+.5,1,1);i.mCurrentBrightness=i.mTargetBrightness=0}return q(e,[{key:"run",value:function(){for(var e=this,t=0;t<Vt;t++)e.mStars[t].lastPos.z=e.mStars[t].pos.z,e.mStars[t].pos.z+=2*e.mCurrentBrightness,e.mStars[t].pos.z>100&&(e.mStars[t].lastPos.x=e.mStars[t].pos.x=Math.random()*Bt-100,e.mStars[t].lastPos.y=e.mStars[t].pos.y=Math.random()*Bt-100,e.mStars[t].lastPos.z=e.mStars[t].pos.z=Math.random()*Bt-100,e.mStars[t].color=new Ne(Math.random()+.5,Math.random()+.5,Math.random()+.5,1,1));e.mCurrentBrightness<e.mTargetBrightness?e.mCurrentBrightness+=.005:e.mCurrentBrightness>e.mTargetBrightness&&(e.mCurrentBrightness*=.99)}},{key:"draw",value:function(){var e=this;x(1,1,1,1),E(1);for(var t=0;t<Vt;t++)x(1,1,1,.5*e.mCurrentBrightness),L(e.mStars[t].lastPos.x+e.mCamera.mCurrentPos.x,e.mStars[t].lastPos.y+e.mCamera.mCurrentPos.y,e.mStars[t].lastPos.z+e.mCamera.mCurrentPos.z),L(e.mStars[t].pos.x+e.mCamera.mCurrentPos.x,e.mStars[t].pos.y+e.mCamera.mCurrentPos.y,e.mStars[t].pos.z+e.mCamera.mCurrentPos.z);k()}}]),e}(),Dt=q((function e(){U(this,e),this.posStream=[];for(var t=0;t<7;t++)this.posStream.push(new Pe);this.speedX=0,this.speedY=0,this.speedZ=0,this.color=null,this.timeToLive=0,this.fadeStep=0,this.gravity=!1,this.gridBound=!1,this.drag=0,this.hitGrid=!1,this.glowPass=!1})),Wt=function(){function e(){U(this,e);var t=this;t.mNumParticles=1e3,t.mParticles=[];for(var i=0;i<t.mNumParticles;i++)t.mParticles.push(new Dt);if(t.mParticles)for(var s=0;s<t.mNumParticles;s++)t.mParticles[s].timeToLive=0}return q(e,[{key:"emitter",value:function(e,t,i,s,r,n,a,o,m,l,d){for(var u=0;u<r;u++){var h=new Pe,c=new Pe;h.x=0,h.y=i+(.5*Math.random()-.25),h.z=0;var f=new Ce;f.Identity(),f.Rotate(0,0,t.y+(Math.random()*s-s/2)),f.TransformVertex(h,c),this.assignParticle(e,c.x,c.y,c.z,a,n,o,m,l,d)}}},{key:"assignParticle",value:function(e,t,i,s,r,n,a,o,m,l){var d,u=this,h=null;if(u.mParticles)for(d=0;d<u.mNumParticles;d++)if(u.mParticles[d].timeToLive<=0){h=u.mParticles[d];break}if(!h){var c=32e4,f=0;for(d=0;d<u.mNumParticles;d++)u.mParticles[d].timeToLive<=c&&(f=d,c=u.mParticles[d].timeToLive);h=u.mParticles[f]}if(h){for(var y=new Pe(e.x,e.y,e.z),v=0;v<7;v++)h.posStream[v]=new Pe(y.x,y.y,y.z);h.speedX=t,h.speedY=i,h.speedZ=s,h.color=n,h.timeToLive=r*Math.random(),h.fadeStep=1/h.timeToLive,h.gravity=a,h.gridBound=o,h.drag=m,h.glowPass=l,h.hitGrid=!1}}},{key:"draw",value:function(){var e=this;if(e.mParticles){E(1);for(var t=0;t<e.mNumParticles;t++)if(e.mParticles[t].timeToLive>0){var i=e.mParticles[t],s=i.color.a;s*=.8*xe(new Pe(0,0,0),new Pe(i.speedX,i.speedY,i.speedZ)),x(i.color.r,i.color.g,i.color.b,s);for(var r=0;r<6;r++){var n=new Pe(i.posStream[r].x,i.posStream[r].y,i.posStream[r].z),a=new Pe(i.posStream[r+1].x,i.posStream[r+1].y,i.posStream[r+1].z);i.color,L(n.x,n.y,0),L(a.x,a.y,0)}}k()}}},{key:"run",value:function(){var e,t=this;if(t.mParticles)for(e=0;e<t.mNumParticles;e++){var i=t.mParticles[e];if(i.timeToLive>0)if(--i.timeToLive,i.timeToLive<=0)i.timeToLive=0;else{new Pe(i.posStream[0].x,i.posStream[0].y,i.posStream[0].z),i.speedX*=i.drag,i.speedY*=i.drag,i.posStream[0].x+=i.speedX,i.posStream[0].y+=i.speedY,i.posStream[0].z=0;for(var s=5;s>=0;s--)i.posStream[s+1]=new Pe(i.posStream[s].x,i.posStream[s].y,i.posStream[s].z)}}}},{key:"killAll",value:function(){var e=this;if(e.mParticles)for(var t=0;t<e.mNumParticles;t++)e.mParticles[t].timeToLive=0}}]),e}(),Ot=function(){function e(t,i){U(this,e),this.mPlayer1=new tt(t,i),this.mPlayer1.setState(0),this.mNumPlayers=1,this.mGrid=i}return q(e,[{key:"setEnemies",value:function(e){this.mEnemies=e}},{key:"run",value:function(){var e=this,t=this.mPlayer1;switch(t.runMissiles(),t.getState()){case 1:t.spawnTransition();break;case 2:t.spawn();break;case 3:t.runTransition();break;case 4:t.run();var i=e.mEnemies.hitTestEnemiesAtPosition(t.getPos(),.75*t.getRadius());if(i)if(i=i.getParent(),t.shields())i.hit(t);else if(t.setState(5),i.setState(7),i.incGenId(),1==e.mNumPlayers||2==e.mNumPlayers&&e.m2PlayerNumLives<=1)for(var s=0;s<xt;s++)0!==e.mEnemies.mEnemies[s].getState()&&8!==e.mEnemies.mEnemies[s].getState()&&7!==e.mEnemies.mEnemies[s].getState()&&(e.mEnemies.mEnemies[s].hit(null),e.mEnemies.mEnemies[s].incGenId());break;case 5:t.destroyTransition();break;case 6:t.destroy()}}},{key:"draw",value:function(){this.mPlayer1.draw()}},{key:"getPlayerClosestToPosition",value:function(){var e=this;return 1==e.mNumPlayers?e.mPlayer1:e.mPlayer1.getEnabled()&&e.mPlayer2.getEnabled()?xe(point,e.mPlayers.mPlayer1.getPos())<xe(point,e.mPlayers.mPlayer2.getPos())?mPlayer1:mPlayer2:e.mPlayer2.getEnabled()?e.mPlayer2:e.mPlayer1}}]),e}(),Yt=8e3,zt=q((function e(){U(this,e),this.pos=new Pe(0,0,0),this.radius=0})),Xt=function(){function e(t){U(this,e);var i=this;this.mGrid=t;var s=this.mGrid.extentX()+700,r=this.mGrid.extentY()+700;i.mStars=[];for(var n=0;n<Yt;n++)i.mStars.push(new zt);for(var a=0;a<Yt;a++){var o;o=a<2e3?-20:a<4e3?-40:a<6e3?-60:-80,i.mStars[a].pos.x=Te(-700,s),i.mStars[a].pos.y=Te(-700,r),i.mStars[a].pos.z=o,i.mStars[a].radius=.5*ke()+.25}}return q(e,[{key:"run",value:function(){}},{key:"draw",value:function(){var e=this,t=2*(e.mGrid.brightness()-.5);if(t>1&&(t=1),e.mGameMode!=jt&&e.mGameMode!=qt||(t=1),!(t<=0)){w(1),E(0);for(var i=0;i<Yt;i++)x(1,1,1,(e.mStars[i].radius+.5)*t),L(e.mStars[i].pos.x,e.mStars[i].pos.y,e.mStars[i].pos.z);k()}}}]),e}(),Ht=200,Ft=q((function e(){U(this,e),this.e=null,this.genId=-1})),Ut=function(){function e(t,i,s){U(this,e),this.mNumPlayers=1,this.mPlayers=t,this.mEnemies=i,this.mGrid=s,this.mWaveList=[];for(var r=0;r<Ht;r++)this.mWaveList.push(new Ft);this.clearWaveListEntities()}return q(e,[{key:"init",value:function(){this.mSpawnIndex=0,this.mLastSpawnIndex=0,this.mSpawnCheckTimer=100,this.mWaveIntervalTimer=0,this.mWaveStartTimer=0,this.mWaveEntityCounter=0,this.mWaveEntity=0,this.mWaveType=1,this.clearWaveListEntities(),this.transition()}},{key:"getSpawnIndex",value:function(){return Math.floor(this.mSpawnIndex)}},{key:"run",value:function(){var e=this;e.mSpawnIndex+=.002,e.mSpawnIndex>15&&(e.mSpawnIndex=15),e.getSpawnIndex()>e.mLastSpawnIndex&&(e.mLastSpawnIndex=e.getSpawnIndex(),e.transition()),0==e.mLevel&&mSpawnIndex>1&&(mSpawnIndex=1);var t=0;if(0===e.mPlayers.mPlayer1.getState()?e.mPlayers.mPlayer1.getNumLives()>0?(e.mPlayers.mPlayer1.takeLife(),e.mPlayers.mPlayer1.getNumLives()>0?e.mPlayers.mPlayer1.setState(1):e.mGameMode=Zt):e.mGameMode=Zt:++t,t==e.mNumPlayers){var i=e.getSpawnIndex();++e.mSpawnCheckTimer>100&&(e.mSpawnCheckTimer=0,i<=1?e.spawnEntities(5,2):i>1&&i<3&&e.spawnEntities(5,4),i<=1?e.spawnEntities(4,2):i>1&&e.spawnEntities(4,4),i>=1&&e.spawnEntities(7,2),i>=1&&e.spawnEntities(6,2)),e.runWaveListEntities(),e.numWaveListEntities()<=0&&i>=2&&(--e.mWaveStartTimer,e.mWaveStartTimer<0&&(e.mWaveStartTimer=0),0==e.mWaveStartTimer&&0===e.mWaveEntity&&(e.mWaveStartTimer=100,parseInt(16*Math.random()),e.mWaveEntity=Oe,e.mWaveType=1,e.mWaveEntityCounter=4*Math.random())),0!==e.mWaveEntity&&++e.mWaveIntervalTimer>10&&(e.mWaveIntervalTimer=0,e.runWaves())}else e.mSpawnCheckTimer=0}},{key:"transition",value:function(){}},{key:"spawnEntities",value:function(e,t){var i=this,s=i.mGrid.extentX()-1-15,r=i.mGrid.extentY()-1-15;if(i.mEnemies.getNumActiveEnemiesOfType(e)<t){var n=i.mEnemies.getUnusedEnemyOfType(e);if(n){var a=Math.random()*(s-15)+15,o=Math.random()*(r-15)+15,m=new Pe(a,o,0);n.setPos(m),xe(m,i.mPlayers.mPlayer1.getPos()),n.setState(1)}}}},{key:"runWaves",value:function(){var e=this;if(0!==e.mWaveEntity)if(e.mGrid.extentX(),e.mGrid.extentY(),2==e.mWaveType);else for(var t=0;t<4;t++)if(e.mWaveEntityCounter>0){var i=e.mEnemies.getUnusedEnemyOfType(e.mWaveEntity);if(i){e.addToWaveList(i),Math.random(),Math.random();var s=new Pe;s.x=50,s.y=50;var r=i.getRadius();e.mWaveEntity==Oe&&(r=20);var n=r,a=r,o=e.mGrid.extentX()-r-1,m=e.mGrid.extentY()-r-1;s.x<n?s.x=n:s.x>o&&(s.x=o),s.y<a?s.y=a:s.y>m&&(s.y=m);var l=new Pe;e.mGrid.hitTest(s,1,l)&&(s=l),i.setPos(s),i.setState(1)}--e.mWaveEntityCounter,e.mWaveEntityCounter<=0&&(e.mWaveEntity=0)}}},{key:"addToWaveList",value:function(e){for(var t=this,i=0;i<Ht;i++)if(null==t.mWaveList[i].e)return t.mWaveList[i].e=e,void(t.mWaveList[i].genId=e.getGenId())}},{key:"numWaveListEntities",value:function(){for(var e=this,t=0,i=0;i<Ht;i++)e.mWaveList[i].e&&e.mWaveList[i].e.getGenId()==e.mWaveList[i].genId&&++t;return t}},{key:"runWaveListEntities",value:function(){for(var e=this,t=0;t<Ht;t++)e.mWaveList[t].e&&e.mWaveList[t].e.getGenId()!=e.mWaveList[t].genId&&(e.mWaveList[t].e=null,e.mWaveList[t].genId=-1)}},{key:"clearWaveListEntities",value:function(){for(var e=0;e<Ht;e++)this.mWaveList[e].e=null,this.mWaveList[e].genId=-1}}]),e}(),jt=0,qt=1,Zt=5,$t=8,Kt=function(){function e(){U(this,e),this.music=function(e){A("music_load('%s')");var t=new Audio;return t.src=e,function(e,t){!function(e,t,i){e[t]=i}(G,e,t)}(e,t),t}("data/music/musicloop.wav"),this.mFreeplay=!0,this.mCredits=0,this.mNumPlayers=1,this.mLevel=0,this.m2PlayerNumLives=0,this.m2PlayerNumBombs=0,this.mParticles=new Wt,this.mAttractors=new Be,this.mGrid=new At(this.mAttractors),this.mPlayers=new Ot(this.mAttractors,this.mGrid),this.mEnemies=new Lt(this.mPlayers,this.mParticles),this.mCamera=new bt(this.mPlayers,this.mGrid),this.mHyperspace=new Ct(this.mCamera),this.mStars=new Xt(this.mGrid),this.mSpawner=new Ut(this.mPlayers,this.mEnemies,this.mGrid),this.mBomb=new kt(this.mAttractors,this.mParticles,this.mEnemies),this.mCamera.center(),this.mAttractModeBlackHoles=[];for(var t=0;t<4;t++){this.mAttractModeBlackHoles[t]=new Fe,this.mAttractModeBlackHoles[t].setPos(new Pe(Math.random()*this.mGrid.extentX(),Math.random()*this.mGrid.extentY(),0)),this.mAttractModeBlackHoles[t].setEdgeBounce(!1);var i=6.28318*Math.random();40*Math.random()<1&&Math.random();var s=new Pe(1,0,0);s=Le(s,i),this.mAttractModeBlackHoles[t].setDrift(s)}this.mGameMode=jt,this.mCameraLevelZoom=1}return q(e,[{key:"run",value:function(){var e=this;switch(this.mFreeplay&&(this.mCredits=2),this.mAttractors.clearAll(),this.mCamera.run(),this.mGameMode){case jt:this.mCredits>0&&(this.mGameMode=qt);break;case qt:this.startGame(1);case 2:this.mCamera.mZoomOverride=900*this.mCameraLevelZoom,this.mCameraLevelZoom*=.97,this.mLevelStartWaitTimer>0&&--this.mLevelStartWaitTimer,this.mCamera.followPlayer(),this.mStars.run(),this.mPlayers.run(),this.mBomb.run(),this.mLevelStartWaitTimer<=0&&this.mSpawner.run(),this.mEnemies.run()}if(this.mGrid.run(),3==this.mGameMode||4==this.mGameMode);else if(this.mGameMode==jt||this.mGameMode==qt){this.mCameraLevelZoom=1,this.mCamera.mZoomOverride=0,this.mCamera.center();for(var t=this.mGrid.extentX(),i=this.mGrid.extentY(),s=0;s<4;s++){e.mAttractModeBlackHoles[s].setState(4),e.mAttractModeBlackHoles[s].run();var r=e.mAttractModeBlackHoles[s].getPos(),n=e.mAttractors.getAttractor();n&&(n.strength=-40,n.zStrength=0,n.radius=20,n.pos=r,n.enabled=!0,n.attractsParticles=!0);for(var a=0;a<4;a++)if(s!=a){var o=Ee(e.mAttractModeBlackHoles[a].getPos(),e.mAttractModeBlackHoles[s].getPos()),m=xe(e.mAttractModeBlackHoles[a].getPos(),e.mAttractModeBlackHoles[s].getPos());m<e.mAttractModeBlackHoles[s].getRadius()&&(m=e.mAttractModeBlackHoles[s].getRadius());var l=new Pe(1/(m*m)*8,0,0),d=Le(l,o+.4),u=e.mAttractModeBlackHoles[a].getDrift();u.x+=d.x,u.y+=d.y,e.mAttractModeBlackHoles[a].setDrift(u)}40*Math.random()<1&&Math.random();var h=e.mAttractModeBlackHoles[s].getDrift(),c=e.mAttractModeBlackHoles[s].getPos(),f=t-2-1,y=i-2-1;c.x<=2?(h.x=-h.x,c.x=2):c.x>=f&&(h.x=-h.x,c.x=f),c.y<=2?(h.y=-h.y,c.y=2):c.y>=y&&(h.y=-h.y,c.y=y),e.mAttractModeBlackHoles[s].setDrift(h),e.mAttractModeBlackHoles[s].setPos(c)}for(var v=0,p=0;p<4;p++){v+=.08;var g=new Pe(Math.random()*t,Math.random()*i),S=new Pe(0,0,0),P=Math.sin(v+6.28318)+.1,M=Math.sin(v+3.14159)+.1,w=Math.sin(v+6.28318/3)+.1,x=new Ne(P,M,w,1,4);this.mParticles.emitter(g,S,2,6.28318,50,x,1e3,!0,!1,.95,!0)}}this.mParticles.run()}},{key:"draw",value:function(e){!function(e,t,i){r=window.gl,c.x=e,c.y=t,c.z=i}(-this.mCamera.mCurrentPos.x,-this.mCamera.mCurrentPos.y,-this.mCamera.mCurrentPos.z),P(2),P(3),this.mGrid.draw(),P(2),P(3),e===Jt?(M(4),this.mParticles.draw()):(M(8),this.mParticles.draw()),2==this.mGameMode&&(M(4),this.mEnemies.draw()),2!=this.mGameMode&&this.mGameMode!=$t&&7!=this.mGameMode||(M(4),w(2),this.mPlayers.draw()),this.mGameMode==$t&&e===Jt&&this.mHyperspace.draw(),P(3),P(2),e===Jt&&this.mStars.draw(),M(4),this.mBomb.draw()}},{key:"startGame",value:function(e){var t;t=this.music,null!=V&&!V.paused&&(null!=V&&V.pause(),V=null),null!=t&&(t.loop=!0,t.play()),V=t,this.mPlayers.setEnemies(this.mEnemies),this.mPlayers.mPlayer1.setGame(this),this.mPlayers.mPlayer1.setEnemies(this.mEnemies),this.mPlayers.mPlayer1.setBomb(this.mBomb),this.mPlayers.mPlayer1.setParticles(this.mParticles),this.mNumPlayers=e,this.mCamera.center(),this.mLevel=0,this.mGrid.startLevel(this.mLevel),this.mSkillLevel=0,this.mSpawner.init(),1==this.mNumPlayers&&this.mPlayers.mPlayer1.initPlayerForGame(),this.mGameMode=2,this.mMusicSpeed=1,this.mMusicSpeedTarget=1,this.mCameraLevelZoom=1,this.mLevelStartWaitTimer=200,this.mWeaponChangeTimer=0,this.mLevelAdvanceCounter=0,this.mLevelComplete=!1,this.mParticles.killAll(),console.log("START GAME",this)}},{key:"endGame",value:function(){console.log("END GAME"),this.mCamera.center(),this.mPlayers.mPlayer1.setState(0),this.mPlayers.mPlayer2.setState(0),this.mEnemies.disableAllEnemies(),this.mGrid.endLevel()}},{key:"showMessageAtLocation",value:function(e,t,i){}},{key:"runPointDisplays",value:function(){for(var e=0;e<NUM_POINT_DISPLAYS;e++)this.mPointDisplays[e].enabled&&(this.mPointDisplays[e].timer--,this.mPointDisplays[e].timer<=0&&(this.mPointDisplays[e].enabled=!1))}},{key:"drawPointDisplays",value:function(){}},{key:"clearPointDisplays",value:function(){for(var e=0;e<NUM_POINT_DISPLAYS;e++)this.mPointDisplays[e].enabled=!1}},{key:"incrementLevelComplete",value:function(){var e=100*this.mNumPlayers;++this.mLevelAdvanceCounter,this.mLevelAdvanceCounter>=e&&this.doLevelComplete()}},{key:"doLevelComplete",value:function(){this.mLevelComplete=!1,this.mLevelAdvanceCounter=0,this.mLevelChangeTimer=0,this.mGameMode=7,this.mPlayers.mPlayer1.addPointsNoMultiplier(10*this.mPlayers.mPlayer1.getGeoms()),this.mPlayers.mPlayer2.addPointsNoMultiplier(10*this.mPlayers.mPlayer2.getGeoms()),this.mWeaponChangeTimer=0,this.mPlayers.mPlayer1.switchWeapons(),this.mPlayers.mPlayer2.switchWeapons(),this.mSpawner.clearWaveListEntities(),this.mHyperspace.mTargetBrightness=1}},{key:"advanceLevel",value:function(){++this.mLevel,this.clearPointDisplays(),this.mGrid.endLevel(),this.mLevelChangeTimer=0,this.mLevelStartWaitTimer=400,this.mGameMode=$t}}]),e}(),Jt=0,Qt=new(function(){function e(){U(this,e),this.mAttractModeTimer=0,this.mShowHighScores=!1;var t=0;for(this.mShieldSymbol={},this.mShieldSymbol.mNumVertex=12,this.mShieldSymbol.mVertexList=[],this.mShieldSymbol.mVertexList[t++]=new Pe(8.1,8.1),this.mShieldSymbol.mVertexList[t++]=new Pe(11.5,0),this.mShieldSymbol.mVertexList[t++]=new Pe(8.1,-8.1),this.mShieldSymbol.mVertexList[t++]=new Pe(0,-11.5),this.mShieldSymbol.mVertexList[t++]=new Pe(-8.1,-8.1),this.mShieldSymbol.mVertexList[t++]=new Pe(-11.5,0),this.mShieldSymbol.mVertexList[t++]=new Pe(-8.1,8.1),this.mShieldSymbol.mVertexList[t++]=new Pe(0,4),this.mShieldSymbol.mVertexList[t++]=new Pe(0,-4),this.mShieldSymbol.mVertexList[t++]=new Pe(-4,0),this.mShieldSymbol.mVertexList[t++]=new Pe(4,0),this.mShieldSymbol.mNumEdges=10,this.mShieldSymbol.mEdgeList=[],t=0;t<this.mShieldSymbol.mNumEdges;t++)this.mShieldSymbol.mEdgeList.push(new De);t=0,this.mShieldSymbol.mEdgeList[t].from=0,this.mShieldSymbol.mEdgeList[t++].to=1,this.mShieldSymbol.mEdgeList[t].from=1,this.mShieldSymbol.mEdgeList[t++].to=2,this.mShieldSymbol.mEdgeList[t].from=2,this.mShieldSymbol.mEdgeList[t++].to=3,this.mShieldSymbol.mEdgeList[t].from=3,this.mShieldSymbol.mEdgeList[t++].to=4,this.mShieldSymbol.mEdgeList[t].from=4,this.mShieldSymbol.mEdgeList[t++].to=5,this.mShieldSymbol.mEdgeList[t].from=5,this.mShieldSymbol.mEdgeList[t++].to=6,this.mShieldSymbol.mEdgeList[t].from=6,this.mShieldSymbol.mEdgeList[t++].to=7,this.mShieldSymbol.mEdgeList[t].from=7,this.mShieldSymbol.mEdgeList[t++].to=0,this.mShieldSymbol.mEdgeList[t].from=8,this.mShieldSymbol.mEdgeList[t++].to=9,this.mShieldSymbol.mEdgeList[t].from=10,this.mShieldSymbol.mEdgeList[t++].to=11}return q(e,[{key:"init",value:function(){this.level_timer=0,gt=new Kt,console.log(gt)}},{key:"run",value:function(){gt.run(),this.level_timer+=O()}},{key:"draw",value:function(e){var t,i,s;(r=window.gl).clearColor(0,0,0,1),r=window.gl,t||(t=r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT),r.clear(t),P(0),(r=window.gl).enable(r.BLEND),i=1,s=0,r=window.gl,i=i||r.ONE,s=s||r.ZERO,0===i&&(i=r.ONE),1===s&&(s=r.SRC_ALPHA),r.blendFunc(r.SRC_ALPHA,r.ONE),gt.draw(e)}}]),e}()),ei=function(){Qt.init()},ti=function(){Qt.run()},ii=function(){Qt.draw(Jt)},si=function(){},ri=[],ni=function(){A("preferences_init()"),function(){if(B.video_resolution="TINY",B.fullscreen=!1,B.smooth_graphics=!1,B.show_fps=!1,B.language="data/languages/english.json","undefined"!=typeof window)for(var e in B)B[e]=window.localStorage.getItem(e)?localStorage.getItem(e):B[e],"false"==B[e]&&(B[e]=!1);console.log("PREFERENCES",B)}()},ai=function(e){A("timer_init()"),0,u=0,D=0,C=Y(),function(){var e=document.createElement("canvas");if(document.body.appendChild(e),e.width=480,e.height=271,window.gl=r=e.getContext("webgl"),r){var t=" attribute vec3 coordinates;attribute vec4 color;uniform vec3 position;uniform float pointSize;varying vec4 vColor;void main(void) {float x = (coordinates.x + position.x) / "+g+";float y = (coordinates.y + position.y) / "+S+";gl_Position = vec4(x, y, 0, 1.0);gl_PointSize = pointSize;vColor = color;}",i=r.createShader(r.VERTEX_SHADER);r.shaderSource(i,t),r.compileShader(i);var s=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(s," varying mediump vec4 vColor;void main(void) {gl_FragColor = vColor;}"),r.compileShader(s);var u=r.createProgram();r.attachShader(u,i),r.attachShader(u,s),r.linkProgram(u),r.useProgram(u),n=r.createBuffer(),a=r.createBuffer(),o=r.getAttribLocation(u,"color"),m=r.getAttribLocation(u,"coordinates"),l=r.getUniformLocation(u,"pointSize"),d=r.getUniformLocation(u,"position"),window.webgl={vertex_buffer:n,color_buffer:a,vertexColor:o,vertexCoordinates:m,vertexPointSize:l,pointSize:h,lineWidth:1,cameraPosition:d,type:0}}else console.log("NO WEBGL")}(),A("input_init()"),ae=null,K=!1,J=!1,re="undefined"!=typeof navigator&&"getGamepads"in navigator,console.log("canGamepad",re),(oe=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}())&&(console.log("21111",void 0),(ee=new $({container:void 0,strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2||t.pageY<window.innerHeight/2)})),(te=new $({container:void 0,strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY<window.innerHeight/2)})),(ie=new $({container:void 0,strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2||t.pageY>window.innerHeight/2)})),(se=new $({container:void 0,strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY>window.innerHeight/2)}))),Q=ue(me),_.images={},_.images,_.samples={},_.samples,_.musics={},G=_.musics};!function(e){ni();var t=function(e){var t={};return t.video_resolution=B.video_resolution,t.smooth_graphics=B.smooth_graphics,t.fullscreen=B.fullscreen,t.show_fps=B.show_fps,t.language=B.language,t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=N("video_resolution")?N("video_resolution"):t.video_resolution,t.smooth_graphics=N("smooth_graphics")?N("smooth_graphics"):t.smooth_graphics,t.fullscreen=N("fullscreen")?N("fullscreen"):t.fullscreen,t.show_fps=N("show_fps")?N("show_fps"):t.show_fps,t.color_depth=N("color_depth")?N("color_depth"):t.color_depth,t.level=N("level")?N("level"):t.level,t.quest=N("quest")?N("quest"):t.quest,t.language=N("language")?N("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t}(e);console.log("COMMAND LINE",t),ai(),function(e,t){!function(){for(var e=0;e<256;e++)ri[e]=null;ri[6]={init:ei,update:ti,render:ii,release:si}}(),function(e,t){A("Initializing the language module"),ce(he=e||he).then((function(e){console.log(e),A("lang_init() ok!"),t()}))}(e.language,(function(){!function(){ye=0;for(var e=0;e<16;e++)fe[e]=null}(),t()}))}(t,(function(){var e;console.log("GET SCENE",6),e=ri[6],fe[ye++]=e,e&&e.init(),function(){var e,t,i;t=function(t){!function(e){for(var t=0,i=0;i<10;){var s=Y();i=s>C?s-C:0,C=s>=C?C:s}t=Math.min(t,32),D=.001*t,(u+=parseInt(t,10))>=1e3&&(0,u=0),C=Y()}(),function(){var e,t,i=O();for(t=ae;t;t=t.next){for(e=0;e<9;e++)t.data.oldstate[e]=t.data.state[e];for(e=0;e<9;e++)de(t.data,e)?t.data.howlong[e]+=i:t.data.howlong[e]=0;switch(t.data.type){case 1:t.data.state[1]=Q.up,t.data.state[2]=Q.down,t.data.state[4]=Q.left,t.data.state[3]=Q.right,t.data.state[5]=Q.space,t.data.state[6]=Q.lcontrol,t.data.state[7]=Q.enter,t.data.state[8]=Q.esc,t.data.state[9]=Q.tilda;break;case 4:t.data.x=0,t.data.y=0,t.data.state[5]=!1,t.data.state[7]=!1,t.data.state[6]=!1;break;case 2:for(e=0;e<9;e++)t.data.state[e]=!1;break;case 3:K&&!J&&(t.data.state[1]=joy[0].stick[0].axis[1].d1,t.data.state[2]=joy[0].stick[0].axis[1].d2,t.data.state[4]=joy[0].stick[0].axis[0].d1,t.data.state[3]=joy[0].stick[0].axis[0].d2,t.data.state[5]=joy[0].button[0].b,t.data.state[6]=joy[0].button[1].b,t.data.state[7]=joy[0].button[2].b,t.data.state[8]=joy[0].button[3].b);break;case 0:t.data.state[1]=Q.up,t.data.state[2]=Q.down,t.data.state[4]=Q.left,t.data.state[3]=Q.right,t.data.state[5]=Q.space,t.data.state[6]=Q.lcontrol,t.data.state[7]=Q.enter,t.data.state[8]=Q.esc,t.data.state[12]=Q.w,t.data.state[15]=Q.a,t.data.state[13]=Q.s,t.data.state[14]=Q.d,oe&&(t.data.state[12]=ee.up(),t.data.state[13]=ee.down(),t.data.state[15]=ee.left(),t.data.state[14]=ee.right(),t.data.state[1]=te.up(),t.data.state[2]=te.down(),t.data.state[4]=te.left(),t.data.state[3]=te.right(),t.data.state[8]=ie._pressed,t.data.state[6]=se._pressed),re&&(ne="undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)),ne&&(le||(le=!0,console.log("GAMEPAD",ne)),t.data.state[10]={x:-ne.axes[1],y:-ne.axes[0],z:0},t.data.state[11]={x:-ne.axes[3],y:-ne.axes[2],z:0},t.data.state[1]=ne.buttons[12].pressed,t.data.state[2]=ne.buttons[13].pressed,t.data.state[4]=ne.buttons[14].pressed,t.data.state[3]=ne.buttons[15].pressed,t.data.state[5]=ne.buttons[0].pressed,t.data.state[6]=ne.buttons[1].pressed,t.data.state[7]=ne.buttons[2].pressed,t.data.state[8]=ne.buttons[3].pressed)}}}(),(e=ve())&&(e.update(),e==ve()&&e.render()),ee&&ee.render(void 0),te&&te.render(void 0)},i=null,requestAnimationFrame((function e(s){var r=!1;null!=i&&(Math.min(s-i,100),r=!1===t()),i=s,r||requestAnimationFrame(e)}))}()}))}((St={Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null},s(St,"Xlevel","data/levels/blue_ocean_3.json"),s(St,"Xquest",null),s(St,"Xquest","data/quests/tutorial.json"),s(St,"Xlanguage",null),s(St,"Xlanguage","data/languages/italiano.json"),St))})()})();