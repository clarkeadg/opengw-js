!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=65)}([function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=t.Point3d=function(){function e(t,i,r){n(this,e),this.x=t||0,this.y=i||0,this.z=r||0}return r(e,[{key:"copy",value:function(){return new e(this.x,this.y,this.z)}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"multiply",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}}]),e}();t.p3d_dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.p3d_add=function(e,t){return new o(e.x+t.x,e.y+t.y,e.z+t.z)},t.p3d_subtract=function(e,t){return new o(e.x-t.x,e.y-t.y,e.z-t.z)},t.p3d_multiply=function(e,t){return new o(e.x*t,e.y*t,e.z*t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closestPointOnLineSegment=t.diffAngles=t.clamp2dVector=t.DegreesToRads=t.isPointOnLine=t.pointLineDistance=t.pointInPolygon=t.frandFrom0To1=t.randFromTo=t.rotate2dPoint=t.calculate2dAngle=t.calculate2dDistance=void 0;var n=i(7),r=i(0),o=i(17),a=t.calculate2dDistance=function(e,t){var i=e.x,n=e.y,r=t.x,o=t.y,a=i-r,s=n-o;return Math.sqrt(s*s+a*a)},s=(t.calculate2dAngle=function(e,t){var i=0,r=e.x,o=e.y,a=t.x,s=t.y,m=a-r,l=s-o;return i=0==m?0==l?0:l>0?n.PI/2:3*n.PI/2:0==l?m>0?0:n.PI:m<0?Math.atan(l/m)+n.PI:l<0?Math.atan(l/m)+2*n.PI:Math.atan(l/m),i>=n.RADIAN&&(i-=n.RADIAN),i},t.rotate2dPoint=function(e,t){var i=e.x,n=e.y;return new r.Point3d(i*Math.cos(t)-n*Math.sin(t),i*Math.sin(t)+n*Math.cos(t))},t.randFromTo=function(e,t){var i=t-e;return parseInt(s()*(i+1)+e,10)},t.frandFrom0To1=function(){return Math.random()}),m=(t.pointInPolygon=function(e,t,i,n){for(var r=!1,o=t[0].copy().multiply(n),a=1;a<i;a++){var s=t[a].copy().multiply(n);0==s.z?((o.y<e.y&&s.y>=e.y||s.y<e.y&&o.y>=e.y)&&(o.x<=e.x||s.x<=e.x)&&(r^=o.x+(e.y-o.y)/(s.y-o.y)*(s.x-o.x)<e.x),o=s):(a++,o=t[a].copy().multiply(n))}return r},t.pointLineDistance=function(e,t,i){var n=t.copy().subtract(e),o=a(new r.Point3d(0,0,0),n),s=i.copy().subtract(e),m=(0,r.p3d_dot)(n,s),l=m/(o*o);if(l<0)return Math.abs(a(e,i));if(l>1)return Math.abs(a(t,i));var d=e.copy().add(new r.Point3d(n.x*l,n.y*l,0));return Math.abs(a(d,i))}),l=(t.isPointOnLine=function(e,t,i){return m(e,t,i)<1},t.DegreesToRads=function(e){return.0174532925*e});t.clamp2dVector=function(e,t){var i=e,n=a(new r.Point3d(0,0,0),i);if(n>t){var o=t/n;i.x*=o,i.y*=o}return i},t.diffAngles=function(e,t){e=(0,o.fmod)(e,l(360)),t=(0,o.fmod)(t,l(360));var i=e-t;return i>=l(180)?i-=l(360):i<=-l(180)&&(i+=l(360)),i},t.closestPointOnLineSegment=function(e,t,i){var n=t.copy().subtract(e),o=a(new r.Point3d(0,0,0),n),s=i.copy().subtract(e),m=(0,r.p3d_dot)(n,s),l=m/(o*o);return l<0?e:l>1?t:e.copy().add(new r.Point3d(n.x*l,n.y*l,0))}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.entity=t.ENTITY_STATE_INDICATING=t.ENTITY_STATE_INDICATE_TRANSITION=t.ENTITY_STATE_DESTROYED=t.ENTITY_STATE_DESTROY_TRANSITION=t.ENTITY_STATE_RUNNING=t.ENTITY_STATE_RUN_TRANSITION=t.ENTITY_STATE_SPAWNING=t.ENTITY_STATE_SPAWN_TRANSITION=t.ENTITY_STATE_INACTIVE=t.ENTITY_NUM_TYPES=t.ENTITY_TYPE_LINE=t.ENTITY_TYPE_GEOM_LARGE=t.ENTITY_TYPE_GEOM_MEDIUM=t.ENTITY_TYPE_GEOM_SMALL=t.ENTITY_TYPE_PROTON=t.ENTITY_TYPE_BLACKHOLE=t.ENTITY_TYPE_SNAKE_SEGMENT=t.ENTITY_TYPE_SNAKE=t.ENTITY_TYPE_MAYFLY=t.ENTITY_TYPE_TINYSPINNER=t.ENTITY_TYPE_SPINNER=t.ENTITY_TYPE_WEAVER=t.ENTITY_TYPE_WANDERER=t.ENTITY_TYPE_GRUNT=t.ENTITY_TYPE_PLAYER_MISSILE=t.ENTITY_TYPE_PLAYER2=t.ENTITY_TYPE_PLAYER1=t.ENTITY_TYPE_UNDEF=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(0),s=i(1),m=i(17),l=i(4),d=i(3),u=i(7),c=(t.ENTITY_TYPE_UNDEF=0,t.ENTITY_TYPE_PLAYER1=1),f=(t.ENTITY_TYPE_PLAYER2=2,t.ENTITY_TYPE_PLAYER_MISSILE=3,t.ENTITY_TYPE_GRUNT=4,t.ENTITY_TYPE_WANDERER=5,t.ENTITY_TYPE_WEAVER=6,t.ENTITY_TYPE_SPINNER=7,t.ENTITY_TYPE_TINYSPINNER=8,t.ENTITY_TYPE_MAYFLY=9,t.ENTITY_TYPE_SNAKE=10,t.ENTITY_TYPE_SNAKE_SEGMENT=11,t.ENTITY_TYPE_BLACKHOLE=12),_=(t.ENTITY_TYPE_PROTON=13,t.ENTITY_TYPE_GEOM_SMALL=14),h=t.ENTITY_TYPE_GEOM_MEDIUM=15,p=(t.ENTITY_TYPE_GEOM_LARGE=16,t.ENTITY_TYPE_LINE=17,t.ENTITY_NUM_TYPES=18,t.ENTITY_STATE_INACTIVE=0),y=t.ENTITY_STATE_SPAWN_TRANSITION=1,E=t.ENTITY_STATE_SPAWNING=2,T=(t.ENTITY_STATE_RUN_TRANSITION=3,t.ENTITY_STATE_RUNNING=4),g=t.ENTITY_STATE_DESTROY_TRANSITION=5,v=t.ENTITY_STATE_DESTROYED=6,P=(t.ENTITY_STATE_INDICATE_TRANSITION=7,t.ENTITY_STATE_INDICATING=8);t.entity=function(){function e(t){n(this,e),this.mParticles=t,this.mSpawnTime=50,this.mDestroyTime=0,this.mIndicateTime=100,this.mStateTimer=0,this.mAggression=1,this.mEdgeBounce=!1,this.mGridBound=!0,this.mGenId=0,this.mRotationRate=0,this.mAngle=0,this.mPen=new d.pen,this.mModel=new l.model,this.mPos=new a.Point3d(0,0,0),this.mSpeed=new a.Point3d(0,0,0),this.mDrift=new a.Point3d(0,0,0)}return r(e,[{key:"getType",value:function(){return this.mType}},{key:"getPos",value:function(){return this.mPos}},{key:"setPos",value:function(e){this.mPos=e}},{key:"getSpeed",value:function(){return this.mSpeed}},{key:"setSpeed",value:function(e){this.mSpeed=e}},{key:"getDrift",value:function(){return this.mDrift}},{key:"setDrift",value:function(e){this.mDrift=e}},{key:"getAngle",value:function(){return this.mAngle}},{key:"setAngle",value:function(e){this.mAngle=e}},{key:"getRotationRate",value:function(){return this.mRotationRate}},{key:"setRotationRate",value:function(e){this.mRotationRate=e}},{key:"getScale",value:function(){return this.mScale}},{key:"setScale",value:function(e){this.mScale=e}},{key:"setScale",value:function(e){this.mScale=e}},{key:"getPen",value:function(){return this.mPen}},{key:"setPen",value:function(e){this.mPen=e}},{key:"getEnabled",value:function(){return this.mState!==p}},{key:"setEnabled",value:function(e){this.mState=this.enabled?y:p}},{key:"getState",value:function(){return this.mState}},{key:"setState",value:function(e){this.mState=e}},{key:"getStateTimer",value:function(){return this.mStateTimer}},{key:"setStateTimer",value:function(e){this.mStateTimer=e}},{key:"getModel",value:function(){return this.mModel}},{key:"getScoreValue",value:function(){return this.mScoreValue}},{key:"getRadius",value:function(){return this.mRadius}},{key:"getAggression",value:function(){return this.mAggression}},{key:"setEdgeBounce",value:function(e){this.mEdgeBounce=e}},{key:"runTransition",value:function(){this.setState(T)}},{key:"run",value:function(){if(this.mAggression+=2e-4,this.mPos.add(this.mSpeed),this.mPos.add(this.mDrift),this.mAngle+=this.mRotationRate,this.mAngle=(0,m.fmod)(this.mAngle,2*u.PI),this.mGrid&&this.mGridBound){var e=0,t=this.mGrid.hitTest(this.mPos,0,new a.Point3d,e);t&&(this.mPos=t.hitPoint,e=t.angle)}this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos),this.mDrift.multiply(.95)}},{key:"spawnTransition",value:function(){this.setState(E),this.mStateTimer=this.mSpawnTime,this.mSpeed=new a.Point3d(0,0,0),this.mDrift=new a.Point3d(0,0,0),this.mAngle=0,this.mRotationRate=0,this.mAggression=1,this.spawn(),this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos)}},{key:"spawn",value:function(){--this.mStateTimer<=0&&this.setState(T)}},{key:"destroyTransition",value:function(){this.setState(v),this.mStateTimer=this.mDestroyTime,++this.mGenId;var e=new a.Point3d(this.mPos.x,this.mPos.y,this.mPos.z),t=new a.Point3d(0,0,0),i=2*u.PI,n=new d.pen(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);n.r*=1.2,n.g*=1.2,n.b*=1.2,n.a=.9,n.lineRadius=5,this.mParticles.emitter(e,t,1.2,i,50,n,150,!0,!0,.97,!0),this.mEnemies.explodeEntity(this)}},{key:"destroy",value:function(){--this.mStateTimer<=0&&this.setState(p)}},{key:"indicateTransition",value:function(){this.mStateTimer=this.mIndicateTime,this.setState(P)}},{key:"indicating",value:function(){--this.mStateTimer<=0&&this.setState(p)}},{key:"hit",value:function(e){var t=this,i=!1;if(e){var n=e;n.getType()<3?t.mScoreValue&&(0==n.mPlayerSource?t.mPlayers.mPlayer1.addKillAtLocation(t.mScoreValue,t.getPos()):1==n.mPlayerSource&&t.mPlayers.mPlayer2.addKillAtLocation(t.mScoreValue,t.getPos()),i=!0):e&&e.getType()==f||e&&e.getType()==c||e.getType()}else i=!0;if(this.setState(g),i)if(100*Math.random()<50){var r=t.mEnemies.getUnusedEnemyOfType(h);r&&(r.setState(y),r.setPos(this.getPos()),r.setRotationRate(.01*Math.random()-.05),r.setSpeed(new a.Point3d(.1*Math.random()-.05,.1*Math.random()-.05,0)),r.setDrift(new a.Point3d(1*Math.random()-.5,1*Math.random()-.5,0)))}else for(var o=0;o<2;o++){var s=t.mEnemies.getUnusedEnemyOfType(_);s&&(s.setState(y),s.setPos(this.getPos()),s.setRotationRate(.01*Math.random()-.05),s.setSpeed(new a.Point3d(.1*Math.random()-.05,.1*Math.random()-.05,0)),s.setDrift(new a.Point3d(1*Math.random()-.5,1*Math.random()-.5,0)))}}},{key:"hitTest",value:function(e,t){var i=new a.Point3d(0,0,0);return this.getModel().mMatrix.TransformVertex(new a.Point3d(0,0,0),i),(0,s.calculate2dDistance)(e,i)<t+this.getRadius()?this:null}},{key:"draw",value:function(){if(this.getState()==P)1&parseInt(this.mStateTimer/10,10)&&this.mModel.draw(this.mPen);else if(this.getEnabled()){var e=new d.pen(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);if(this.getState()==E){var t=this.mScale,i=this.mPos,n=1/this.mSpawnTime,r=this.mStateTimer*n;(0,o.glLineWidth)(.3*e.lineRadius),(0,o.glBegin)(o.GL_LINES),r=1-r;var a=r;a<0&&(a=0),a>1&&(a=1),e.a=a,this.mModel.Identity(),this.mModel.Scale(t*r*1),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),r+=.25,a=1-r,a<0&&(a=0),a>1&&(a=1),e.a=a,this.mModel.Identity(),this.mModel.Scale(t*r*4),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),r+=.25,a=1-r,a<0&&(a=0),a>1&&(a=1),e.a=a,this.mModel.Identity(),this.mModel.Scale(t*r*7),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),this.mModel.Identity(),this.mModel.Scale(t),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),(0,o.glEnd)()}this.mPen.a=1,this.mModel.draw(this.mPen)}}},{key:"getParent",value:function(){return this}},{key:"getGenId",value:function(){return this.mGenId}},{key:"incGenId",value:function(){++this.mGenId}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.extendVector=t.drawVector=t.pen=void 0;var r=i(1),o=i(0);t.pen=function e(t,i,r,o,a){n(this,e),this.r=t||1,this.g=i||1,this.b=r||1,this.a=o||1,this.radius=a||1},t.drawVector=function(e,t,i){},t.extendVector=function(e,t,i){var n=(0,r.calculate2dAngle)(e,t)-(0,r.DegreesToRads)(90),a=(0,r.calculate2dDistance)(e,t)*i,s=new o.Point3d((e.x+t.x)/2,(e.y+t.y)/2,0),m=new o.Point3d(0,a/2,0),l=new o.Point3d(0,-a/2,0);m=(0,r.rotate2dPoint)(m,n),l=(0,r.rotate2dPoint)(l,n),m+=new o.Point3d(m.x+s.x,m.y+s.y,m.z+s.z),l+=new o.Point3d(l.x+s.x,l.y+s.y,l.z+s.z),e.x=m.x,e.y=m.y,t.x=l.x,t.y=l.y}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.model=t.Edge=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(0),s=i(28);t.Edge=function e(){n(this,e),this.from=0,this.to=0},t.model=function(){function e(){n(this,e),this.mMatrix=new s.matrix,this.mMatrix.Identity(),this.mVertexList=0,this.mEdgeList=0,this.mNumVertex=0,this.mNumEdges=0,this.mIsLineLoop=!1}return r(e,[{key:"draw",value:function(e){(0,o.glColor4f)(e.r,e.g,e.b,e.a),(0,o.glLineWidth)(.3*e.lineRadius),(0,o.glBegin)(o.GL_LINE_STRIP);for(var t=0;t<this.mNumEdges;t++){var i=this.mVertexList[this.mEdgeList[t].from],n=this.mVertexList[this.mEdgeList[t].to],r=new a.Point3d,s=new a.Point3d;this.mMatrix.TransformVertex(i,r),this.mMatrix.TransformVertex(n,s),(0,o.glVertex3d)(r.x,r.y,0),(0,o.glVertex3d)(s.x,s.y,0)}(0,o.glEnd)()}},{key:"emit",value:function(e){var t=this;(0,o.glColor4f)(e.r,e.g,e.b,e.a),(0,o.glBegin)(o.GL_LINES);for(var i=0;i<t.mNumEdges;i++){var n=t.mVertexList[t.mEdgeList[i].from],r=t.mVertexList[t.mEdgeList[i].to],s=new a.Point3d,m=new a.Point3d;t.mMatrix.TransformVertex(n,s),t.mMatrix.TransformVertex(r,m),(0,o.glVertex3d)(s.x,s.y,0),(0,o.glVertex3d)(m.x,m.y,0)}(0,o.glEnd)()}},{key:"Identity",value:function(){this.mMatrix.Identity()}},{key:"Scale",value:function(e){this.mMatrix.Scale(e,e,e)}},{key:"Translate",value:function(e){this.mMatrix.Translate(e.x,e.y,e.z)}},{key:"Rotate",value:function(e){this.mMatrix.Rotate(0,0,e)}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=1,r=1,o={x:0,y:0,z:0},a={r:0,g:0,b:0,a:1},s=[],m=[],l=[],d=void 0,u=void 0,c=void 0,f=void 0,_=void 0,h=void 0,p=void 0,y=t.GL_DEPTH_TEST=0,E=t.GL_BLEND=1,T=(t.GL_MULTISAMPLE=2,t.GL_LINE_SMOOTH=3,t.GL_ONE=0),g=t.GL_SRC_ALPHA=1,v=(t.GL_PROJECTION=4,t.GL_POINTS=0),P=t.GL_LINES=1,S=t.GL_LINE_STRIP=2,I=t.GL_LINE_LOOP=3,w=t.GL_TRIANGLE_STRIP=4,b=t.CANVAS_WIDTH=480,M=t.CANVAS_HEIGHT=271,N=t.CANVAS_ZOOM=8,L=t.CANVAS_W=(b/N).toFixed(2),A=t.CANVAS_H=(M/N).toFixed(2),x=(t.gl_init=function(){var e=document.createElement("canvas");if(document.body.appendChild(e),e.width=b,e.height=M,window.gl=d=e.getContext("webgl"),d){var t=" attribute vec3 coordinates;attribute vec4 color;uniform vec3 position;uniform float pointSize;varying vec4 vColor;void main(void) {float x = (coordinates.x + position.x) / "+L+";float y = (coordinates.y + position.y) / "+A+";gl_Position = vec4(x, y, 0, 1.0);gl_PointSize = pointSize;vColor = color;}",i=" varying mediump vec4 vColor;void main(void) {gl_FragColor = vColor;}",o=d.createShader(d.VERTEX_SHADER);d.shaderSource(o,t),d.compileShader(o);var a=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(a,i),d.compileShader(a);var s=d.createProgram();d.attachShader(s,o),d.attachShader(s,a),d.linkProgram(s),d.useProgram(s),u=d.createBuffer(),c=d.createBuffer(),f=d.getAttribLocation(s,"color"),_=d.getAttribLocation(s,"coordinates"),h=d.getUniformLocation(s,"pointSize"),p=d.getUniformLocation(s,"position"),window.webgl={vertex_buffer:u,color_buffer:c,vertexColor:f,vertexCoordinates:_,vertexPointSize:h,pointSize:n,lineWidth:r,cameraPosition:p,type:v}}},t.glEnable=function(e){d=window.gl,e===y&&d.enable(d.DEPTH_TEST),e===E&&d.enable(d.BLEND)},t.glDisable=function(e){d=window.gl,e===y&&d.disable(d.DEPTH_TEST),e===E&&d.disable(d.BLEND)},t.glBlendFunc=function(e,t){d=window.gl,e=e||d.ONE,t=t||d.ZERO,e===T&&(e=d.ONE),t===g&&(t=d.SRC_ALPHA),d.blendFunc(d.SRC_ALPHA,d.ONE)},t.glViewport=function(e,t,i,n){d=window.gl,d.viewport(e,t,i,n)},t.glClearColor=function(e,t,i,n){d=window.gl,d.clearColor(e,t,i,n)},t.glClear=function(e){d=window.gl,e||(e=d.DEPTH_BUFFER_BIT|d.COLOR_BUFFER_BIT),d.clear(e)},t.glLineWidth=function(e){window.webgl.lineWidth=e},t.glPointSize=function(e){window.webgl.pointSize=e},t.glColor4f=function(e,t,i,n){a.r=e,a.g=t,a.b=i,a.a=n},t.glBegin=function(e){d=window.gl,d.type=e,d.bindBuffer(d.ARRAY_BUFFER,null),s.length=0,m.length=0,l.length=0},t.glVertex3d=function(e,t,i){m.push(e),m.push(t),m.push(i),s.push(a.r),s.push(a.g),s.push(a.b),s.push(a.a),l.push(4)});t.glVertex3f=function(e,t,i){x(e,t,i)},t.glTranslatef=function(e,t,i){d=window.gl,o.x=e,o.y=t,o.z=i},t.glEnd=function(){l.length&&(d=window.gl,n=window.webgl.pointSize,u=window.webgl.vertex_buffer,c=window.webgl.color_buffer,_=window.webgl.vertexCoordinates,f=window.webgl.vertexColor,h=window.webgl.vertexPointSize,p=window.webgl.cameraPosition,d.bindBuffer(d.ARRAY_BUFFER,u),d.vertexAttribPointer(_,3,d.FLOAT,!1,0,0),d.enableVertexAttribArray(_),d.bufferData(d.ARRAY_BUFFER,new Float32Array(m),d.STATIC_DRAW),d.bindBuffer(d.ARRAY_BUFFER,c),d.vertexAttribPointer(f,4,d.FLOAT,!1,0,0),d.enableVertexAttribArray(f),d.bufferData(d.ARRAY_BUFFER,new Float32Array(s),d.STATIC_DRAW),d.uniform1f(h,n),d.uniform3f(p,o.x,o.y,o.z),d.type===v&&d.drawArrays(d.POINTS,0,l.length),d.type!==P&&d.type!==S||d.drawArrays(d.LINES,0,l.length),d.type===I&&d.drawArrays(d.LINE_LOOP,0,l.length),d.type===w&&d.drawArrays(d.TRIANGLE_STRIP,0,l.length))},t.glEnable2D=function(){},t.glDisable2D=function(){},t.glMatrixMode=function(e){},t.glPushMatrix=function(){},t.glPopMatrix=function(){},t.glLoadIdentity=function(){},t.glMultMatrixf=function(e){},t.glFrustum=function(e,t,i,n,r,o){},t.gluPerspective=function(e,t,i,n){}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=arguments,r=!0;t.logfile_message=function(e){if(!r)return!1;n.length},t.logfile_fatal_error=function(e){if(!r)return!1;n.length}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.PI=3.14159;t.RADIAN=2*n,t.MAXINT=99999},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.v2d_lerp=t.v2d_dotproduct=t.v2d_normalize=t.v2d_magnitude=t.v2d_rotate=t.v2d_multiply=t.v2d_subtract=t.v2d_add=t.v2d_new=void 0;var n=i(10),r=i(12),o=t.v2d_new=function(e,t){return e=e||0,t=t||0,{x:e,y:t}},a=(t.v2d_add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},t.v2d_subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.v2d_multiply=function(e,t){return{x:t*e.x,y:t*e.y}},t.v2d_rotate=function(e,t){var i=e.x,n=e.y,r={};return r.x=i*Math.cos(t)-n*Math.sin(t),r.y=n*Math.cos(t)+i*Math.sin(t),r},t.v2d_magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)});t.v2d_normalize=function(e){var t=a(e);return t>n.EPSILON?o(e.x/t,e.y/t):o(0,0)},t.v2d_dotproduct=function(e,t){return e.x*t.x+e.y*t.y},t.v2d_lerp=function(e,t,i){var n=(0,r.clip)(i,0,1),a=1-n;return o(e.x*a+t.x*n,e.y*a+t.y*n)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.video_getMousePos=t.video_get_window_size=t.video_changemode=t.video_show_fps=t.video_is_fps_visible=t.video_is_fullscreen=t.video_is_smooth=t.video_get_resolution=t.video_get_gl=t.video_get_backbuffer=t.video_get_canvas=t.video_getCameraY=t.video_getCameraX=t.video_setCameraY=t.video_setFlipX=t.video_setCameraX=t.video_renderLoading=t.video_clearDisplay=t.video_fadefx_is_fading=t.video_fadefx_over=t.video_fadefx_out=t.video_fadefx_in=t.video_render=t.video_getScale=t.video_init=t.VIDEO_SCALE=t.VIDEO_SCREEN_H=t.VIDEO_SCREEN_W=t.VIDEORESOLUTION_EDT=t.VIDEORESOLUTION_MAX=t.VIDEORESOLUTION_2X=t.VIDEORESOLUTION_1X=void 0;var n=i(13),r=i(12),o=i(8),a=t.VIDEORESOLUTION_1X=0,s=t.VIDEORESOLUTION_2X=1,m=t.VIDEORESOLUTION_MAX=2,l=t.VIDEORESOLUTION_EDT=3,d=t.VIDEO_SCREEN_W=480,u=t.VIDEO_SCREEN_H=271,c=void 0,f=void 0,_=void 0,h=void 0,p=!1,y=!1,E=!1,T=0,g=1,v=2,P=void 0,S=void 0,I=void 0,w=void 0,b=void 0,M=0,N=0,L=!1,A=(t.VIDEO_SCALE=1,1),x=1,O=(t.video_init=function(e,t,i,n,r,o){k(t,i,n),G(o),c=document.getElementById("canvas"),c?(f=c.getContext("2d"),A=c.width/d,x=c.height/u,f.scale(c.width/d,c.height/u)):(c=document.createElement("canvas"),f=c.getContext("2d"),c.width=d,c.height=u,document.body.appendChild(c)),A=d/window.innerWidth,x=A,f.imageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1,_=f,O()},t.video_getScale=function(){return(0,o.v2d_new)(A,x)},t.video_render=function(){if(S=!1,P!=T)if((w+=(0,n.timer_get_delta)())<b){var e=void 0;e=parseInt(1.25*w/b*100,10),e=(0,r.clip)(e,0,100),e=P==g?100-e:e,e/=100,Y().fillStyle=I,Y().globalAlpha=e,Y().fillRect(0,0,c.width,c.height)}else P==v&&(Y().fillStyle=I,Y().fillRect(0,0,c.width,c.height)),P=T,b=w=0,I=0,S=!0;Y().globalAlpha=1,R()&&(Y().font="14px Arial",Y().fillStyle="white",Y().fillText((0,n.timer_get_fps)(),d-30,20))},t.video_fadefx_in=function(e,t){P==T&&(P=g,S=!1,I=e,w=0,b=t)},t.video_fadefx_out=function(e,t){P==T&&(P=v,S=!1,I=e,w=0,b=t)},t.video_fadefx_over=function(){return S},t.video_fadefx_is_fading=function(){return P!=T},t.video_clearDisplay=function(e){f.fillStyle=e?e:"rgb(0, 0, 0)",f.fillRect(0,0,c.width,c.height)}),Y=(t.video_renderLoading=function(e,t){O();var i=Y();i.beginPath(),i.rect(130,u/2-20,210,20),i.fillStyle="black",i.fill(),i.lineWidth=1,i.strokeStyle="white",i.stroke(),t=t<1?0:t>202?202:202/t,i.beginPath(),i.rect(134,u/2-17,t,14),i.fillStyle="white",i.fill(),i.lineWidth=1,i.strokeStyle="black",i.stroke(),i.font="14px Arial",i.fillStyle="white",i.fillText(e,130,u/2-30)},t.video_setCameraX=function(e){return M=e},t.video_setFlipX=function(e){return L=e},t.video_setCameraY=function(e){return N=e},t.video_getCameraX=function(){return M},t.video_getCameraY=function(){return N},t.video_get_canvas=function(){return c},t.video_get_backbuffer=function(){return _}),R=(t.video_get_gl=function(){return gl},t.video_get_resolution=function(){return h},t.video_is_smooth=function(){return p},t.video_is_fullscreen=function(){return y},t.video_is_fps_visible=function(){return E}),G=t.video_show_fps=function(e){E=e},k=t.video_changemode=function(e,t,i){h=e,y=i,p=t};t.video_get_window_size=function(){var e=d,t=u;switch(h){case a:e=d,t=u;break;case s:e=2*d,t=2*u;break;case m:e=d,t=u;break;case l:e=d,t=u}return(0,o.v2d_new)(e,t)},t.video_getMousePos=function(e,t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DATA_ROOT="",t.GAME_TITLE="Open Sonic",t.GAME_VERSION=1,t.GAME_SUB_VERSION=1,t.GAME_WIP_VERSION=1,t.GAME_WEBSITE="http://opensnc.sourceforge.net",t.EPSILON=1e-4,t.INFINITY=99999999,t.INFINITY_FLT=1/0,t.INT_MAX=999999999,t.PI=Math.PI,t.IF_NONE=0,t.IF_HFLIP=!0,t.IF_VFLIP=!0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resourcemanager_add_music=t.resourcemanager_add_sample=t.resourcemanager_add_image=t.resourcemanager_init=t.resourcemanager_getJsonFile=t.resourcemanager_getJsonFiles=void 0;var n=i(10),r=i(19),o={},a={},s={},m={},l=(t.resourcemanager_getJsonFiles=function(e){return Promise.all(e.map(l))},t.resourcemanager_getJsonFile=function(e){return e=n.DATA_ROOT+e,new Promise(function(t,i){if(m[e])return void t(m[e]);var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.onreadystatechange=function(){if(4===n.readyState){var i={};try{i=JSON.parse(n.responseText)}catch(e){}m[e]=i,t(i)}},n.send(null)})});t.resourcemanager_init=function(){o=(0,r.hashtable_image_t_create)(),a=(0,r.hashtable_sound_t_create)(),s=(0,r.hashtable_music_t_create)()},t.resourcemanager_add_image=function(e,t){(0,r.hashtable_image_t_add)(o,e,t)},t.resourcemanager_add_sample=function(e,t){(0,r.hashtable_sound_t_add)(a,e,t)},t.resourcemanager_add_music=function(e,t){(0,r.hashtable_music_t_add)(s,e,t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.old_school_angle=t.swap=t.circular_collision=t.bounding_box=t.clip=t.random=t.isInArray=t.isArray=t.isspace=t.runAnimation=void 0;var n=i(10),r=i(8),o=(t.runAnimation=function(e){function t(n){var r=!1;if(null!=i){r=e(Math.min(n-i,100)/1e3)===!1}i=n,r||requestAnimationFrame(t)}var i=null;requestAnimationFrame(t)},t.isspace=function(e){return" "==e},t.isArray=function(e){return void 0!==e&&e&&e.constructor===Array},t.isInArray=function(e,t){return t.indexOf(e)>-1},t.random=function(e){return o(parseInt(Math.random(e)*e,10),1,e)},t.clip=function(e,t,i){return Math.min(Math.max(e,t),i)}),a=(t.bounding_box=function(e,t){return e[0]<t[2]&&e[2]>t[0]&&e[1]<t[3]&&e[3]>t[1]},t.circular_collision=function(e,t,i,n){return(0,r.v2d_magnitude)((0,r.v2d_subtract)(e,i))<=t+n},t.swap=function(e,t){return a(e,t,e.length)},t.old_school_angle=function(e){return e>=0&&e<n.PI/4-n.EPSILON?0:e>=n.PI/4-n.EPSILON&&e<n.PI/2-n.EPSILON?n.PI/4:e>=n.PI/2-n.EPSILON&&e<n.PI/2+n.EPSILON?n.PI/2:e>=n.PI/2+n.EPSILON&&e<n.PI-n.EPSILON?3*n.PI/4:e>=n.PI-n.EPSILON&&e<n.PI+n.EPSILON?n.PI:e>=n.PI+n.EPSILON&&e<3*n.PI/2-n.EPSILON?5*n.PI/4:e>=3*n.PI/2-n.EPSILON&&e<3*n.PI/2+n.EPSILON?3*n.PI/2:e>3*n.PI/2+n.EPSILON&&e<=7*n.PI/4+n.EPSILON?7*n.PI/4:0},function(e,t,i){var n=e,r=t,o=void 0,a=void 0;for(o=0;o<i;o++)a=n[o],n[o]=r[o],r[o]=a;return[n[o],r[o]]})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timer_get_fps=t.timer_get_ticks=t.timer_get_delta=t.timer_release=t.timer_update=t.timer_init=void 0;var n=i(6),r=10,o=32,a=void 0,s=void 0,m=void 0,l=0,d=0,u=0,c=(t.timer_init=function(){(0,n.logfile_message)("timer_init()"),a=0,s=0,m=0,d=0,l=c()},t.timer_update=function(e){for(var t=0,i=0;i<r;){var n=c();i=n>l?n-l:0,l=n>=l?l:n}t=Math.min(t,o),d=.001*t,a++,s+=parseInt(t,10),s>=1e3&&(m=a,a=0,s=0),l=c()},t.timer_release=function(){(0,n.logfile_message)("timer_release()")},t.timer_get_delta=function(){return d},t.timer_get_ticks=function(){var e=f();return e<u&&(u=e),e-u}),f=(t.timer_get_fps=function(){return m},function(){return Math.floor(Date.now())})},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.enemies=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(2),a=i(43),s=i(1),m=i(0),l=i(59),d=1092,u=250;t.enemies=function(){function e(t,i){n(this,e);var r=this,s=0;r.mPlayers=t,r.mParticles=i,r.mEnemies=[],r.mLines=[],r.mActiveEnemies=new l.linkedList,r.idxWandererStart=s;for(var m=100,c=0;c<m;c++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_WANDERER,r.mPlayers,r));r.idxWandererEnd=s-1,r.idxGruntStart=s,m=100;for(var f=0;f<m;f++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_GRUNT,r.mPlayers,r));r.idxGruntEnd=s-1,r.idxSpinnerStart=s,m=25;for(var _=0;_<m;_++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_SPINNER,r.mPlayers,r));r.idxSpinnerEnd=s-1,r.idxTinySpinnerStart=s,m=50;for(var h=0;h<m;h++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_TINYSPINNER,r.mPlayers,r));r.idxTinySpinnerEnd=s-1,r.idxWeaverStart=s,m=100;for(var p=0;p<m;p++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_WEAVER,r.mPlayers,r));r.idxWeaverEnd=s-1,r.idxSnakeStart=s,m=50;for(var y=0;y<m;y++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_SNAKE,r.mPlayers,r));r.idxSnakeEnd=s-1,r.idxMayflyStart=s,m=200;for(var E=0;E<m;E++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_MAYFLY,r.mPlayers,r));r.idxMayflyEnd=s-1,r.idxProtonStart=s,m=200;for(var T=0;T<m;T++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_PROTON,r.mPlayers,r));r.idxProtonEnd=s-1,r.idxGeomSmallStart=s,m=100;for(var g=0;g<m;g++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_GEOM_SMALL,r.mPlayers,r));r.idxGeomSmallEnd=s-1,r.idxGeomMediumStart=s,m=100;for(var v=0;v<m;v++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_GEOM_MEDIUM,r.mPlayers,r));r.idxGeomMediumEnd=s-1,r.idxGeomLargeStart=s,m=100;for(var P=0;P<m;P++)s++,r.mEnemies.push((0,a.createEntity)(o.ENTITY_TYPE_GEOM_LARGE,r.mPlayers,r));r.idxGeomLargeEnd=s-1;for(var S=s;S<d;S++)r.mEnemies[S]=(0,a.createEntity)(o.ENTITY_TYPE_UNDEF);for(var I=0;I<u;I++)r.mLines[I]=(0,a.createEntity)(o.ENTITY_TYPE_LINE)}return r(e,[{key:"run",value:function(){for(var e=this,t=0;t<d;t++)switch(e.mEnemies[t].getState()){case o.ENTITY_STATE_SPAWN_TRANSITION:e.mActiveEnemies.add(e.mEnemies[t]),e.mEnemies[t].spawnTransition();break;case o.ENTITY_STATE_SPAWNING:e.mEnemies[t].spawn();break;case o.ENTITY_STATE_RUN_TRANSITION:e.mEnemies[t].runTransition();break;case o.ENTITY_STATE_RUNNING:e.mEnemies[t].run();break;case o.ENTITY_STATE_DESTROY_TRANSITION:e.mActiveEnemies.remove(e.mEnemies[t]),e.mEnemies[t].destroyTransition();break;case o.ENTITY_STATE_DESTROYED:e.mEnemies[t].destroy();break;case o.ENTITY_STATE_INDICATE_TRANSITION:e.mEnemies[t].indicateTransition();break;case o.ENTITY_STATE_INDICATING:e.mEnemies[t].indicating()}for(var i=0;i<u;i++)switch(e.mLines[i].getState()){case o.ENTITY_STATE_SPAWN_TRANSITION:e.mLines[i].spawnTransition();break;case o.ENTITY_STATE_SPAWNING:e.mLines[i].spawn();break;case o.ENTITY_STATE_RUN_TRANSITION:e.mLines[i].runTransition();break;case o.ENTITY_STATE_RUNNING:e.mLines[i].run();break;case o.ENTITY_STATE_DESTROY_TRANSITION:e.mLines[i].destroyTransition();break;case o.ENTITY_STATE_DESTROYED:e.mLines[i].destroy()}for(var n=0;n<d;n++)if(e.mEnemies[n].getType()!=o.ENTITY_TYPE_GEOM_SMALL&&e.mEnemies[n].getType()!=o.ENTITY_TYPE_GEOM_MEDIUM&&e.mEnemies[n].getType()!=o.ENTITY_TYPE_GEOM_LARGE&&e.mEnemies[n].getState()==o.ENTITY_STATE_RUNNING)for(var r=0;r<d;r++)if(e.mEnemies[r].getState()==o.ENTITY_STATE_RUNNING&&r!=n){var a=e.mEnemies[n],l=e.mEnemies[r],c=(0,s.calculate2dDistance)(a.getPos(),l.getPos()),f=a.getRadius()+l.getRadius();if(c<f){var _=(0,s.calculate2dAngle)(l.getPos(),a.getPos()),h=new m.Point3d(1,0,0);if(h=(0,s.rotate2dPoint)(h,_),a.getType()==o.ENTITY_TYPE_BLACKHOLE){var p=a;p&&p.mActivated&&a.setSpeed(a.getSpeed().add(h).multiply(.2))}else a.setPos(a.getPos().add(h).multiply(.02))}}}},{key:"draw",value:function(){for(var e=this,t=0;t<d;t++)e.mEnemies[t].getEnabled()&&e.mEnemies[t].draw();for(var i=0;i<u;i++)e.mLines[i].getEnabled()&&e.mLines[i].draw()}},{key:"hitTestEnemiesAtPosition",value:function(e,t,i){i=!1;for(var n=this.mActiveEnemies.start;null!==n;){if(n.data.getState()===o.ENTITY_STATE_RUNNING||i&&n.data.getState()==o.ENTITY_STATE_SPAWNING&&n.data.getType()!=o.ENTITY_TYPE_BLACKHOLE){var r=n.data.hitTest(e,t);if(r)return r}n=n.next}return null}},{key:"getNumActiveEnemiesOfType",value:function(e){var t=this,i=void 0,n=void 0;switch(e){case o.ENTITY_TYPE_WANDERER:i=t.idxWandererStart,n=t.idxWandererEnd;break;case o.ENTITY_TYPE_GRUNT:i=t.idxGruntStart,n=t.idxGruntEnd;break;case o.ENTITY_TYPE_SPINNER:i=t.idxSpinnerStart,n=t.idxSpinnerEnd;break;case o.ENTITY_TYPE_TINYSPINNER:i=t.idxTinySpinnerStart,n=t.idxTinySpinnerEnd;break;case o.ENTITY_TYPE_WEAVER:i=t.idxWeaverStart,n=t.idxWeaverEnd;break;case o.ENTITY_TYPE_SNAKE:i=t.idxSnakeStart,n=t.idxSnakeEnd;break;case o.ENTITY_TYPE_BLACKHOLE:i=t.idxBlackHoleStart,n=t.idxBlackHoleEnd;break;case o.ENTITY_TYPE_MAYFLY:i=t.idxMayflyStart,n=t.idxMayflyEnd;break;case o.ENTITY_TYPE_PROTON:i=idxProtonStart,n=idxProtonEnd;break;case o.ENTITY_TYPE_GEOM_SMALL:i=t.idxGeomSmallStart,n=t.idxGeomSmallEnd;break;case o.ENTITY_TYPE_GEOM_MEDIUM:i=t.idxGeomMediumStart,n=t.idxGeomMediumEnd;break;case o.ENTITY_TYPE_GEOM_LARGE:i=t.idxGeomLargeStart,n=t.idxGeomLargeEnd}for(var r=0,a=i;a<=n;a++)t.mEnemies[a].getState()!==o.ENTITY_STATE_INACTIVE&&++r;return r}},{key:"getUnusedEnemyOfType",value:function(e){var t=this,i=void 0,n=void 0;switch(e){case o.ENTITY_TYPE_WANDERER:i=t.idxWandererStart,n=t.idxWandererEnd;break;case o.ENTITY_TYPE_GRUNT:i=t.idxGruntStart,n=t.idxGruntEnd;break;case o.ENTITY_TYPE_SPINNER:i=t.idxSpinnerStart,n=t.idxSpinnerEnd;break;case o.ENTITY_TYPE_TINYSPINNER:i=t.idxTinySpinnerStart,n=t.idxTinySpinnerEnd;break;case o.ENTITY_TYPE_WEAVER:i=t.idxWeaverStart,n=t.idxWeaverEnd;break;case o.ENTITY_TYPE_SNAKE:i=t.idxSnakeStart,n=t.idxSnakeEnd;break;case o.ENTITY_TYPE_BLACKHOLE:i=t.idxBlackHoleStart,n=t.idxBlackHoleEnd;break;case o.ENTITY_TYPE_MAYFLY:i=t.idxMayflyStart,n=t.idxMayflyEnd;break;case o.ENTITY_TYPE_PROTON:i=t.idxProtonStart,n=t.idxProtonEnd;break;case o.ENTITY_TYPE_GEOM_SMALL:i=t.idxGeomSmallStart,n=t.idxGeomSmallEnd;break;case o.ENTITY_TYPE_GEOM_MEDIUM:i=t.idxGeomMediumStart,n=t.idxGeomMediumEnd;break;case o.ENTITY_TYPE_GEOM_LARGE:i=t.idxGeomLargeStart,n=t.idxGeomLargeEnd}for(var r=i;r<=n;r++)if(t.mEnemies[r].getState()===o.ENTITY_STATE_INACTIVE)return t.mEnemies[r];return null}},{key:"getUnusedLine",value:function(){for(var e=this,t=0;t<u;t++)if(e.mLines[t].getState()===o.ENTITY_STATE_INACTIVE)return e.mLines[t];return null}},{key:"explodeEntity",value:function(e){var t=this,i=e.getModel(),n=new m.Point3d(0,0,0),r=new m.Point3d(0,0,0);i.mMatrix.TransformVertex(n,r);for(var a=i.mNumEdges,l=0;l<a;l++){var d=t.getUnusedLine();if(d){var u=e.getPen();d.setPen(u);var c=i.mVertexList[i.mEdgeList[l].from],f=i.mVertexList[i.mEdgeList[l].to],_=new m.Point3d((c.x+f.x)/2,(c.y+f.y)/2,0);d.addEndpoints(c,f),d.setPos(r),d.setScale(e.getScale()),d.setAngle(e.getAngle());var h=(0,s.calculate2dAngle)(new m.Point3d(0,0,0),_),p=2*Math.random()-1,y=new m.Point3d(0,.2,0);return y=(0,s.rotate2dPoint)(y,h+p),y.add(e.getDrift().multiply(.1)),d.setSpeed(y),void d.setState(o.ENTITY_STATE_SPAWN_TRANSITION)}}}},{key:"disableAllEnemies",value:function(){for(var e=this,t=0;t<d;t++)e.mEnemies[t].setState(o.ENTITY_STATE_INACTIVE),e.mEnemies[t].incGenId()}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.game=t.GAMEMODE_CHANGINGLEVELS=t.GAMEOVER_LEVELCOMPLETE=t.GAMEMODE_GAMEOVER=t.GAMEMODE_GAMEOVER_TRANSITION=t.GAMEMODE_HIGHSCORES=t.GAMEMODE_HIGHSCORES_CHECK=t.GAMEMODE_PLAYING=t.GAMEMODE_CREDITED=t.GAMEMODE_ATTRACT=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(40),s=i(41),m=i(42),l=i(14),d=i(57),u=i(58),c=i(60),f=i(61),_=i(63),h=i(62),p=i(0),y=i(7),E=i(3),T=i(2),g=i(1),v=i(16),P=i(18),S=t.GAMEMODE_ATTRACT=0,I=t.GAMEMODE_CREDITED=1,w=t.GAMEMODE_PLAYING=2,b=t.GAMEMODE_HIGHSCORES_CHECK=3,M=t.GAMEMODE_HIGHSCORES=4,N=(t.GAMEMODE_GAMEOVER_TRANSITION=5,t.GAMEMODE_GAMEOVER=6,t.GAMEOVER_LEVELCOMPLETE=7),L=t.GAMEMODE_CHANGINGLEVELS=8,A="data/music/musicloop.wav";t.game=function(){function e(){n(this,e),this.music=(0,P.music_load)(A),this.mFreeplay=!0,this.mCredits=0,this.mNumPlayers=1,this.mLevel=0,this.m2PlayerNumLives=0,this.m2PlayerNumBombs=0,this.mParticles=new c.particle,this.mAttractors=new a.attractor,this.mGrid=new d.grid(this.mAttractors),this.mPlayers=new f.players(this.mAttractors,this.mGrid),this.mEnemies=new l.enemies(this.mPlayers,this.mParticles),this.mCamera=new m.camera(this.mPlayers,this.mGrid),this.mHyperspace=new u.hyperspace(this.mCamera),this.mStars=new _.stars(this.mGrid),this.mSpawner=new h.spawner(this.mPlayers,this.mEnemies,this.mGrid),this.mBomb=new s.bomb(this.mAttractors,this.mParticles,this.mEnemies),this.mCamera.center(),this.mAttractModeBlackHoles=[];for(var t=0;t<4;t++){this.mAttractModeBlackHoles[t]=new T.entity,this.mAttractModeBlackHoles[t].setPos(new p.Point3d(Math.random()*this.mGrid.extentX(),Math.random()*this.mGrid.extentY(),0)),this.mAttractModeBlackHoles[t].setEdgeBounce(!1);var i=Math.random()*(2*y.PI);if(40*Math.random()<1){Math.random(),y.PI}var r=new p.Point3d(1,0,0);r=(0,g.rotate2dPoint)(r,i),this.mAttractModeBlackHoles[t].setDrift(r)}this.mGameMode=S,this.mCameraLevelZoom=1}return r(e,[{key:"run",value:function(){var e=this;switch(this.mFreeplay&&(this.mCredits=2),this.mAttractors.clearAll(),this.mCamera.run(),this.mGameMode){case S:this.mCredits>0&&(this.mGameMode=I);break;case I:this.startGame(1);case w:this.mCamera.mZoomOverride=900*this.mCameraLevelZoom,this.mCameraLevelZoom*=.97,this.mLevelStartWaitTimer>0&&--this.mLevelStartWaitTimer,this.mCamera.followPlayer(),this.mStars.run(),this.mPlayers.run(),this.mBomb.run(),this.mLevelStartWaitTimer<=0&&this.mSpawner.run(),this.mEnemies.run()}if(this.mGrid.run(),this.mGameMode==b||this.mGameMode==M);else if(this.mGameMode==S||this.mGameMode==I){this.mCameraLevelZoom=1,this.mCamera.mZoomOverride=0,this.mCamera.center();for(var t=this.mGrid.extentX(),i=this.mGrid.extentY(),n=0;n<4;n++){e.mAttractModeBlackHoles[n].setState(T.ENTITY_STATE_RUNNING),e.mAttractModeBlackHoles[n].run();var r=e.mAttractModeBlackHoles[n].getPos(),o=e.mAttractors.getAttractor();o&&(o.strength=-40,o.zStrength=0,o.radius=20,o.pos=r,o.enabled=!0,o.attractsParticles=!0);for(var a=0;a<4;a++)if(n!=a){var s=(0,g.calculate2dAngle)(e.mAttractModeBlackHoles[a].getPos(),e.mAttractModeBlackHoles[n].getPos()),m=(0,g.calculate2dDistance)(e.mAttractModeBlackHoles[a].getPos(),e.mAttractModeBlackHoles[n].getPos()),l=8;m<e.mAttractModeBlackHoles[n].getRadius()&&(m=e.mAttractModeBlackHoles[n].getRadius());var d=1/(m*m),u=new p.Point3d(d*l,0,0),c=(0,g.rotate2dPoint)(u,s+.4),f=e.mAttractModeBlackHoles[a].getDrift();f.x+=c.x,f.y+=c.y,e.mAttractModeBlackHoles[a].setDrift(f)}if(40*Math.random()<1){Math.random(),y.PI}var _=e.mAttractModeBlackHoles[n].getDrift(),h=e.mAttractModeBlackHoles[n].getPos(),v=2,P=2,N=t-2-1,L=i-2-1;h.x<=v?(_.x=-_.x,h.x=v):h.x>=N&&(_.x=-_.x,h.x=N),h.y<=P?(_.y=-_.y,h.y=P):h.y>=L&&(_.y=-_.y,h.y=L),e.mAttractModeBlackHoles[n].setDrift(_),e.mAttractModeBlackHoles[n].setPos(h)}for(var A=0,x=0;x<4;x++){A+=.08;var O=new p.Point3d(Math.random()*t,Math.random()*i),Y=new p.Point3d(0,0,0),R=2,G=2*y.PI,k=50,C=1e3,D=Math.sin(A+2*y.PI/1)+.1,V=Math.sin(A+2*y.PI/2)+.1,j=Math.sin(A+2*y.PI/3)+.1,W=new E.pen(D,V,j,1,4);this.mParticles.emitter(O,Y,R,G,k,W,C,!0,!1,.95,!0)}}this.mParticles.run()}},{key:"draw",value:function(e){(0,o.glTranslatef)(-this.mCamera.mCurrentPos.x,-this.mCamera.mCurrentPos.y,-this.mCamera.mCurrentPos.z),(0,o.glDisable)(o.GL_MULTISAMPLE),(0,o.glDisable)(o.GL_LINE_SMOOTH),this.mGrid.draw(),(0,o.glDisable)(o.GL_MULTISAMPLE),(0,o.glDisable)(o.GL_LINE_SMOOTH),e===v.RENDERPASS_PRIMARY?((0,o.glLineWidth)(4),this.mParticles.draw()):((0,o.glLineWidth)(8),this.mParticles.draw()),this.mGameMode==w&&((0,o.glLineWidth)(4),this.mEnemies.draw()),this.mGameMode!=w&&this.mGameMode!=L&&this.mGameMode!=N||((0,o.glLineWidth)(4),(0,o.glPointSize)(2),this.mPlayers.draw()),this.mGameMode==L&&e===v.RENDERPASS_PRIMARY&&this.mHyperspace.draw(),(0,o.glDisable)(o.GL_LINE_SMOOTH),(0,o.glDisable)(o.GL_MULTISAMPLE),e===v.RENDERPASS_PRIMARY&&this.mStars.draw(),(0,o.glLineWidth)(4),this.mBomb.draw()}},{key:"startGame",value:function(e){(0,P.music_play)(this.music,!0),this.mPlayers.setEnemies(this.mEnemies),this.mPlayers.mPlayer1.setGame(this),this.mPlayers.mPlayer1.setEnemies(this.mEnemies),this.mPlayers.mPlayer1.setBomb(this.mBomb),this.mPlayers.mPlayer1.setParticles(this.mParticles),this.mNumPlayers=e,this.mCamera.center(),this.mLevel=0,this.mGrid.startLevel(this.mLevel),this.mSkillLevel=0,this.mSpawner.init(),1==this.mNumPlayers&&this.mPlayers.mPlayer1.initPlayerForGame(),this.mGameMode=w,this.mMusicSpeed=1,this.mMusicSpeedTarget=1,this.mCameraLevelZoom=1,this.mLevelStartWaitTimer=200,this.mWeaponChangeTimer=0,this.mLevelAdvanceCounter=0,this.mLevelComplete=!1,this.mParticles.killAll()}},{key:"endGame",value:function(){this.mCamera.center(),this.mPlayers.mPlayer1.setState(T.ENTITY_STATE_INACTIVE),this.mPlayers.mPlayer2.setState(T.ENTITY_STATE_INACTIVE),this.mEnemies.disableAllEnemies(),this.mGrid.endLevel()}},{key:"showMessageAtLocation",value:function(e,t,i){}},{key:"runPointDisplays",value:function(){for(var e=0;e<NUM_POINT_DISPLAYS;e++)this.mPointDisplays[e].enabled&&--this.mPointDisplays[e].timer<=0&&(this.mPointDisplays[e].enabled=!1)}},{key:"drawPointDisplays",value:function(){}},{key:"clearPointDisplays",value:function(){for(var e=0;e<NUM_POINT_DISPLAYS;e++)this.mPointDisplays[e].enabled=!1}},{key:"incrementLevelComplete",value:function(){var e=100*this.mNumPlayers;++this.mLevelAdvanceCounter>=e&&this.doLevelComplete()}},{key:"doLevelComplete",value:function(){this.mLevelComplete=!1,this.mLevelAdvanceCounter=0,this.mLevelChangeTimer=0,this.mGameMode=N,this.mPlayers.mPlayer1.addPointsNoMultiplier(10*this.mPlayers.mPlayer1.getGeoms()),this.mPlayers.mPlayer2.addPointsNoMultiplier(10*this.mPlayers.mPlayer2.getGeoms()),this.mWeaponChangeTimer=0,this.mPlayers.mPlayer1.switchWeapons(),this.mPlayers.mPlayer2.switchWeapons(),this.mSpawner.clearWaveListEntities(),this.mHyperspace.mTargetBrightness=1}},{key:"advanceLevel",value:function(){++this.mLevel,this.clearPointDisplays(),this.mGrid.endLevel(),this.mLevelChangeTimer=0,this.mLevelStartWaitTimer=400,this.mGameMode=L}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.scene=t.VIRTUAL_SCREEN_HEIGHT=t.VIRTUAL_SCREEN_WIDTH=t.RENDERPASS_BLUR=t.RENDERPASS_PRIMARY=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(15),s=i(0),m=i(4),l=(i(8),i(13)),d=(t.RENDERPASS_PRIMARY=0,t.RENDERPASS_BLUR=1,t.VIRTUAL_SCREEN_WIDTH=800,t.VIRTUAL_SCREEN_HEIGHT=600,void 0);t.scene=function(){function e(){n(this,e),this.mAttractModeTimer=0,this.mShowHighScores=!1;var t=0;for(this.mShieldSymbol={},this.mShieldSymbol.mNumVertex=12,this.mShieldSymbol.mVertexList=[],this.mShieldSymbol.mVertexList[t++]=new s.Point3d(8.1,8.1),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(11.5,0),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(8.1,-8.1),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(0,-11.5),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(-8.1,-8.1),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(-11.5,0),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(-8.1,8.1),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(0,4),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(0,-4),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(-4,0),this.mShieldSymbol.mVertexList[t++]=new s.Point3d(4,0),this.mShieldSymbol.mNumEdges=10,this.mShieldSymbol.mEdgeList=[],t=0;t<this.mShieldSymbol.mNumEdges;t++)this.mShieldSymbol.mEdgeList.push(new m.Edge);t=0,this.mShieldSymbol.mEdgeList[t].from=0,this.mShieldSymbol.mEdgeList[t++].to=1,this.mShieldSymbol.mEdgeList[t].from=1,this.mShieldSymbol.mEdgeList[t++].to=2,this.mShieldSymbol.mEdgeList[t].from=2,this.mShieldSymbol.mEdgeList[t++].to=3,this.mShieldSymbol.mEdgeList[t].from=3,this.mShieldSymbol.mEdgeList[t++].to=4,this.mShieldSymbol.mEdgeList[t].from=4,this.mShieldSymbol.mEdgeList[t++].to=5,this.mShieldSymbol.mEdgeList[t].from=5,this.mShieldSymbol.mEdgeList[t++].to=6,this.mShieldSymbol.mEdgeList[t].from=6,this.mShieldSymbol.mEdgeList[t++].to=7,this.mShieldSymbol.mEdgeList[t].from=7,this.mShieldSymbol.mEdgeList[t++].to=0,this.mShieldSymbol.mEdgeList[t].from=8,this.mShieldSymbol.mEdgeList[t++].to=9,this.mShieldSymbol.mEdgeList[t].from=10,this.mShieldSymbol.mEdgeList[t++].to=11}return r(e,[{key:"init",value:function(){this.level_timer=0,d=new a.game}},{key:"run",value:function(){d.run(),this.level_timer+=(0,l.timer_get_delta)()}},{key:"draw",value:function(e){(0,o.glClearColor)(0,0,0,1),(0,o.glClear)(),(0,o.glDisable)(o.GL_DEPTH_TEST),(0,o.glEnable)(o.GL_BLEND),(0,o.glBlendFunc)(o.GL_SRC_ALPHA,o.GL_ONE),d.draw(e)}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=t.drawLine=t.Point2Vector=t.fmod=void 0;var n=i(8),r=i(9),o=i(7),a=100*o.PI/180,s=80*o.PI/180,m=r.VIDEO_SCREEN_W/2/Math.tan(a/2),l=r.VIDEO_SCREEN_H/2/Math.tan(s/2);t.fmod=function(e,t){return Number((e-Math.floor(e/t)*t).toPrecision(8))},t.Point2Vector=function(e,t,i){var o=(0,n.v2d_new)(e*m/i,t*l/i);return o.x+=r.VIDEO_SCREEN_W/2,o.y=r.VIDEO_SCREEN_H/2-o.y,o},t.drawLine=function(e,t,i){var n=(0,r.video_get_backbuffer)();n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.strokeStyle=i,n.lineWidth=.2,n.stroke()},t.drawRect=function(e,t,i){var n=(0,r.video_get_backbuffer)();n.fillStyle=i,n.fillRect(e.x,e.y,3*t,3*t)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sound_is_playing=t.sound_stop=t.sound_play_ex=t.sound_play=t.sound_load=t.music_is_playing=t.music_get_volume=t.music_set_volume=t.music_resume=t.music_pause=t.music_stop=t.music_play=t.music_load=t.audio_release=t.audio_update=t.audio_init=void 0;var n=i(10),r=i(11),o=i(6),a=null,s=(t.audio_init=function(){},t.audio_update=function(){},t.audio_release=function(){},t.music_load=function(e){(0,o.logfile_message)("music_load('%s')",e);var t=new Audio;return t.src=e,(0,r.resourcemanager_add_music)(e,t),t},t.music_play=function(e,t){m()&&s(),null!=e&&(e.loop=!!t,e.play()),a=e},t.music_stop=function(){null!=a&&a.pause(),a=null}),m=(t.music_pause=function(){null==a||a.is_paused||(a.is_paused=!0,a.pause())},t.music_resume=function(){null!=a&&a.is_paused&&(a.is_paused=!1,a.play())},t.music_set_volume=function(e){null!=a&&(e>1&&(e=1),e<0&&(e=0),a.volume=e)},t.music_get_volume=function(){return null!=a?a.volume:0},t.music_is_playing=function(){return null!=a&&!a.paused}),l=(t.sound_load=function(e,t){t=n.DATA_ROOT+t;var i=new Audio;i.src=t;var o=new Audio;o.src=t;var a=new Audio;a.src=t;var s=new Audio;return s.src=t,(0,r.resourcemanager_add_sample)(e,i),(0,r.resourcemanager_add_sample)(e+"2",o),(0,r.resourcemanager_add_sample)(e+"3",a),(0,r.resourcemanager_add_sample)(e+"4",s),i},t.sound_play=function(e){l(e,1,0,1,0)},t.sound_play_ex=function(e,t,i,n,r){e&&e.play&&e.play()});t.sound_stop=function(e){e&&e.stop()},t.sound_is_playing=function(e){return!!e&&!e.paused}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};t.hashtable_spriteinfo_t_create=function(){return n.sprites={},n.sprites},t.hashtable_spriteinfo_t_add=function(e,t,i){n.sprites[t]=i},t.hashtable_spriteinfo_t_find=function(e,t){return n.sprites[t]},t.hashtable_sprites=function(){return n.sprites},t.hashtable_image_t_create=function(){return n.images={},n.images},t.hashtable_image_t_add=function(e,t,i){e[t]=i},t.hashtable_sound_t_create=function(){return n.samples={},n.samples},t.hashtable_sound_t_add=function(e,t,i){e[t]=i},t.hashtable_sound_t_find=function(e,t){return n.samples[t]},t.hashtable_music_t_create=function(){return n.musics={},n.musics},t.hashtable_music_t_add=function(e,t,i){e[t]=i}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityGeom=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(3),d=i(1),u=i(0);t.entityGeom=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setState(m.ENTITY_STATE_INACTIVE),e.mEdgeBounce=!0,e.mLifetime=0,e.mPen=new l.pen(1,1,0,.7,12),e}return o(t,e),a(t,[{key:"run",value:function(){var e=this;if(--e.mLifetime,e.mLifetime<=0&&(e.mState=m.ENTITY_STATE_INACTIVE),e.getEnabled()){var i=e.mPlayers.getPlayerClosestToPosition(e.mPos);if(i){var n=(0,d.calculate2dDistance)(i.getPos(),e.mPos);if(n<17)if(e.mLifetime=250,n<4)e.mState=m.ENTITY_STATE_INACTIVE,i.addGeom(e.mScoreValue);else{var r=(0,d.calculate2dAngle)(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),o=new u.Point3d(2,0,0);o=(0,d.rotate2dPoint)(o,r),e.mSpeed.add(o).multiply(.2),e.mSpeed.multiply(.8)}}}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"draw",value:function(){var e=.7;this.mLifetime<100&&(e=this.mLifetime/200*.7),this.mLifetime<200&&this.mLifetime/2&1&&(e/=2),this.mPen=new l.pen(1,1,0,e,12),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this)}},{key:"hit",value:function(e){}},{key:"spawnTransition",value:function(){this.mLifetime=350,this.mState=m.ENTITY_STATE_RUNNING}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityPlayerMissile=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(0),d=i(4),u=i(3),c=i(17),f=i(1),_=i(14),h=i(7);t.entityPlayerMissile=function(e){function t(e,i,o,a){n(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s.mAttractors=e,s.mEnemies=i,s.mGrid=o,s.mParticles=a,s.mScale=.16,s.mRadius=1,s.mType=0,s.mPlayerSource=1,s.mScoreValue=0,s.mSpawnTime=0,s.mDestroyTime=0,s.mType=m.ENTITY_TYPE_PLAYER_MISSILE;var u=0;s.mModel.mNumVertex=3,s.mModel.mVertexList=[],s.mModel.mVertexList[u++]=new l.Point3d(0,7.5),s.mModel.mVertexList[u++]=new l.Point3d(2,-5.2),s.mModel.mVertexList[u++]=new l.Point3d(-2,-5.2),s.mModel.mNumEdges=3,s.mModel.mEdgeList=[];for(var c=0;c<s.mModel.mNumEdges;c++)s.mModel.mEdgeList.push(new d.Edge);return u=0,s.mModel.mEdgeList[u].from=0,s.mModel.mEdgeList[u++].to=1,s.mModel.mEdgeList[u].from=1,s.mModel.mEdgeList[u++].to=2,s.mModel.mEdgeList[u].from=2,s.mModel.mEdgeList[u++].to=0,s}return o(t,e),a(t,[{key:"run",value:function(e,t,i){var n=this;this.mEnemies=e,this.mGrid=t,this.mParticles=i,this.mLastPos=this.mPos;var r=!1;if(n.mEnemies)for(var o=0;o<_.NUM_ENEMIES;o++)if(n.mEnemies[o]&&n.mEnemies[o].getType()==m.ENTITY_TYPE_BLACKHOLE&&n.mEnemies[o].getState()==m.ENTITY_STATE_RUNNING){var a=n.mEnemies[o];if(a.mActivated){var s=(0,f.calculate2dDistance)(n.mPos,a.getPos());if(s<20){var d=new l.Point3d(a.getPos().x,a.getPos().y,a.getPos().z),u=new l.Point3d(n.mPos.x,n.mPos.y,n.mPos.z),p=mod((0,f.calculate2dAngle)(u,d),2*h.PI),y=mod(getAngle()+(0,f.DegreesToRads)(90),2*h.PI),E=(0,f.diffAngles)(p,y),T=Math.abs(E);T<.8&&(n.mRotationRate+=.1*E,r=!0)}}}if(n.mRotationRate*=.5,r){var g=new l.Point3d(this.mVelocity,0,0);n.mSpeed=(0,f.rotate2dPoint)(g,n.mAngle+(0,f.DegreesToRads)(90))}if(this.mPos.add(this.mSpeed),this.mPos.add(this.mDrift),this.mAngle-=n.mRotationRate,this.mAngle=(0,c.fmod)(n.mAngle,2*h.PI),this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mPos),this.mDrift.multiply(.95),this.getEnabled()){for(var v=!1,P=0;P<10;P++){var S=P/10,I=1-S,w=new l.Point3d(n.mPos.x*S+n.mLastPos.x*I,n.mPos.y*S+n.mLastPos.y*I,0);if(n.mEnemies){var b=n.mEnemies.hitTestEnemiesAtPosition(w,n.getRadius(),!0);b&&(n.setState(m.ENTITY_STATE_DESTROY_TRANSITION),b.hit(n))}}if(!v)if(n.mGrid&&n.mGrid.hitTest(n.mPos,0)&&(n.setState(m.ENTITY_STATE_DESTROY_TRANSITION),n.mSpeed=new l.Point3d(0,0,0)),0==n.mType){var M=n.mAttractors.getAttractor();M&&(M.strength=5,M.zStrength=0,M.radius=5,M.pos=n.mPos,M.enabled=!0,M.attractsParticles=!1)}else if(1==n.mType){var N=n.mAttractors.getAttractor();N&&(N.strength=5,N.zStrength=0,N.radius=5,N.pos=n.mPos,N.enabled=!0,N.attractsParticles=!1)}else if(2==n.mType){var L=n.mAttractors.getAttractor();L&&(L.strength=50,L.zStrength=0,L.radius=5,L.pos=n.mPos,L.enabled=!0,L.attractsParticles=!1)}}}},{key:"spawnTransition",value:function(){this.spawn(),this.setState(m.ENTITY_STATE_RUNNING),this.mRotationRate=0,this.run()}},{key:"destroyTransition",value:function(){this.mStateTimer=this.mDestroyTime,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.setState(m.ENTITY_STATE_INACTIVE)}},{key:"draw",value:function(){this.getState()==m.ENTITY_STATE_RUNNING&&(this.mPen=0==this.mPlayerSource?new u.pen(1,.9,.2,.7,12):new u.pen(.5,.5,1,.7,12),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this))}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.input_get_xy=t.input_clear=t.input_is_ignored=t.input_restore=t.input_ignore=t.input_simulate_button_down=t.input_button_howlong=t.input_button_up=t.input_button_pressed=t.input_button_down=t.input_destroy=t.input_create_user=t.input_create_joystick=t.input_create_mouse=t.input_create_keyboard=t.input_create_computer=t.input_is_joystick_ignored=t.input_ignore_joystick=t.input_joystick_available=t.input_release=t.input_render=t.input_update=t.input_init=t.IB_A=t.IB_D=t.IB_S=t.IB_W=t.IB_AXES_RIGHT=t.IB_AXES_LEFT=t.IB_FIRE5=t.IB_FIRE4=t.IB_FIRE3=t.IB_FIRE2=t.IB_FIRE1=t.IB_LEFT=t.IB_RIGHT=t.IB_DOWN=t.IB_UP=t.KEY_A=t.KEY_D=t.KEY_S=t.KEY_W=t.KEY_TILDA=t.KEY_ESC=t.KEY_ENTER=t.KEY_LCONTROL=t.KEY_SPACE=t.KEY_LEFT=t.KEY_RIGHT=t.KEY_DOWN=t.KEY_UP=void 0;var r=i(6),o=i(33),a=i(13),s=i(8),m=i(9),l=i(38),d=n(l),u=0,c=1,f=2,_=3,h=4,p=9,y=t.KEY_UP=38,E=t.KEY_DOWN=40,T=t.KEY_RIGHT=39,g=t.KEY_LEFT=37,v=t.KEY_SPACE=32,P=t.KEY_LCONTROL=17,S=t.KEY_ENTER=13,I=t.KEY_ESC=27,w=t.KEY_TILDA=192,b=(t.KEY_W=87,t.KEY_S=83,t.KEY_D=68,t.KEY_A=65,t.IB_UP=1),M=t.IB_DOWN=2,N=t.IB_RIGHT=3,L=t.IB_LEFT=4,A=t.IB_FIRE1=5,x=t.IB_FIRE2=6,O=t.IB_FIRE3=7,Y=t.IB_FIRE4=8,R=t.IB_FIRE5=9,G=t.IB_AXES_LEFT=10,k=t.IB_AXES_RIGHT=11,C=t.IB_W=12,D=t.IB_S=13,V=t.IB_D=14,j=t.IB_A=15,W=null,B=void 0,H=void 0,F=!1,U={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda",87:"w",83:"s",68:"d",65:"a"},X=void 0,z=void 0,K=void 0,Z=void 0,q=void 0,$=void 0,J=void 0,Q={x:0,y:0},ee={left:!1,middle:!1,right:!1},te=!1,ie=(t.input_init=function(){(0,r.logfile_message)("input_init()"),W=null,B=!1,H=!1,$=(0,o.osspec_canGamepad)(),F=(0,o.osspec_isTouch)(),F&&(z=new d.default({container:(0,m.video_get_canvas)(),strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50}),z.addEventListener("touchStartValidation",function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2)&&!(t.pageY<window.innerHeight/2)}),K=new d.default({container:(0,m.video_get_canvas)(),strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50}),K.addEventListener("touchStartValidation",function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2)&&!(t.pageY<window.innerHeight/2)}),Z=new d.default({container:(0,m.video_get_canvas)(),strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50}),Z.addEventListener("touchStartValidation",function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2)&&!(t.pageY>window.innerHeight/2)}),q=new d.default({container:(0,m.video_get_canvas)(),strokeStyle:"rgba(255,255,255,0.1)",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50}),q.addEventListener("touchStartValidation",function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2)&&!(t.pageY>window.innerHeight/2)})),X=ae(U)},t.input_update=function(){var e=void 0,t=(0,a.timer_get_delta)(),i=void 0;for(i=W;i;i=i.next){for(e=0;e<p;e++)i.data.oldstate[e]=i.data.state[e];for(e=0;e<p;e++)ne(i.data,e)?i.data.howlong[e]+=t:i.data.howlong[e]=0;switch(i.data.type){case c:i.data.state[b]=X.up,i.data.state[M]=X.down,i.data.state[L]=X.left,i.data.state[N]=X.right,i.data.state[A]=X.space,i.data.state[x]=X.lcontrol,i.data.state[O]=X.enter,i.data.state[Y]=X.esc,i.data.state[R]=X.tilda;break;case h:i.data.x=Q.x,i.data.y=Q.y,i.data.state[A]=ee.left,i.data.state[O]=ee.middle,i.data.state[x]=ee.right;break;case f:for(e=0;e<p;e++)i.data.state[e]=!1;break;case _:ie()&&(i.data.state[b]=joy[0].stick[0].axis[1].d1,i.data.state[M]=joy[0].stick[0].axis[1].d2,i.data.state[L]=joy[0].stick[0].axis[0].d1,i.data.state[N]=joy[0].stick[0].axis[0].d2,i.data.state[A]=joy[0].button[0].b,i.data.state[x]=joy[0].button[1].b,i.data.state[O]=joy[0].button[2].b,i.data.state[Y]=joy[0].button[3].b);break;case u:i.data.state[b]=X.up,i.data.state[M]=X.down,i.data.state[L]=X.left,i.data.state[N]=X.right,i.data.state[A]=X.space,i.data.state[x]=X.lcontrol,i.data.state[O]=X.enter,i.data.state[Y]=X.esc,i.data.state[C]=X.w,i.data.state[j]=X.a,i.data.state[D]=X.s,i.data.state[V]=X.d,F&&(i.data.state[C]=z.up(),i.data.state[D]=z.down(),i.data.state[j]=z.left(),i.data.state[V]=z.right(),i.data.state[b]=K.up(),i.data.state[M]=K.down(),i.data.state[L]=K.left(),i.data.state[N]=K.right(),i.data.state[Y]=Z._pressed,i.data.state[x]=q._pressed),$&&(J=se()),J&&(te||(te=!0),i.data.state[G]={x:-J.axes[1],y:-J.axes[0],z:0},i.data.state[k]={x:-J.axes[3],y:-J.axes[2],z:0},i.data.state[b]=J.buttons[12].pressed,i.data.state[M]=J.buttons[13].pressed,i.data.state[L]=J.buttons[14].pressed,i.data.state[N]=J.buttons[15].pressed,i.data.state[A]=J.buttons[0].pressed,i.data.state[x]=J.buttons[1].pressed,i.data.state[O]=J.buttons[2].pressed,i.data.state[Y]=J.buttons[3].pressed)}}},t.input_render=function(){z&&z.render((0,m.video_get_backbuffer)()),K&&K.render((0,m.video_get_backbuffer)())},t.input_release=function(){},t.input_joystick_available=function(){return B&&!H}),ne=(t.input_ignore_joystick=function(e){H=e},t.input_is_joystick_ignored=function(){return H},t.input_create_computer=function(){var e={},t=void 0;for(e.type=f,e.enabled=!0,e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<p;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return re(e),e},t.input_create_keyboard=function(e){var t={},i=void 0;for(t.type=c,t.enabled=!0,t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],i=0;i<p;i++)t.state[i]=t.oldstate[i]=!1,t.howlong[i]=0;if(e)for(t.keybmap=[],i=0;i<p;i++)t.keybmap[i]=e[i];else t.keybmap[b]=y,t.keybmap[M]=E,t.keybmap[N]=T,t.keybmap[L]=g,t.keybmap[A]=v,t.keybmap[x]=P,t.keybmap[O]=S,t.keybmap[Y]=I,t.keybmap[R]=w;return re(t),t},t.input_create_mouse=function(){var e={},t=void 0;for(e.type=h,e.enabled=!0,e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<p;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return re(e),e},t.input_create_joystick=function(){if(!ie())return(0,r.logfile_message)("WARNING: called input_create_joystick(), but no joystick is available!"),null;var e=void 0,t={};for(t.type=_,t.enabled=!0,t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<p;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return re(t),t},t.input_create_user=function(){var e={};e.type=u,e.enabled=!0,e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[];for(var t=0;t<p;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return e.keybmap=[],e.keybmap[b]=y,e.keybmap[M]=E,e.keybmap[N]=T,e.keybmap[L]=g,e.keybmap[A]=v,e.keybmap[x]=P,e.keybmap[O]=S,e.keybmap[Y]=I,re(e),e},t.input_destroy=function(e){oe(e),e=null},t.input_button_down=function(e,t){return!!t&&(!!e.enabled&&e.state[parseInt(t,10)])}),re=(t.input_button_pressed=function(e,t){return!!t&&(!!e.enabled&&(e.state[parseInt(t,10)]&&!e.oldstate[parseInt(t,10)]))},t.input_button_up=function(e,t){return!t||!!e.enabled&&(!e.state[parseInt(t,10)]&&e.oldstate[parseInt(t,10)])},t.input_button_howlong=function(e,t){return e.enabled?e.howlong[parseInt(t,10)]:0},t.input_simulate_button_down=function(e,t){e.state[parseInt(t,10)]=!0},t.input_ignore=function(e){e.enabled=!1},t.input_restore=function(e){e.enabled=!0},t.input_is_ignored=function(e){return!e.enabled},t.input_clear=function(e){for(var t=0;t<p;t++)e.state[t]=e.oldstate[t]=!1},t.input_get_xy=function(e){return(0,s.v2d_new)(e.x,e.y)},function(e){var t={};t.data=e,t.next=W,W=t}),oe=function(e){var t=void 0,i=void 0;if(W.data==e)i=W.next,W=null,W=i;else{for(t=W;t.next&&t.next.data!=e;)t=t.next;t.next&&(i=t.next.next,t.next=null,t.next=i)}},ae=function(e){function t(t){if(e.hasOwnProperty(t.keyCode)){var n="keydown"==t.type;i[e[t.keyCode]]=n,t.preventDefault()}}var i=Object.create(null);return addEventListener("keydown",t),addEventListener("keyup",t),i},se=function(){return"undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lang_get=t.lang_getstring=t.lang_loadfile=t.lang_release=t.lang_init=void 0;var n=i(6),r=i(11),o="data/languages/english.json",a={},s=(t.lang_init=function(e,t){(0,n.logfile_message)("Initializing the language module"),o=e?e:o,s(o).then(function(e){(0,n.logfile_message)("lang_init() ok!"),t()})},t.lang_release=function(){},t.lang_loadfile=function(e){return new Promise(function(t,i){(0,n.logfile_message)('lang_loadfile("%s")...',e),(0,r.resourcemanager_getJsonFile)(e).then(function(e){a=e,t(e)})})}),m=t.lang_getstring=function(e,t,i){return a[e]||e};t.lang_get=function(e){return m(e)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preferences_set_language=t.preferences_set_show_fps=t.preferences_set_smooth_graphics=t.preferences_set_fullscreen=t.preferences_set_video_resolution=t.preferences_get_language=t.preferences_get_show_fps=t.preferences_get_smooth_graphics=t.preferences_get_fullscreen=t.preferences_get_video_resolution=t.preferences_init=void 0;var n=i(6),r={video_resolution:null,fullscreen:null,smooth_graphics:null,show_fps:null,language:null},o=(t.preferences_init=function(){(0,n.logfile_message)("preferences_init()"),a()},t.preferences_get_video_resolution=function(){return r.video_resolution},t.preferences_get_fullscreen=function(){return r.fullscreen},t.preferences_get_smooth_graphics=function(){return r.smooth_graphics},t.preferences_get_show_fps=function(){return r.show_fps},t.preferences_get_language=function(){return r.language},t.preferences_set_video_resolution=function(e){r.video_resolution=e,s()},t.preferences_set_fullscreen=function(e){r.fullscreen=e,s()},t.preferences_set_smooth_graphics=function(e){r.smooth_graphics=e,s()},t.preferences_set_show_fps=function(e){r.show_fps=e,s()},t.preferences_set_language=function(e){r.language=e,s()},function(){r.video_resolution="TINY",r.fullscreen=!1,r.smooth_graphics=!1,r.show_fps=!1,r.language="data/languages/english.json"}),a=function(){if(o(),"undefined"!=typeof window)for(var e in r)r[e]=window.localStorage.getItem(e)?localStorage.getItem(e):r[e],"false"==r[e]&&(r[e]=!1)},s=function(){if("undefined"!=typeof window)for(var e in r)window.localStorage.setItem(e,r[e])}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sprite_info_destroy=t.sprite_create=t.sprite_get_image=t.sprite_get_animation=t.sprite_init=void 0;var n=i(10),r=i(19),o=i(32),a=i(6),s=i(11),m=(i(12),i(8)),l=(i(9),{}),d=[],u=0,c=[],f=(t.sprite_init=function(){return new Promise(function(e,t){var i=void 0;for((0,a.logfile_message)("Loading sprites..."),l=(0,r.hashtable_spriteinfo_t_create)(),i=0;i<d.length;i++)d[i]="data/sprites/"+d[i]+".json";(0,s.resourcemanager_getJsonFiles)(d).then(function(t){for(i=0;i<t.length;i++)for(var n in t[i])t[i][n].name=n,c.push(t[i][n]);v(c).then(function(){(0,a.logfile_message)("All sprites have been loaded!"),l=(0,r.hashtable_sprites)(),e()})})})},t.sprite_get_animation=function(e,t){var i=void 0;return i=l[e],null!=i?i.animation_data[t]:null},t.sprite_get_image=function(e,t){return e?e.frame_data[e.data[t]]:0},t.sprite_create=function(e){return new Promise(function(t,i){p(e).then(t)})},t.sprite_info_destroy=function(e){var t=void 0;if(null!=e.source_file&&(e.source_file=null),null!=e.frame_data){for(t=0;t<e.frame_count;t++)(0,o.image_destroy)(e.frame_data[t]);e.frame_data=null}if(null!=e.animation_data){for(t=0;t<e.animation_count;t++)e.animation_data[t]=f(e.animation_data[t]);e.animation_data=null}e=null},function(e){return null!=e&&(null!=e.data&&(e.data=null),e=null),null}),_=function(e){var t=void 0,i=void 0,n=void 0;for((e.frame_w>e.rect_w||e.frame_h>e.rect_h)&&(e.frame_w=Math.min(e.frame_w,e.rect_w),e.frame_h=Math.min(e.frame_h,e.rect_h)),(e.rect_w%e.frame_w>0||e.rect_h%e.frame_h>0)&&(e.rect_w=e.rect_w%e.frame_w>0?e.rect_w-e.rect_w%e.frame_w+e.frame_w:e.rect_w,e.rect_h=e.rect_h%e.frame_h>0?e.rect_h-e.rect_h%e.frame_h+e.frame_h:e.rect_h),n=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),t=0;t<e.animation_count;t++)for(i=0;i<e.animation_data[t].frame_count;i++)e.animation_data[t].data[i]>=0&&e.animation_data[t].data[i]<n||(e.animation_data[t].data[i]=Math.min(e.animation_data[t].data[i],0,n-1));return e},h=function(e){0==e.frame_count&&(0,a.logfile_message)("Animation error: invalid 'data' field. You must specify the frames of the animations")},p=function(e){return new Promise(function(t,i){var n=y(),r=P(n,e);r=_(r),E(r).then(function(i){r=g(i),I(e.name,r),u++,t(r)})})},y=function(){var e={};return e.source_file=null,e.rect_x=0,e.rect_y=0,e.rect_w=0,e.rect_h=0,e.frame_w=e.frame_h=0,e.hot_spot=(0,m.v2d_new)(0,0),e.frame_count=0,e.frame_data=[],e.animation_count=0,e.animation_data=[],e},E=function(e){return new Promise(function(t,i){(0,o.image_load)(e.source_file).then(function(i){e.frame_count=parseInt(e.rect_w/e.frame_w*(e.rect_h/e.frame_h),10),e.frame_data=[],e=T(e,i),t(e)})})},T=function(e,t){for(var i=0,n=0,r=0;r<parseInt(e.frame_count,10);r++)e.frame_data[r]={data:t,sx:i+e.rect_x,sy:n+e.rect_y,swidth:e.frame_w,sheight:e.frame_h,x:0,y:0,width:e.frame_w,height:e.frame_h},(i+=e.frame_w)>=e.rect_w&&(i=0,n+=e.frame_h);return e},g=function(e){for(var t=0;t<e.animation_count;t++)e.animation_data[t].frame_data=e.frame_data,e.animation_data[t].hot_spot=e.hot_spot;return e},v=function(e){return Promise.all(e.map(p))},P=function(e,t){if(e.source_file=n.DATA_ROOT+t.source_file,e.rect_x=t.source_rect.xpos,e.rect_y=t.source_rect.ypos,e.rect_w=t.source_rect.width,e.rect_h=t.source_rect.height,e.frame_w=t.frame_size.width,e.frame_h=t.frame_size.height,t.hot_spot&&(e.hot_spot.x=t.hot_spot.xpos,e.hot_spot.y=t.hot_spot.ypos),t.animations){e.animation_count=t.animations.length;for(var i=0;i<e.animation_count;i++)e.animation_data[i]=S(w(),t.animations[i]),h(e.animation_data[i])}return e},S=function(e,t){return e.repeat=t.repeat,e.fps=t.fps,e.data=t.data,e.frame_count=t.data.length,e},I=function(e,t){(0,r.hashtable_spriteinfo_t_add)((0,r.hashtable_sprites)(),e,t)},w=function(){var e={};return e.repeat=!1,e.fps=8,e.frame_count=0,e.data=null,e.hot_spot=(0,m.v2d_new)(0,0),e.frame_data=null,e}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityPlayer1=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(29),d=i(4),u=i(3),c=i(0),f=i(21);t.entityPlayer1=function(e){function t(e,i,o){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=a;a.mAttractors=e,a.mGrid=i,a.mParticles=o,a.mPlayerAssignment=0,a.mType=m.ENTITY_TYPE_PLAYER1,a.mScale=1.7,a.mRadius=2,a.mScoreValue=0,a.mSpawnTime=35,a.mSheildTimer=l.PLAYER_SHEILD_TIME;var u=0;a.mModel.mNumVertex=8,a.mModel.mVertexList=[],a.mModel.mVertexList[u++]=new c.Point3d(0,-1),a.mModel.mVertexList[u++]=new c.Point3d(1,-.15),a.mModel.mVertexList[u++]=new c.Point3d(.5,.7),a.mModel.mVertexList[u++]=new c.Point3d(.72,.02),a.mModel.mVertexList[u++]=new c.Point3d(0,-.4),a.mModel.mVertexList[u++]=new c.Point3d(-.72,.02),a.mModel.mVertexList[u++]=new c.Point3d(-.5,.7),a.mModel.mVertexList[u++]=new c.Point3d(-1,-.15),a.mModel.mNumEdges=8,a.mModel.mEdgeList=[];for(var _=0;_<a.mModel.mNumEdges;_++)a.mModel.mEdgeList.push(new d.Edge);u=0,a.mModel.mEdgeList[u].from=0,a.mModel.mEdgeList[u++].to=1,a.mModel.mEdgeList[u].from=1,a.mModel.mEdgeList[u++].to=2,a.mModel.mEdgeList[u].from=2,a.mModel.mEdgeList[u++].to=3,a.mModel.mEdgeList[u].from=3,a.mModel.mEdgeList[u++].to=4,a.mModel.mEdgeList[u].from=4,a.mModel.mEdgeList[u++].to=5,a.mModel.mEdgeList[u].from=5,a.mModel.mEdgeList[u++].to=6,a.mModel.mEdgeList[u].from=6,a.mModel.mEdgeList[u++].to=7,a.mModel.mEdgeList[u].from=7,a.mModel.mEdgeList[u++].to=0;for(var h=0;h<a.mMaxMissiles;h++){var p=new f.entityPlayerMissile(s.mAttractors,s.mEnemies,s.mGrid,s.mParticles);p.setEnabled(!1),a.missiles.push(p)}return a}return o(t,e),a(t,[{key:"initPlayerForGame",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initPlayerForGame",this).call(this),this.mPen=new u.pen(1,1,1,.5,12),this.mPos.x=this.mGrid.extentX()/2,this.mPos.y=this.mGrid.extentY()/2,this.mPos.z=0}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this)}},{key:"spawn",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawn",this).call(this);var e=this.mAttractors.getAttractor();e&&(e.strength=-20,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0)}},{key:"run",value:function(){if(this.mDrawSheild){var e=this.mAttractors.getAttractor();e&&(e.strength=20,e.zStrength=0,e.radius=4,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!1)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}}]),t}(l.player)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityPlayer2=void 0;var a=i(2),s=i(29),m=i(4),l=i(3),d=i(0);t.entityPlayer2=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.mPlayerAssignment=1,e.mType=a.ENTITY_TYPE_PLAYER2,e.mScale=.1,e.mRadius=2,e.mScoreValue=0,e.mSpawnTime=35,e.mSheildTimer=s.PLAYER_SHEILD_TIME,e.mPen=new l.pen(.5,.5,1,.7,12);var i=0;e.mModel.mNumVertex=13,e.mModel.mVertexList=[],e.mModel.mVertexList[i++]=new d.Point3d(0,17.5),e.mModel.mVertexList[i++]=new d.Point3d(6.5,5.5),e.mModel.mVertexList[i++]=new d.Point3d(0,-6.5),e.mModel.mVertexList[i++]=new d.Point3d(-6.5,5.5),e.mModel.mVertexList[i++]=new d.Point3d(1.5,-10.5),e.mModel.mVertexList[i++]=new d.Point3d(15,1.5),e.mModel.mVertexList[i++]=new d.Point3d(9.2,-13.1),e.mModel.mVertexList[i++]=new d.Point3d(-1.5,-10.5),e.mModel.mVertexList[i++]=new d.Point3d(-15,1.5),e.mModel.mVertexList[i++]=new d.Point3d(-9.2,-13.1),e.mModel.mVertexList[i++]=new d.Point3d(5,-17.7),e.mModel.mVertexList[i++]=new d.Point3d(0,-14.5),e.mModel.mVertexList[i++]=new d.Point3d(-5,-17.7),e.mModel.mNumEdges=12,e.mModel.mEdgeList=[];for(var o=0;o<e.mModel.mNumEdges;o++)e.mModel.mEdgeList.push(new m.Edge);return i=0,e.mModel.mEdgeList[i].from=0,e.mModel.mEdgeList[i++].to=1,e.mModel.mEdgeList[i].from=1,e.mModel.mEdgeList[i++].to=2,e.mModel.mEdgeList[i].from=2,e.mModel.mEdgeList[i++].to=3,e.mModel.mEdgeList[i].from=3,e.mModel.mEdgeList[i++].to=0,e.mModel.mEdgeList[i].from=4,e.mModel.mEdgeList[i++].to=5,e.mModel.mEdgeList[i].from=5,e.mModel.mEdgeList[i++].to=6,e.mModel.mEdgeList[i].from=6,e.mModel.mEdgeList[i++].to=4,e.mModel.mEdgeList[i].from=7,e.mModel.mEdgeList[i++].to=9,e.mModel.mEdgeList[i].from=9,e.mModel.mEdgeList[i++].to=8,e.mModel.mEdgeList[i].from=8,e.mModel.mEdgeList[i++].to=7,e.mModel.mEdgeList[i].from=10,e.mModel.mEdgeList[i++].to=11,e.mModel.mEdgeList[i].from=11,e.mModel.mEdgeList[i++].to=12,e}return o(t,e),t}(s.player)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.matrix=function(){function e(t){n(this,e),this._matrix=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],t?this.Copy(t):this.Identity()}return r(e,[{key:"Copy",value:function(e){this._matrix[0][0]=e._matrix[0][0],this._matrix[0][1]=e._matrix[0][1],this._matrix[0][2]=e._matrix[0][2],this._matrix[0][3]=e._matrix[0][3],this._matrix[1][0]=e._matrix[1][0],this._matrix[1][1]=e._matrix[1][1],this._matrix[1][2]=e._matrix[1][2],this._matrix[1][3]=e._matrix[1][3],this._matrix[2][0]=e._matrix[2][0],this._matrix[2][1]=e._matrix[2][1],this._matrix[2][2]=e._matrix[2][2],this._matrix[2][3]=e._matrix[2][3],this._matrix[3][0]=e._matrix[3][0],this._matrix[3][1]=e._matrix[3][1],this._matrix[3][2]=e._matrix[3][2],this._matrix[3][3]=e._matrix[3][3]}},{key:"Identity",value:function(){this._matrix[0][0]=1,this._matrix[0][1]=0,this._matrix[0][2]=0,this._matrix[0][3]=0,this._matrix[1][0]=0,this._matrix[1][1]=1,this._matrix[1][2]=0,this._matrix[1][3]=0,this._matrix[2][0]=0,this._matrix[2][1]=0,this._matrix[2][2]=1,this._matrix[2][3]=0,this._matrix[3][0]=0,this._matrix[3][1]=0,this._matrix[3][2]=0,this._matrix[3][3]=1}},{key:"Multiply",value:function(e){var t=this,i=void 0,n=void 0,r=[[this._matrix[0][0],this._matrix[0][1],this._matrix[0][2],this._matrix[0][3]],[this._matrix[1][0],this._matrix[1][1],this._matrix[1][2],this._matrix[1][3]],[this._matrix[2][0],this._matrix[2][1],this._matrix[2][2],this._matrix[2][3]],[this._matrix[3][0],this._matrix[3][1],this._matrix[3][2],this._matrix[3][3]]];for(i=0;i<4;i++)for(n=0;n<4;n++)t._matrix[i][n]=r[i][0]*e._matrix[0][n]+r[i][1]*e._matrix[1][n]+r[i][2]*e._matrix[2][n]+r[i][3]*e._matrix[3][n]}},{key:"Scale",value:function(e,t,i){this._matrix[0][0]*=e,this._matrix[1][1]*=t,this._matrix[2][2]*=i}},{key:"Translate",value:function(e,t,i){this._matrix[3][0]+=e,this._matrix[3][1]+=t,this._matrix[3][2]+=i}},{key:"Rotate",value:function(t,i,n){var r=new e,o=new e,a=new e;r._matrix[1][1]=Math.cos(t),r._matrix[1][2]=Math.sin(t),r._matrix[2][0]=0,r._matrix[2][1]=-Math.sin(t),r._matrix[2][2]=Math.cos(t),o._matrix[0][0]=Math.cos(i),o._matrix[0][2]=-Math.sin(i),o._matrix[2][0]=Math.sin(i),o._matrix[2][2]=Math.cos(i),a._matrix[0][0]=Math.cos(n),a._matrix[0][1]=Math.sin(n),a._matrix[1][0]=-Math.sin(n),a._matrix[1][1]=Math.cos(n),this.Multiply(r),this.Multiply(o),this.Multiply(a)}},{key:"TransformVertex",value:function(e,t){var i=e.x*this._matrix[0][0]+e.y*this._matrix[1][0]+e.z*this._matrix[2][0]+this._matrix[3][0],n=e.x*this._matrix[0][1]+e.y*this._matrix[1][1]+e.z*this._matrix[2][1]+this._matrix[3][1],r=e.x*this._matrix[0][2]+e.y*this._matrix[1][2]+e.z*this._matrix[2][2]+this._matrix[3][2];t.x=i,t.y=n,t.z=r}},{key:"ProjectVertex",value:function(e,t,i){var n=t.z;0==n&&(n=1e-5),e.x=i*t.x/n,e.y=i*t.y/n}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.player=t.PLAYER_SHEILD_TIME=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(5),l=i(2),d=i(22),u=i(0),c=i(3),f=(i(21),i(1)),_=i(17),h=i(7),p=i(15),y=t.PLAYER_SHEILD_TIME=250,E=!1;t.player=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.mGrid=i,o.mDrawSheild=!1,o.mDestroyTime=50,o.mMaxMissiles=500,o.setState(l.ENTITY_STATE_INACTIVE),o.missiles=[],o.initPlayerForGame(),o}return o(t,e),a(t,[{key:"setGame",value:function(e){this.mGame=e}},{key:"setBomb",value:function(e){this.mBomb=e}},{key:"setEnemies",value:function(e){this.mEnemies=e}},{key:"setParticles",value:function(e){this.mParticles=e}},{key:"initPlayerForGame",value:function(){this.mNumBombs=5,this.mNumLives=5,this.mBombCounter=0,this.mLifeCounter=0,this.mBombInterimTimer=0,this.mGeoms=0,this.mScore=0,this.mMultiplier=1,this.mFiringTimer=0,this.mKillCounter=0,this.mLevelAdvanceCounter=0,this.mCurrentWeapon=0,this.mAngle=0,this.setState(l.ENTITY_STATE_SPAWN_TRANSITION),this.mInput=(0,d.input_create_user)()}},{key:"run",value:function(){if(this.getEnabled()){if(this.mGameMode!=p.GAMEMODE_CHANGINGLEVELS){(0,d.input_button_pressed)(this.mInput,d.IB_FIRE1)&&this.getNumBombs()>0&&this.mBombInterimTimer<=0&&(this.takeBomb(),this.mBombInterimTimer=50,this.mBomb.startBomb(new u.Point3d(this.mPos.x,this.mPos.y,this.mPos.z),1,6,2,1e3,new c.pen(1,1,1,.3,4))),this.mBombInterimTimer>0&&--this.mBombInterimTimer}var e=new u.Point3d(0,0,0),i=this.mInput.state[d.IB_AXES_LEFT],n=0;if(i?n=(0,f.calculate2dDistance)(new u.Point3d(0,0,0),i):(i=new u.Point3d(0,0,0),(0,d.input_button_down)(this.mInput,d.IB_W)&&(i.x=1,n=1),(0,d.input_button_down)(this.mInput,d.IB_S)&&(i.x=-1,n=1),(0,d.input_button_down)(this.mInput,d.IB_A)&&(i.y=1,n=1),(0,d.input_button_down)(this.mInput,d.IB_D)&&(i.y=-1,n=1)),n>.1){n=n>.6?1:.5;var r=(0,f.calculate2dAngle)(new u.Point3d(0,0,0),i)+(0,f.DegreesToRads)(90),o=new u.Point3d(.9*n,0,0);o=(0,f.rotate2dPoint)(o,r),r-=(0,f.DegreesToRads)(90),r=(0,_.fmod)(r,2*h.PI);var a=(0,_.fmod)(this.getAngle(),2*h.PI);a+=.2*(0,f.diffAngles)(r,a),this.setAngle(a),E||(E=!0),e=o,this.setPos(this.getPos().add(o))}var m=this.mInput.state[d.IB_AXES_RIGHT];n=0,m?n=(0,f.calculate2dDistance)(new u.Point3d(0,0,0),m):(m=new u.Point3d(0,0,0),(0,d.input_button_down)(this.mInput,d.IB_UP)&&(m.x=1,n=1),(0,d.input_button_down)(this.mInput,d.IB_DOWN)&&(m.x=-1,n=1),(0,d.input_button_down)(this.mInput,d.IB_LEFT)&&(m.y=1,n=1),(0,d.input_button_down)(this.mInput,d.IB_RIGHT)&&(m.y=-1,n=1)),n>.1&&this.firePattern3(m,e)}this.runMissiles(),this.mDrawSheild=!1,this.mSheildTimer>0&&--this.mSheildTimer,this.mSheildTimer<60?this.mDrawSheild=this.mSheildTimer/6&1:this.mDrawSheild=!0,this.mSheildTimer;var l=this.mAttractors.getAttractor();l&&(l.strength=40,l.zStrength=0,l.radius=4,l.pos=this.mPos,l.enabled=!0,l.attractsParticles=!1),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){this.mSheildTimer=y;var e=this.getAngle();s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.setAngle(e),this.mDrawSheild=!0}},{key:"spawn",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawn",this).call(this),this.mDrawSheild=!0;var e=this.mAttractors.getAttractor();e&&(this.mStateTimer>this.mSpawnTime-25?(e.strength=-20,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0):this.mStateTimer>this.mSpawnTime-50&&this.mStateTimer<=this.mSpawnTime-25&&(e.strength=10,e.zStrength=0,e.radius=10,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!0))}},{key:"destroyTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this),this.mStateTimer=this.mDestroyTime,this.mMultiplier=1;var e=this.mAttractors.getAttractor();e&&this.mStateTimer>20&&(e.strength=10,e.radius=20,e.pos=this.mPos,e.enabled=!0,e.attractsParticles=!1);var i=new u.Point3d(this.mPos.x,this.mPos.y,this.mPos.z),n=new u.Point3d(0,0,0),r=2*h.PI,o=new c.pen(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a);o.r*=1.2,o.g*=1.2,o.b*=1.2,o.a=.8,o.lineRadius=5,this.mParticles.emitter(i,n,2,r,200,o,300,!0,!0,.98,!0),this.setState(l.ENTITY_STATE_DESTROYED),this.getNumLives()}},{key:"indicating",value:function(){--this.mStateTimer<=0&&this.setState(l.ENTITY_STATE_INACTIVE)}},{key:"draw",value:function(){for(var e=this,i=0;i<e.mMaxMissiles;i++){var n=e.missiles[i];n.getEnabled()&&n.draw()}if(this.getEnabled()&&this.mDrawSheild){var r=.05,o=2.5;(0,m.glColor4f)(this.mPen.r,this.mPen.g,this.mPen.b,this.mPen.a),(0,m.glBegin)(m.GL_LINE_LOOP);for(var a=0;a<2*h.PI;a+=r)(0,m.glVertex3f)(this.mPos.x+o*Math.cos(a),this.mPos.y+o*Math.sin(a),0);(0,m.glEnd)()}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this)}},{key:"addKillAtLocation",value:function(e,t){var i=e*this.mMultiplier;this.mScore+=i,this.mBombCounter+=i,this.mLifeCounter+=i,this.mBombCounter>=1e5&&(this.mBombCounter=0,this.addBomb()),this.mLifeCounter>=75e3&&(this.mLifeCounter=0,this.addLife());++this.mKillCounter>=25&&(this.mKillCounter=0,++this.mMultiplier)}},{key:"runMissiles",value:function(){for(var e=this,t=0;t<e.mMaxMissiles;t++){var i=e.missiles[t];if(i.getEnabled())switch(i.getState()){case l.ENTITY_STATE_SPAWN_TRANSITION:i.spawnTransition();break;case l.ENTITY_STATE_SPAWNING:i.spawn();break;case l.ENTITY_STATE_RUN_TRANSITION:i.runTransition();break;case l.ENTITY_STATE_RUNNING:i.run(e.mEnemies,e.mGrid,e.mParticles);break;case l.ENTITY_STATE_DESTROY_TRANSITION:i.destroyTransition();break;case l.ENTITY_STATE_DESTROYED:i.destroy()}}}},{key:"shields",value:function(){return!0}},{key:"getNumLives",value:function(){return 1==this.mGame.mNumPlayers?this.mNumLives:this.mGame.m2PlayerNumLives}},{key:"getNumBombs",value:function(){return 1==this.mGame.mNumPlayers?this.mNumBombs:this.mGame.m2PlayerNumBombs}},{key:"getGeoms",value:function(){return this.mGeoms}},{key:"addLife",value:function(){1==this.mGame.mNumPlayers?++this.mNumLives:++this.mGame.m2PlayerNumLives}},{key:"takeLife",value:function(){1==this.mGame.mNumPlayers?--this.mNumLives:--this.mGame.m2PlayerNumLives}},{key:"addBomb",value:function(){1==this.mGame.mNumPlayers&&++this.mNumBombs}},{key:"takeBomb",value:function(){1==this.mGame.mNumPlayers&&--this.mNumBombs}},{key:"addGeom",value:function(e){this.mGeoms+=e}},{key:"clearGeoms",value:function(){this.mGeoms=0}},{key:"addPointsNoMultiplier",value:function(e){var t=parseInt(e,10);this.mScore+=t,this.mBombCounter+=t,this.mLifeCounter+=t}},{key:"switchWeapons",value:function(){0==this.mCurrentWeapon?this.mCurrentWeapon=1:this.mCurrentWeapon=100*Math.random()<50?1:2}},{key:"firePattern1",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){i.mFiringTimer=6;for(var n=null,r=0;r<i.mMaxMissiles;r++)if(!i.missiles[r].getEnabled()){n=i.missiles[r],n.setState(l.ENTITY_STATE_SPAWN_TRANSITION),n.mType=0,n.mPlayerSource=i.mPlayerAssignment;break}for(var o=null,a=0;a<i.mMaxMissiles;a++)if(!i.missiles[a].getEnabled()){o=i.missiles[a],o.setState(l.ENTITY_STATE_SPAWN_TRANSITION),o.mType=0,o.mPlayerSource=i.mPlayerAssignment;break}if(n&&o){var s=(0,f.calculate2dAngle)(new u.Point3d(0,0,0),e)+(0,f.DegreesToRads)(90),m=1.4,d=.4,c=s+d,_=s-d,h=new u.Point3d(m,0,0),p=new u.Point3d(2,0,0),y=this.getPos().copy().add((0,f.rotate2dPoint)(p,c));h=(0,f.rotate2dPoint)(h,s),n.setPos(y),n.setAngle(s-(0,f.DegreesToRads)(90)),n.setSpeed(h),n.mVelocity=m,h=new u.Point3d(m,0,0),p=new u.Point3d(2,0,0),y=this.getPos().copy().add((0,f.rotate2dPoint)(p,_)),h=(0,f.rotate2dPoint)(h,s),o.setPos(y),o.setAngle(s-(0,f.DegreesToRads)(90)),o.setSpeed(h),o.mVelocity=m}}}},{key:"firePattern2",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){var n=!0;n=!n,i.mFiringTimer=n?4:1;var r=null,o=null,a=null;if(n){for(var s=0;s<i.mMaxMissiles;s++)if(!i.missiles[s].getEnabled()){r=i.missiles[s],r.setState(l.ENTITY_STATE_SPAWN_TRANSITION),r.mType=1,r.mPlayerSource=i.mPlayerAssignment;break}for(var m=0;m<i.mMaxMissiles;m++)if(!i.missiles[m].getEnabled()){o=i.missiles[m],o.setState(l.ENTITY_STATE_SPAWN_TRANSITION),o.mType=1,o.mPlayerSource=i.mPlayerAssignment;break}}else for(var d=0;d<i.mMaxMissiles;d++)if(!i.missiles[d].getEnabled()){a=i.missiles[d],a.setState(l.ENTITY_STATE_SPAWN_TRANSITION),a.mType=1,a.mPlayerSource=i.mPlayerAssignment;break}var c=(0,f.calculate2dAngle)(new u.Point3d(0,0,0),e)+(0,f.DegreesToRads)(90),_=1.6;if(a){var h=new u.Point3d,p=new u.Point3d(_,0,0),y=new u.Point3d(.5,0,0);h=this.getPos().copy().add((0,f.rotate2dPoint)(y,c)),p=(0,f.rotate2dPoint)(p,c),a.setPos(h),a.setAngle(c-(0,f.DegreesToRads)(90)),a.setSpeed(p),a.mVelocity=_}}}},{key:"firePattern3",value:function(e,t){var i=this;if(--i.mFiringTimer<=0){i.mFiringTimer=7;for(var n=null,r=null,o=null,a=null,s=null,m=0;m<i.mMaxMissiles;m++)if(!i.missiles[m].getEnabled()){n=i.missiles[m],n.setState(l.ENTITY_STATE_SPAWN_TRANSITION),n.mType=2,n.mPlayerSource=i.mPlayerAssignment;break}for(var d=0;d<i.mMaxMissiles;d++)if(!i.missiles[d].getEnabled()){r=i.missiles[d],r.setState(l.ENTITY_STATE_SPAWN_TRANSITION),r.mType=2,r.mPlayerSource=i.mPlayerAssignment;break}for(var c=0;c<i.mMaxMissiles;c++)if(!i.missiles[c].getEnabled()){o=i.missiles[c],o.setState(l.ENTITY_STATE_SPAWN_TRANSITION),o.mType=2,o.mPlayerSource=i.mPlayerAssignment;break}for(var _=0;_<i.mMaxMissiles;_++)if(!i.missiles[_].getEnabled()){a=i.missiles[_],a.setState(l.ENTITY_STATE_SPAWN_TRANSITION),a.mType=2,a.mPlayerSource=i.mPlayerAssignment;break}for(var h=0;h<i.mMaxMissiles;h++)if(!i.missiles[h].getEnabled()){s=i.missiles[h],s.setState(l.ENTITY_STATE_SPAWN_TRANSITION),s.mType=2,s.mPlayerSource=i.mPlayerAssignment;break}if(n&&r&&o&&a&&s){var p=(0,f.calculate2dAngle)(new u.Point3d(0,0,0),e)+(0,f.DegreesToRads)(90),y=1.2,E=.1,T=.05,g=p+E,v=p-E,P=p+T,S=p-T,I=new u.Point3d,w=new u.Point3d(y,0,0),b=new u.Point3d(2,0,0);I=this.getPos().copy().add((0,f.rotate2dPoint)(b,p)),w=(0,f.rotate2dPoint)(w,p),n.setPos(I),n.setAngle(p-(0,f.DegreesToRads)(90)),n.setSpeed(w),n.mVelocity=y,I=new u.Point3d,w=new u.Point3d(y,0,0),b=new u.Point3d(2,0,0),I=this.getPos().copy().add((0,f.rotate2dPoint)(b,g)),w=(0,f.rotate2dPoint)(w,P),r.setPos(I),r.setAngle(p-(0,f.DegreesToRads)(90)),r.setSpeed(w),r.mVelocity=y,I=new u.Point3d,w=new u.Point3d(y,0,0),b=new u.Point3d(2,0,0),I=this.getPos().copy().add((0,f.rotate2dPoint)(b,v)),w=(0,f.rotate2dPoint)(w,S),o.setPos(I),o.setAngle(p-(0,f.DegreesToRads)(90)),o.setSpeed(w),o.mVelocity=y}}}}]),t}(l.entity)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.engine_init=void 0;var n=i(5),r=i(18),o=i(31),a=i(22),s=i(23),m=i(24),l=i(11),d=i(34),u=i(35),c=(i(36),i(25),i(37)),f=i(13),_=i(12),h=(i(39),t.engine_init=function(e){p();var t=(0,o.commandline_parse)(e);y(t),E(t,function(){T(),g(t),h()})},function(){var e=void 0;(0,_.runAnimation)(function(t){(0,f.timer_update)(t),(0,a.input_update)(),e=(0,d.scenestack_top)(),e&&(e.update(),e==(0,d.scenestack_top)()&&e.render()),(0,u.screenshot_update)(),(0,a.input_render)()})}),p=function(){(0,m.preferences_init)()},y=function(e){(0,f.timer_init)(),(0,n.gl_init)(),(0,r.audio_init)(),(0,a.input_init)(),(0,l.resourcemanager_init)()},E=function(e,t){(0,c.storyboard_init)(),(0,s.lang_init)(e.language,function(){(0,d.scenestack_init)(),t()})},T=function(){},g=function(e){(0,d.scenestack_push)((0,c.storyboard_get_scene)(c.SCENE_MENU))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commandline_parse=void 0;var n=(i(6),i(24)),r=(t.commandline_parse=function(e){var t={};return t.video_resolution=(0,n.preferences_get_video_resolution)(),t.smooth_graphics=(0,n.preferences_get_smooth_graphics)(),t.fullscreen=(0,n.preferences_get_fullscreen)(),t.show_fps=(0,n.preferences_get_show_fps)(),t.language=(0,n.preferences_get_language)(),t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=r("video_resolution")?r("video_resolution"):t.video_resolution,t.smooth_graphics=r("smooth_graphics")?r("smooth_graphics"):t.smooth_graphics,t.fullscreen=r("fullscreen")?r("fullscreen"):t.fullscreen,t.show_fps=r("show_fps")?r("show_fps"):t.show_fps,t.color_depth=r("color_depth")?r("color_depth"):t.color_depth,t.level=r("level")?r("level"):t.level,t.quest=r("quest")?r("quest"):t.quest,t.language=r("language")?r("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t},function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.image_destroy=t.image_pixelperfect_collision=t.image_clear=t.image_rgb=t.image_putpixel=t.image_blit=t.image_draw=t.image_rectfill=t.image_load=t.image_create=void 0;var n=(i(6),i(9)),r={};t.image_create=function(e,t){return(0,n.video_get_backbuffer)().createImageData(e,t)},t.image_load=function(e){return new Promise(function(t,i){if(r[e])return t(r[e]);var n=document.createElement("img");n.src=e,n.addEventListener("load",function(){return r[e]=n,t(n)})})},t.image_rectfill=function(e,t,i,n,r,o){e.fillStyle=o,e.fillRect(t,i,n-t,r-i)},t.image_draw=function(e,t,i,n,r){t.putImageData(e,i,n)},t.image_blit=function(e,t,i,n,r,o,a,s){if(!e||!t)return!1;t.drawImage(e,i,n,a,s,r,o,a,s)},t.image_putpixel=function(e,t,i,n,r){t.fillStyle=r,t.fillRect(i,n,i+1,n+1)},t.image_rgb=function(e,t,i){return"rgb("+e+","+t+","+i+")"},t.image_clear=function(e,t,i,n){for(var r=0;r<e.data.length;r+=4)e.data[r]=t,e.data[r+1]=i,e.data[r+2]=n},t.image_pixelperfect_collision=function(e,t,i,n,r,o){return!0},t.image_destroy=function(e){e&&(e.data,e=null)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.osspec_isTouch=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},t.osspec_canGamepad=function(){return"undefined"!=typeof navigator&&"getGamepads"in navigator}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=16,r=[],o=0,a=(t.scenestack_init=function(){o=0;for(var e=0;e<n;e++)r[e]=null},t.scenestack_release=function(){for(;!s();)a()},t.scenestack_push=function(e){r[o++]=e,e&&e.init()},t.scenestack_pop=function(){r[o-1].release(),r[o-1]=null,o--}),s=(t.scenestack_top=function(){return r[o-1]},t.scenestack_empty=function(){return 0===o})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.screenshot_init=function(){},t.screenshot_update=function(){},t.screenshot_release=function(){}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.soundfactory_get=t.soundfactory_release=t.soundfactory_init=void 0;var n=i(18),r=i(19),o=i(6),a=(i(11),{}),s=(t.soundfactory_init=function(){s()},t.soundfactory_release=function(){},t.soundfactory_get=function(e){var t=(0,r.hashtable_sound_t_find)(a,e);return(0,n.sound_is_playing)(t)&&(t=(0,r.hashtable_sound_t_find)(a,e+"2"),(0,n.sound_is_playing)(t)&&(t=(0,r.hashtable_sound_t_find)(a,e+"3"),(0,n.sound_is_playing)(t)&&(t=(0,r.hashtable_sound_t_find)(a,e+"4")))),t},function(){(0,o.logfile_message)("soundfactory: loading the samples table..."),m({})}),m=function(e){for(var t in e)a[t]=l(t,e[t])},l=function(e,t){var i=d();return i.data=(0,n.sound_load)(e,t),i.data2=(0,n.sound_load)(e,t),i},d=function(){var e={};return e.data=null,e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.storyboard_get_scene=t.storyboard_release=t.storyboard_init=t.SCENE_STAGESELECT=t.SCENE_OPTIONS=t.SCENE_CREDITS=t.SCENE_LANGSELECT=t.SCENE_CONFIRMBOX=t.SCENE_QUESTOVER=t.SCENE_MENU=t.SCENE_ENDOFDEMO=t.SCENE_QUEST=t.SCENE_GAMEOVER=t.SCENE_PAUSE=t.SCENE_LEVEL=t.SCENE_INTRO=void 0;var n=i(64),r=256,o=(t.SCENE_INTRO=0,t.SCENE_LEVEL=1,t.SCENE_PAUSE=2,t.SCENE_GAMEOVER=3,t.SCENE_QUEST=4,t.SCENE_ENDOFDEMO=5,t.SCENE_MENU=6),a=(t.SCENE_QUESTOVER=7,t.SCENE_CONFIRMBOX=8,t.SCENE_LANGSELECT=9,t.SCENE_CREDITS=10,t.SCENE_OPTIONS=11,t.SCENE_STAGESELECT=12,[]),s=(t.storyboard_init=function(){for(var e=0;e<r;e++)a[e]=null;a[o]=s(n.gw_init,n.gw_update,n.gw_render,n.gw_release)},t.storyboard_release=function(){for(var e=0;e<r;e++)a[e]&&m(a[e])},t.storyboard_get_scene=function(e){return a[e]},function(e,t,i,n){return{init:e,update:t,render:i,release:n}}),m=function(e){null}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(9),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var i=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=i(this._onTouchStart,this),this._$onTouchEnd=i(this._onTouchEnd,this),this._$onTouchMove=i(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=i(this._onMouseDown,this),this._$onMouseUp=i(this._onMouseUp,this),this._$onMouseMove=i(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}return r(e,[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0)&&!(Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0)&&!(Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0)&&!(Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0)&&!(Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var i=(0,o.video_getScale)();e*=i.x,t*=i.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var i=(0,o.video_getScale)();e*=i.x,t*=i.y,this._pressed===!0&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,i=e.clientY;return this._onDown(t,i)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,i=e.clientY;return this._onMove(t,i)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx){if(this.dispatchEvent("touchStartValidation",e)!==!1){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var i=t.pageX,n=t.pageY;return this._onDown(i,n)}}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length){var n=t[i];e.preventDefault();var r=n.pageX,o=n.pageY;return this._onMove(r,o)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}],[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}]),e}();t.default=a,function(e){e.addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},e.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},e.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),i=0;i<t.length;i++){var n=t[i].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==n)return n}}}(a.prototype)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.font_render=t.font_set_width=t.font_get_charspacing=t.font_get_charsize=t.font_get_text=t.font_set_text=t.font_destroy=t.font_create=t.font_init=void 0;var n=i(6),r=i(12),o=i(8),a=i(23),s=i(25),m=i(9),l=5,d=10,u=[],c={},f={},_=(t.font_init=function(){var e=void 0,t=void 0,i=void 0,r=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ",' !"#$%& ()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[ ]^_´abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ',' !"#$%& ()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[ ]^_´abcdefghijklmnopqrstuvwxyz{|}~'];for((0,n.logfile_message)("font_init()"),e=0;e<r.length;e++)for(u[e]={ch:[]},i="FT_FONT"+e,t=0;t<r[e].length;t++)u[e].ch[r[e][t]]=(0,s.sprite_get_image)((0,s.sprite_get_animation)(i,0),t);(0,n.logfile_message)("font_init() ok")},t.font_create=function(e){var t=void 0,i={};for(i.type=(0,r.clip)(e,0,d-1),i.text=null,i.width=0,i.visible=!0,i.hspace=i.vspace=1,i.value=[],i.position=(0,o.v2d_new)(0,0),t=0;t<l;t++)i.value[t]=0;return i},t.font_destroy=function(e){},t.font_set_text=function(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];if(!e)return!1;var o=void 0;for(o=0;o<n.length;o++)n[o]=""+n[o];t=""+t;var s=t.match(/\$[A-Z_\d]\w+/g);if(s)for(o=0;o<s.length;o++){var m=s[o].slice(1),l=(0,a.lang_get)(m);l&&(t=t.replace("$"+m,l))}if(s=t.match(/\%[s]+/g))for(o=0;o<s.length;o++)if(n[o]){var d=n[o].match(/\$[A-Z_\d]\w+/g);d&&(n[o]=d[0].slice(1)),t=t.replace("%s",(0,a.lang_get)(n[o]))}if(s=t.match(/\%[d]+/g))for(o=0;o<s.length;o++)n[o]&&(t=t.replace("%d",""+n[o]));return e.text=""+t,e},t.font_get_text=function(e){return e.text?e.text:""},t.font_get_charsize=function(e){return _(e)},t.font_get_charspacing=function(e){return(0,o.v2d_new)(e.hspace,e.vspace)},t.font_set_width=function(e,t){e.width=Math.max(0,t)},t.font_render=function(e,t){var i=0,n=0,o=void 0,a=void 0,s=void 0,l=void 0,d=[],c=0,f=0,y=void 0;d[f++]={r:!1,g:0,b:0};var E=_(e);if(o=E.x,a=E.y,e&&e.visible&&e.text)for(c=0;c<e.text.length;c++){if(s=e.text[c],y=!1,(0,r.isspace)(e.text[c-1])){var T=void 0,g=!1,v=0,P=e.text.slice(c);P=P.replace("(",""),P=P.replace(")","");var S=P.split(" ")[0];for(T=0;T<S.length;T++)"<"==S[T]&&(g=!0),g||v++,">"==S[T]&&(g=!1);y=e.width>0&&i+(o+e.hspace)*v-e.hspace>e.width}if("<"==s){var I=e.text.slice(c,c+7);if("<color="==I){var w=void 0,b=void 0,M=void 0;c+=7;var N=e.text.slice(c,c+6);w=p(N.slice(0,2)),b=p(N.slice(2,4)),M=p(N.slice(4,6)),d[f++]={r:w,g:b,b:M},c+=7,s=e.text[c]}"</color"==I&&(c+=8,s=e.text[c],f>=2&&f--)}y&&(i=0,n+=a+e.vspace),"\n"!=s?(l=u[e.type].ch[s],l?(i+=l.width,(0,r.isspace)(e.text[c-1]),h((0,m.video_get_backbuffer)(),l,parseInt(e.position.x+i-(t.x-m.VIDEO_SCREEN_W/2),10),parseInt(e.position.y+n-(t.y-m.VIDEO_SCREEN_H/2),10),d[f-1].r,d[f-1].g,d[f-1].b)):i+=o+e.hspace):(i=0,n+=a+e.vspace)}},function(e){var t,i;if(e)for(t=0;t<256;t++)if(u[e.type]&&null!=(i=u[e.type].ch[t]))return(0,o.v2d_new)(i.width,i.height);return(0,o.v2d_new)(16,16)}),h=function(e,t,i,n,r,o,a){var s=void 0,l=t.data;r!==!1&&(s=y(t.data),l=E(t.data,s,r,o,a)),e.drawImage(l,t.sx,t.sy,t.swidth,t.sheight,i,n-2,t.width*m.VIDEO_SCALE,t.height*m.VIDEO_SCALE)},p=function(e){return e=e.toLowerCase(),e>="0"&&e<="9"?e-"0":e>="a"&&e<="f"?e-"a"+10:255},y=function(e){if(c[e.src])return c[e.src];var t=e.width,i=e.height,n=[],r=document.createElement("canvas");r.width=t,r.height=i;var o=r.getContext("2d");o.drawImage(e,0,0);for(var a=o.getImageData(0,0,t,i).data,s=0;s<4;s++){var m=document.createElement("canvas");m.width=t,m.height=i;var l=m.getContext("2d");l.drawImage(e,0,0);for(var d=l.getImageData(0,0,t,i),u=d.data,f=0,_=a.length;f<_;f+=4)u[f]=0===s?a[f]:0,u[f+1]=1===s?a[f+1]:0,u[f+2]=2===s?a[f+2]:0,u[f+3]=a[f+3];l.putImageData(d,0,0);var h=new Image;h.src=m.toDataURL(),n.push(h)}return c[e.src]=n,n},E=function(e,t,i,n,r){if(f[e.src+"_"+i+"_"+n+"_"+r])return f[e.src+"_"+i+"_"+n+"_"+r];var o=document.createElement("canvas");o.width=e.width,o.height=e.height;var a=o.getContext("2d");return a.globalAlpha=1,a.globalCompositeOperation="copy",a.drawImage(t[3],0,0),a.globalCompositeOperation="lighter",i>0&&(a.globalAlpha=i/255,a.drawImage(t[0],0,0)),n>0&&(a.globalAlpha=n/255,a.drawImage(t[1],0,0)),r>0&&(a.globalAlpha=r/255,a.drawImage(t[2],0,0)),f[e.src+"_"+i+"_"+n+"_"+r]=o,o}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.attractor=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(1),a=i(0),s=function e(){n(this,e),this.pos=new a.Point3d(0,0,0),this.strength=0,this.zStrength=0,this.radius=0,this.enabled=!1,this.attractsParticles=!1};t.attractor=function(){function e(){n(this,e);var t=this;t.mNumAttractors=200,t.mAttractors=[];for(var i=0;i<t.mNumAttractors;i++)t.mAttractors.push(new s);t.clearAll()}return r(e,[{key:"getAttractor",value:function(){for(var e=this,t=0;t<e.mNumAttractors;t++)if(!e.mAttractors[t].enabled)return e.mAttractors[t];return null}},{key:"clearAll",value:function(){for(var e=this,t=0;t<e.mNumAttractors;t++)e.mAttractors[t].enabled=!1}},{key:"evaluateParticle",value:function(e){for(var t=this,i=new a.Point3d(0,0,0),n=0;n<t.mNumAttractors;n++){var r=t.mAttractors[n];if(r.enabled&&r.attractsParticles){var s=new a.Point3d(r.pos.x,r.pos.y,r.pos.z),m=(0,o.calculate2dAngle)(e.posStream[0],s),l=(0,o.calculate2dDistance)(e.posStream[0],s),d=r.strength;l<r.radius&&(l=r.radius);var u=1/(l*l),c=new a.Point3d(-u*d*.5,0,0),f=(0,o.rotate2dPoint)(c,m+.35);i.x+=f.x,i.y+=f.y}}return i}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.bomb=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(0),s=i(3),m=i(1),l=i(2),d=i(7),u=i(14),c=function e(){n(this,e),this.pos=new a.Point3d,this.radius=1,this.thickness=1,this.speed=1,this.timeToLive=100,this.fadeStep=1,this.mPen=new s.pen};t.bomb=function(){function e(t,i,r){n(this,e);var o=this;o.mParticles=i,o.mAttractors=t,o.mEnemies=r,o.mNumRings=20,o.mRings=[];for(var a=0;a<o.mNumRings;a++)o.mRings.push(new c);if(o.mRings)for(var s=0;s<o.mNumRings;s++)o.mRings[s].timeToLive=0}return r(e,[{key:"run",value:function(){for(var e=this,t=0;t<e.mNumRings;t++)if(e.mRings[t].timeToLive>0){if(--e.mRings[t].timeToLive,e.mRings[t].radius+=e.mRings[t].speed,e.mRings[t].thickness+=.03,e.mRings[t].radius<40){var i=e.mAttractors.getAttractor();i&&(i.strength=5,i.zStrength=0,i.radius=e.mRings[t].radius,i.pos=e.mRings[t].pos,i.enabled=!0,i.attractsParticles=!0)}for(var n=0;n<u.NUM_ENEMIES;n++)if(e.mEnemies.mEnemies[n].getState()!==l.ENTITY_STATE_INACTIVE&&e.mEnemies.mEnemies[n].getState()!=l.ENTITY_STATE_INDICATING&&e.mEnemies.mEnemies[n].getState()!=l.ENTITY_STATE_INDICATE_TRANSITION&&e.mEnemies.mEnemies[n].getState()!=l.ENTITY_STATE_DESTROY_TRANSITION&&e.mEnemies.mEnemies[n].getState()!=l.ENTITY_STATE_DESTROYED){var r=(0,m.calculate2dDistance)(e.mRings[t].pos,e.mEnemies.mEnemies[n].getPos());r>e.mRings[t].radius-10&&r<e.mRings[t].radius&&e.mEnemies.mEnemies[n].hit(null)}}}},{key:"draw",value:function(){for(var e=this,t=0;t<e.mNumRings;t++)if(e.mRings[t].timeToLive>0){var i=e.mRings[t];i.mPen.a-=i.fadeStep,i.mPen.a<=0?i.mPen.a=0:i.mPen.a>1&&(i.mPen.a=1),(0,o.glLineWidth)(i.mPen.lineRadius),(0,o.glColor4f)(i.mPen.r,i.mPen.g,i.mPen.b,i.mPen.a),(0,o.glBegin)(o.GL_LINES);for(var n=0;n<360;n+=.5){var r=(0,m.DegreesToRads)(n),s=new a.Point3d(0,i.radius,0);s=(0,m.rotate2dPoint)(s,r);var l=new a.Point3d(0,i.radius+i.thickness,0);l=(0,m.rotate2dPoint)(l,r),s.add(i.pos),l.add(i.pos),(0,o.glVertex3d)(s.x,s.y,0),(0,o.glVertex3d)(l.x,l.y,0)}(0,o.glEnd)()}}},{key:"startBomb",value:function(e,t,i,n,r,o){for(var s=this,m=null,l=0;l<s.mNumRings;l++)s.mRings[l].timeToLive<=0&&(m=s.mRings[l]);if(m){m.pos=e,m.radius=t,m.thickness=i,m.speed=n,m.timeToLive=r,m.fadeStep=1/m.timeToLive,m.mPen=o;var u=new a.Point3d(0,0,0),c=2*d.PI;r=100,m.mPen.lineRadius=5,m.mPen.a=.3,s.mParticles.emitter(e,u,n,c,100,m.mPen,r,!1,!1,1,!0)}}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.camera=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(0),a=(i(1),50);t.camera=function(){function e(t,i){n(this,e),this.mPlayers=t,this.mGrid=i,this.mCurrentPos=new o.Point3d,this.mTargetPos=new o.Point3d}return r(e,[{key:"center",value:function(){this.mCurrentZoom=a,this.mTargetZoom=a,this.mZoomOverride=0,this.mTargetPos=new o.Point3d(this.mGrid.extentX()-.5,this.mGrid.extentY()-.5,this.mTargetZoom)}},{key:"followPlayer",value:function(){var e=this,t=void 0;t=e.mPlayers.mPlayer1.getPos();var i=t.x/this.mGrid.extentX(),n=t.y/this.mGrid.extentY(),r=-20;this.mTargetPos.x=i*(this.mGrid.extentX()+2*r)-r,this.mTargetPos.y=n*(this.mGrid.extentY()+2*r)-r}},{key:"run",value:function(){this.mCurrentZoom+=(this.mTargetZoom-this.mCurrentZoom)/20,this.mCurrentPos.x+=(this.mTargetPos.x-this.mCurrentPos.x)/16,this.mCurrentPos.y+=(this.mTargetPos.y-this.mCurrentPos.y)/16,this.mCurrentPos.z=this.mCurrentZoom+this.mZoomOverride}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createEntity=void 0;var n=i(2),r=i(26),o=i(27),a=i(21),s=i(48),m=i(55),l=i(56),d=i(53),u=i(54),c=i(50),f=i(52),_=i(44),h=i(51),p=i(47),y=i(46),E=i(45),T=i(49);t.createEntity=function(e,t,i){switch(e){case n.ENTITY_TYPE_PLAYER1:return new r.entityPlayer1;case n.ENTITY_TYPE_PLAYER2:return new o.entityPlayer2;case n.ENTITY_TYPE_PLAYER_MISSILE:return new a.entityPlayerMissile;case n.ENTITY_TYPE_GRUNT:return new s.entityGrunt(t,i);case n.ENTITY_TYPE_WANDERER:return new m.entityWanderer(t,i);case n.ENTITY_TYPE_WEAVER:return new l.entityWeaver(t,i);case n.ENTITY_TYPE_SPINNER:return new d.entitySpinner(t,i);case n.ENTITY_TYPE_TINYSPINNER:return new u.entityTinySpinner(t,i);case n.ENTITY_TYPE_MAYFLY:return new c.entityMayfly(t,i);case n.ENTITY_TYPE_SNAKE:return new f.entitySnake(t,i);case n.ENTITY_TYPE_BLACKHOLE:return new _.entityBlackHole(t,i);case n.ENTITY_TYPE_PROTON:return new h.entityProton(t,i);case n.ENTITY_TYPE_GEOM_SMALL:return new p.entityGeomSmall(t,i);case n.ENTITY_TYPE_GEOM_MEDIUM:return new y.entityGeomMedium(t,i);case n.ENTITY_TYPE_GEOM_LARGE:return new E.entityGeomLarge(t,i);case n.ENTITY_TYPE_LINE:return new T.entityLine;default:return new n.entity}return 0}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityBlackHole=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(3),d=i(1),u=i(0),c=i(16);t.entityBlackHole=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=1.5,o.mRadius=2.5,o.mEdgeBounce=!0,o.mScoreValue=50,o.mPen=new l.pen(1,.5,.5,.7,4),o.mType=m.ENTITY_TYPE_BLACKHOLE,o.setState(m.ENTITY_STATE_INACTIVE),o.mActivated=!1,o.mDestroyTime=0,o.mAnimationIndex=0,o.mAnimationSpeed=0,o.mAnimationDepth=0,o.mAttractorStrengthIndex=0,o.mStrength=1,o.mBalance=0,o.mBalanceRate=0,o.mHumLoopSoundId=-1,o}return o(t,e),a(t,[{key:"runTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"runTransition",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.mActivated=!1,this.mRadius=2.5,this.mStrength=1.5,this.mBalance=0,this.mBalanceRate=0,this.mFeedCount=0,this.mDestroyTime=0,this.mAnimationIndex=0,this.mAnimationSpeed=0,this.mAnimationDepth=0,this.mAttractorStrengthIndex=0,this.mBalance=0,this.mPoints=150,this.mHumSpeed=this.mStrength*this.mStrength/2,this.mHumSpeedTarget=this.mHumSpeed,this.mHumLoopSoundId=-1}},{key:"destroyTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this),this.mHumLoopSoundId=-1;for(var e=0;e<100;e++){var i=new u.Point3d(this.mPos.x,this.mPos.y,this.mPos.z),n=new u.Point3d(0,0,0),r=e/200*1e3,o=2*PI,a=300*Math.random(),m=this.mPen;m.lineRadius=5,z.mParticles.emitter(i,n,r,o,1,m,a)}var l=this.mAttractors.getAttractor();l&&(l.strength=20,l.zStrength=0,l.radius=30,l.pos=this.mPos,l.enabled=!0,l.attractsParticles=!1)}},{key:"indicateTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"indicateTransition",this).call(this),this.mHumLoopSoundId!=-1&&this.mSound.stopTrack(this.mHumLoopSoundId),this.mHumLoopSoundId=-1}},{key:"hitTest",value:function(e,t){return(0,d.calculate2dDistance)(e,mPos)<t+this.getRadius()?this:null}},{key:"feed",value:function(e){this.mPoints+=2*e,this.mStrength+=.05,this.mBalanceRate+=.2,++this.mFeedCount}},{key:"getRadius",value:function(){var e=void 0;return this.mActivated?(e=this.mRadius+Math.sin(mAnimationIndex)*mAnimationDepth,e*=this.mStrength+.1*this.mBalance):e=this.mRadius,e}},{key:"run",value:function(){var e=this;if(e.mAnimationSpeed=.5*e.mStrength,e.mAnimationDepth=.2,e.mSpeed=(0,d.clamp2dVector)(e.mSpeed,.2),e.mSpeed.multiply(.96),e.mDrift=(0,d.clamp2dVector)(e.mDrift,.8),e.mHumSpeedTarget=e.mStrength*e.mStrength/2,e.mHumSpeed<e.mHumSpeedTarget?e.mHumSpeed+=.01:mHumSpeed>e.mHumSpeedTarget&&(e.mHumSpeed-=.01),e.mActivated){if(e.mStrength+=3e-4,e.mHumLoopSoundId==-1&&(e.mHumLoopSoundId=e.mSound.playTrackGroup(SOUNDID_GRAVITYWELL_HUMLOOPA,SOUNDID_GRAVITYWELL_HUMLOOPF)),e.mHumLoopSoundId!=-1&&e.mSound.setTrackSpeed(e.mHumLoopSoundId,e.mHumSpeed+.2),e.mStrength>2.2&&(e.mSound.isTrackPlaying(SOUNDID_GRAVITYWELLALERT)||e.mSound.playTrack(SOUNDID_GRAVITYWELLALERT)),e.mStrength>2.3){e.setState(m.ENTITY_STATE_DESTROY_TRANSITION),e.mSound.playTrack(SOUNDID_GRAVITYWELLEXPLODE);for(var i=0;i<20;i++){var n=e.mEnemies.getUnusedEnemyOfType(m.ENTITY_TYPE_PROTON);if(n){var r=10*Math.random(),o=Math.random()*(2*PI),a=new u.Point3d(r,0,0);a=(0,d.rotate2dPoint)(a,o),n.setDrift(new u.Point3d(100*a.x,100*a.y,0)),n.setPos(a.copy().add(mPos)),n.setState(m.ENTITY_STATE_SPAWN_TRANSITION)}}return}e.mBalance>0?e.mBalanceRate-=.01:e.mBalance<0&&(e.mBalanceRate+=.01),e.mBalanceRate*=.95,e.mBalance+=e.mBalanceRate,e.mBalance*=.95;var l=100*Math.random()<10?-1:1,c=e.mAttractors.getAttractor();c&&(c.strength=-25*l,c.zStrength=0,c.radius=10,c.pos=e.mPos,c.enabled=!0,c.attractsParticles=!0)}var f=calculate2dAngle(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),_=new u.Point3d(1,0,0);_=(0,d.rotate2dPoint)(_,f),e.mSpeed.add(_).multiply(.002),e.mSpeed.multiply(.98),e.mAnimationIndex+=e.mAnimationSpeed,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this);var h=e.getRadius(),p=e.getRadius(),y=e.mGrid.extentX()-e.getRadius()-1,E=e.mGrid.extentY()-e.getRadius()-1;e.mPos.x<h?(e.mPos.x=h,e.mSpeed.x=-e.mSpeed.x):e.mPos.x>y&&(e.mPos.x=y,e.mSpeed.x=-e.mSpeed.x),e.mPos.y<p?(e.mPos.y=p,e.mSpeed.y=-e.mSpeed.y):e.mPos.y>E&&(e.z.mPos.y=E,e.mSpeed.y=-e.mSpeed.y)}},{key:"hit",value:function(e){var t=this,i=e;if(i){if(t.mActivated){t.mSound.playTrack(SOUNDID_GRAVITYWELLHIT),t.mStrength*=.985;var n=!1;if(t.mStrength<.7){if(t.setState(m.ENTITY_STATE_DESTROY_TRANSITION),t.mSound.playTrack(SOUNDID_GRAVITYWELLDESTROYED),i){if(t.mPoints){var r=t.getPos();0==i.mPlayerSource?t.mPlayers.mPlayer1.addKillAtLocation(t.mPoints,r):1==i.mPlayerSource&&t.mPlayers.mPlayer2.addKillAtLocation(t.mPoints,r),n=!0}}else n=!0;if(n)for(var o=0;o<t.mFeedCount;o++)if(100*Math.random()<50)if(100*Math.random()<50){var a=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_MEDIUM);a&&(a.setState(m.ENTITY_STATE_SPAWN_TRANSITION),a.setPos(t.getPos()),a.setRotationRate(.01*Math.random()-.05),a.setSpeed(new u.Point3d(.1*Math.random()-.05,.1*Math.random()-.05,0)),a.setDrift(new u.Point3d(1*Math.random()-.5,1*Math.random()-.5,0)))}else for(var s=0;s<2;s++){var l=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_SMALL);l&&(l.setState(m.ENTITY_STATE_SPAWN_TRANSITION),l.setPos(t.getPos()),l.setRotationRate(.01*Math.random()-.05),l.setSpeed(new u.Point3d(.1*Math.random()-.05,.1*Math.random()-.05,0)),l.setDrift(new u.Point3d(1*Math.random()-.5,1*Math.random()-.5,0)))}else{var c=t.mEnemies.getUnusedEnemyOfType(ENTITY_TYPE_GEOM_LARGE);c&&(c.setState(m.ENTITY_STATE_SPAWN_TRANSITION),c.setPos(t.getPos()),c.setRotationRate(.01*Math.random()-.05),c.setSpeed(new u.Point3d(.1*Math.random()-.05,.1*Math.random()-.05,0)),c.setDrift(new u.Point3d(1*Math.random()-.5,1*Math.random()-.5,0)))}}}else t.mActivated=!0,t.mGameMode==GAMEMODE_PLAYING&&t.mHumLoopSoundId==-1&&(t.mHumLoopSoundId=t.mSound.playTrackGroup(SOUNDID_GRAVITYWELL_HUMLOOPA,SOUNDID_GRAVITYWELL_HUMLOOPF)),t.mBalance=2,t.mBalanceRate=0;var f=void 0;t.mActivated?(f=t.mRadius+Math.sin(mAnimationIndex)*mAnimationDepth,f*=t.mStrength+.1*t.mBalance):f=t.mRadius;for(var _=0;_<360;_++)if(100*Math.random()<10){var h=(0,d.DegreesToRads)(_),p=new u.Point3d(0,f+1,0);p=(0,d.rotate2dPoint)(p,h),p.add(t.mPos);var y=new u.Point3d(0,h,0),E=30,T=0,g=1,v=100,P=t.mPen;P.r=Math.random()+.5,P.g=Math.random()+.5,P.b=Math.random()+.5,P.a=.2,P.lineRadius=5,t.mParticles.emitter(p,y,E,T,g,P,v,!1,!0,.95)}t.mBalance-=.2}else if(e&&e.getType()==m.ENTITY_TYPE_BLACKHOLE){t.mActivated=!0,t.mBalance=2,t.mBalanceRate=0;var S=t.mAttractors.getAttractor();S&&(S.strength=20,S.zStrength=0,S.radius=20,S.pos=t.mPos,S.enabled=!0,S.attractsParticles=!1)}else t.destroyTransition()}},{key:"draw",value:function(){var e=this;if((e.getState()!=m.ENTITY_STATE_INDICATING||1&(parseInt(mStateTimer/10),10))&&e.getEnabled()){if(e.getState()==m.ENTITY_STATE_SPAWNING){var t=e.mRadius,i=1/e.mSpawnTime,n=e.mStateTimer*i;n=1-n;var r=n;r<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*n*1,e.drawRing(),n+=.25,r=1-n,r<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*n*4,e.drawRing(),n+=.25,r=1-n,r<0&&(r=0),r>1&&(r=1),e.mPen.a=r,e.mRadius=t*n*7,e.drawRing(),e.mRadius=t}e.drawRing()}}},{key:"drawRing",value:function(){var e=this.getState()!=m.ENTITY_STATE_INDICATING&&this.mActivated,t=void 0;if(e?(t=this.mRadius+Math.sin(this.mAnimationIndex)*this.mAnimationDepth,t*=this.mStrength+.1*this.mBalance,t*=.8):t=this.mRadius,e&&this.mState!=m.ENTITY_STATE_SPAWNING);if(this.mState!=m.ENTITY_STATE_SPAWNING&&this.mPass!==c.RENDERPASS_PRIMARY){t}e&&(this.mState,m.ENTITY_STATE_SPAWNING)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityGeomLarge=void 0;var a=i(2),s=i(20),m=i(4),l=i(0);t.entityGeomLarge=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=.4,o.mRadius=.5,o.mScoreValue=50,o.mType=a.ENTITY_TYPE_GEOM_LARGE;var s=0;o.mModel.mNumVertex=12,o.mModel.mVertexList=[],o.mModel.mVertexList[s++]=new l.Point3d(-.5,-2),o.mModel.mVertexList[s++]=new l.Point3d(-.5,-.5),o.mModel.mVertexList[s++]=new l.Point3d(-2,-.5),o.mModel.mVertexList[s++]=new l.Point3d(-2,.5),o.mModel.mVertexList[s++]=new l.Point3d(-.5,.5),o.mModel.mVertexList[s++]=new l.Point3d(-.5,2),o.mModel.mVertexList[s++]=new l.Point3d(.5,2),o.mModel.mVertexList[s++]=new l.Point3d(.5,.5),o.mModel.mVertexList[s++]=new l.Point3d(2,.5),o.mModel.mVertexList[s++]=new l.Point3d(2,-.5),o.mModel.mVertexList[s++]=new l.Point3d(.5,-.5),o.mModel.mVertexList[s++]=new l.Point3d(.5,-2),o.mModel.mNumEdges=12,o.mModel.mEdgeList=[];for(var d=0;d<o.mModel.mNumEdges;d++)o.mModel.mEdgeList.push(new m.Edge);return s=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=1,o.mModel.mEdgeList[s].from=1,o.mModel.mEdgeList[s++].to=2,o.mModel.mEdgeList[s].from=2,o.mModel.mEdgeList[s++].to=3,o.mModel.mEdgeList[s].from=3,o.mModel.mEdgeList[s++].to=4,o.mModel.mEdgeList[s].from=4,o.mModel.mEdgeList[s++].to=5,o.mModel.mEdgeList[s].from=5,o.mModel.mEdgeList[s++].to=6,o.mModel.mEdgeList[s].from=6,o.mModel.mEdgeList[s++].to=7,o.mModel.mEdgeList[s].from=7,o.mModel.mEdgeList[s++].to=8,o.mModel.mEdgeList[s].from=8,o.mModel.mEdgeList[s++].to=9,o.mModel.mEdgeList[s].from=9,o.mModel.mEdgeList[s++].to=10,o.mModel.mEdgeList[s].from=10,o.mModel.mEdgeList[s++].to=11,o.mModel.mEdgeList[s].from=11,o.mModel.mEdgeList[s++].to=0,o}return o(t,e),t}(s.entityGeom)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityGeomMedium=void 0;var a=i(2),s=i(20),m=i(4),l=i(0);t.entityGeomMedium=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=.45,o.mRadius=.5,o.mScoreValue=20,o.mType=a.ENTITY_TYPE_GEOM_MEDIUM;var s=0;o.mModel.mNumVertex=4,o.mModel.mVertexList=[],o.mModel.mVertexList[s++]=new l.Point3d(-2,0),o.mModel.mVertexList[s++]=new l.Point3d(0,1),o.mModel.mVertexList[s++]=new l.Point3d(2,0),o.mModel.mVertexList[s++]=new l.Point3d(0,-1),o.mModel.mNumEdges=4,o.mModel.mEdgeList=[];for(var d=0;d<o.mModel.mNumEdges;d++)o.mModel.mEdgeList.push(new m.Edge);return s=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=1,o.mModel.mEdgeList[s].from=1,o.mModel.mEdgeList[s++].to=2,o.mModel.mEdgeList[s].from=2,o.mModel.mEdgeList[s++].to=3,o.mModel.mEdgeList[s].from=3,o.mModel.mEdgeList[s++].to=0,o}return o(t,e),t}(s.entityGeom)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityGeomSmall=void 0;var a=i(2),s=i(20),m=i(4),l=i(0);t.entityGeomSmall=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=.4,o.mRadius=.5,o.mScoreValue=10,o.mType=a.ENTITY_TYPE_GEOM_SMALL;var s=0;o.mModel.mNumVertex=3,o.mModel.mVertexList=[],o.mModel.mVertexList[s++]=new l.Point3d(0,1),o.mModel.mVertexList[s++]=new l.Point3d(1,-1),o.mModel.mVertexList[s++]=new l.Point3d(-1,-1),o.mModel.mNumEdges=3,o.mModel.mEdgeList=[];for(var d=0;d<o.mModel.mNumEdges;d++)o.mModel.mEdgeList.push(new m.Edge);return s=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=1,o.mModel.mEdgeList[s].from=1,o.mModel.mEdgeList[s++].to=2,o.mModel.mEdgeList[s].from=2,o.mModel.mEdgeList[s++].to=0,o}return o(t,e),t}(s.entityGeom)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityGrunt=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(0),d=i(3),u=i(4),c=i(1);t.entityGrunt=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=1.5,o.mRadius=3,o.mScoreValue=50,o.mType=m.ENTITY_TYPE_GRUNT,o.setState(m.ENTITY_STATE_INACTIVE),o.mAnimationIndex=0,o.mPen=new d.pen(.5,1,1,.7,12);var a=0;o.mModel.mNumVertex=4,o.mModel.mVertexList=[],o.mModel.mVertexList[a++]=new l.Point3d(0,1),o.mModel.mVertexList[a++]=new l.Point3d(1,0),o.mModel.mVertexList[a++]=new l.Point3d(0,-1),o.mModel.mVertexList[a++]=new l.Point3d(-1,0),o.mModel.mNumEdges=4,o.mModel.mEdgeList=[];for(var s=0;s<o.mModel.mNumEdges;s++)o.mModel.mEdgeList.push(new u.Edge);return a=0,o.mModel.mEdgeList[a].from=0,o.mModel.mEdgeList[a++].to=1,o.mModel.mEdgeList[a].from=1,o.mModel.mEdgeList[a++].to=2,o.mModel.mEdgeList[a].from=2,o.mModel.mEdgeList[a++].to=3,o.mModel.mEdgeList[a].from=3,o.mModel.mEdgeList[a++].to=0,o}return o(t,e),a(t,[{key:"run",value:function(){var e=this;if(this.getEnabled()){var i=(0,c.calculate2dAngle)(e.mPos,e.mPlayers.mPlayer1.getPos()),n=new l.Point3d(1,0,0);n=(0,c.rotate2dPoint)(n,i),e.mSpeed.add(n).multiply(.01),e.mSpeed=(0,c.clamp2dVector)(e.mSpeed,.3*e.mAggression),e.mSpeed.multiply(20.99),e.mAnimationIndex+=.07,e.mScale=2+.4*Math.sin(this.mAnimationIndex)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityLine=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(0),d=i(3),u=i(4),c=i(1);t.entityLine=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.mScale=1,e.mRadius=1,e.mEdgeBounce=!1,e.mGridBound=!1,e.mTimeToLive=0,e.mSpawnTime=0,e.mDestroyTime=0,e.mType=m.ENTITY_TYPE_LINE,e.setState(m.ENTITY_STATE_INACTIVE),e.mModel.mNumVertex=2,e.mModel.mVertexList=[],e.mModel.mVertexList[0]=new l.Point3d(0,0),e.mModel.mVertexList[1]=new l.Point3d(0,0),e.mModel.mNumEdges=1,e.mModel.mEdgeList=[];for(var i=0;i<e.mModel.mNumEdges;i++)e.mModel.mEdgeList.push(new u.Edge);return e.mModel.mEdgeList[0].from=0,e.mModel.mEdgeList[0].to=1,e.mPen=new d.pen(1,0,0,1,1),e}return o(t,e),a(t,[{key:"spawnTransition",value:function(){this.setState(m.ENTITY_STATE_RUNNING),this.mTimeToLive=100,this.run()}},{key:"spawn",value:function(){}},{key:"runTransition",value:function(){}},{key:"run",value:function(){if(this.mTimeToLive<50){this.mPen.a*=.95,(0,d.extendVector)(this.mModel.mVertexList[0],this.mModel.mVertexList[1],.97);(0,c.calculate2dDistance)(this.mModel.mVertexList[0],this.mModel.mVertexList[1])<.1&&(this.mTimeToLive=0)}--this.mTimeToLive<=0&&(this.mTimeToLive=0,this.setState(m.ENTITY_STATE_DESTROYED)),this.mSpeed.multiply(.98),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"destroyTransition",value:function(){}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"draw",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this)}},{key:"addEndpoints",value:function(e,t){this.mModel.mVertexList[0]=new l.Point3d(e.x,e.y,e.z),this.mModel.mVertexList[1]=new l.Point3d(t.x,t.y,t.z)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityMayfly=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(1);t.entityMayfly=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=.8,o.mRadius=3,o.mTarget=new u.Point3d,o.mScoreValue=50,o.mType=m.ENTITY_TYPE_MAYFLY,o.setState(m.ENTITY_STATE_INACTIVE),o.mFlipTimer=15*Math.random(),o.mFlipDirection=1,o.mPen=new d.pen(1,.5,1,.7,12);var a=0;o.mModel.mNumVertex=6,o.mModel.mVertexList=[],o.mModel.mVertexList[a++]=new u.Point3d(-.25,1.25),o.mModel.mVertexList[a++]=new u.Point3d(.25,1.25),o.mModel.mVertexList[a++]=new u.Point3d(1.2,-.5),o.mModel.mVertexList[a++]=new u.Point3d(1,-.9),o.mModel.mVertexList[a++]=new u.Point3d(-1,-.9),o.mModel.mVertexList[a++]=new u.Point3d(-1.2,-.5),o.mModel.mNumEdges=3,o.mModel.mEdgeList=[];for(var s=0;s<o.mModel.mNumEdges;s++)o.mModel.mEdgeList.push(new l.Edge);return a=0,o.mModel.mEdgeList[a].from=0,o.mModel.mEdgeList[a++].to=3,o.mModel.mEdgeList[a].from=1,o.mModel.mEdgeList[a++].to=4,o.mModel.mEdgeList[a].from=2,o.mModel.mEdgeList[a++].to=5,o}return o(t,e),a(t,[{key:"run",value:function(){if(this.getEnabled()){--this.mFlipTimer<=0&&(this.mFlipTimer=15,this.mFlipDirection=-this.mFlipDirection,this.mTarget=new u.Point3d(this.mPlayers.mPlayer1.getPos().x,this.mPlayers.mPlayer1.getPos().y,this.mPlayers.mPlayer1.getPos().z),this.mTarget.x+=30*Math.random()-15,this.mTarget.y+=30*Math.random()-15);var e=1.2*this.mFlipDirection,i=e-this.mAngle;this.mRotationRate+=.03*i,this.mRotationRate*=.9;var n=(0,c.calculate2dAngle)(this.mPos,this.mTarget),r=new u.Point3d(1,0,0);r=(0,c.rotate2dPoint)(r,n),this.mSpeed.add(r).multiply(.5),this.mSpeed=(0,c.clamp2dVector)(this.mSpeed,.45*this.mAggression),this.mSpeed.multiply(.9)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityProton=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(7),f=i(1);t.entityProton=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.mScale=1,e.mRadius=1.2,e.mEdgeBounce=!0,e.mSpawnTime=0,e.mScoreValue=50,e.mDestroyTime=0,e.mPen=new d.pen(.5,.6,1,.7,12),e.mType=m.ENTITY_TYPE_PROTON,e.setState(m.ENTITY_STATE_INACTIVE),e.mModel.mNumVertex=16,e.mModel.mVertexList=[];for(var i=2*c.PI/e.mModel.mNumVertex,o=e.mScale.x*e.mRadius,a=0,s=0;a<e.mModel.mNumVertex;s+=i,a++)e.mModel.mVertexList[a]=new u.Point3d(o*Math.cos(s),o*Math.sin(s));for(e.mModel.mNumEdges=4,e.mModel.mEdgeList=[],a=0;a<e.mModel.mNumEdges;a++)e.mModel.mEdgeList.push(new l.Edge);for(a=0;a<e.mModel.mNumEdges-1;++a)e.mModel.mEdgeList[a].from=a,e.mModel.mEdgeList[a].to=a+1;return e.mModel.mEdgeList[a].from=a,e.mModel.mEdgeList[a].to=0,e}return o(t,e),a(t,[{key:"run",value:function(){var e=this;if(this.getEnabled()){var t=(0,f.calculate2dAngle)(e.mPos,e.mPlayers.getPlayerClosestToPosition(mPos).getPos()),i=new u.Point3d(1,0,0);i=(0,f.rotate2dPoint)(i,t),mSpeed.add(i).multiply(.1),mSpeed=(0,f.clamp2dVector)(mSpeed,.6*mAggression)}}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.mDrift.x=4*Math.random()-2,this.mDrift.y=4*Math.random()-2}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.entitySnake=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(1),f=i(16),_=23,h=5,p=function e(){o(this,e),this.pos=new u.Point3d,this.angle=0};(function(e){function t(){o(this,t);var e=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.mScale=1,e.mRadius=1,e.mScoreValue=0,e.mTail=0,e.mDestroyTime=0,e.mType=m.ENTITY_TYPE_SNAKE_SEGMENT,e.mPen=new d.pen(1,1,.8,.5,12);var i=0;e.mModel.mNumVertex=3,e.mModel.mVertexList=[],e.mModel.mVertexList[i++]=new u.Point3d(0,.8),e.mModel.mVertexList[i++]=new u.Point3d(.5,-.5),e.mModel.mVertexList[i++]=new u.Point3d(-.5,-.5),e.mModel.mNumEdges=3,e.mModel.mEdgeList=[];for(var r=0;r<e.mModel.mNumEdges;r++)e.mModel.mEdgeList.push(new l.Edge);i=0,e.mModel.mEdgeList[i].from=0,mModel.mEdgeList[i++].to=1,e.mModel.mEdgeList[i].from=1,mModel.mEdgeList[i++].to=2,e.mModel.mEdgeList[i].from=2,mModel.mEdgeList[i++].to=0,e.mSegmentStream=[];for(var a=0;a<h;a++)e.mSegmentStream.push(new p);for(var s=0;s<h;s++)e.mSegmentStream[s].pos=mPos,e.mSegmentStream[s].angle=mAngle;return e}r(t,e),a(t,[{key:"setParent",value:function(e){this.mParent=e}},{key:"getParent",value:function(){return this.mParent}},{key:"setStreamHead",value:function(e){this.mSegmentStream[0].pos=e.pos,this.mSegmentStream[0].angle=e.angle}},{key:"getStreamHead",value:function(){return this.mSegmentStream[0]}},{key:"getStreamTail",value:function(){return this.mSegmentStream[parseInt(this.mTail,10)]}},{key:"draw",value:function(){if(this.getState()==m.ENTITY_STATE_INDICATING){if(1&(parseInt(this.mParent.getStateTimer()/10),10)){var e=this.mPen;this.mPass==f.RENDERPASS_BLUR&&(e.r=1,e.g=.5,e.b=.1,e.lineRadius=18),this.mModel.draw(e)}}else if(this.getEnabled()){var t=this.mPen;this.mPass==f.RENDERPASS_BLUR&&(t.r=1,t.g=.5,t.b=.1,t.lineRadius=18),this.mModel.draw(t)}}},{key:"drawSpawn",value:function(e,t){var i=this.mPen,n=this.mScale,r=this.mPos,o=1/t,a=e*o;a=1-a;var s=a;s<0&&(s=0),s>1&&(s=1),i.a=s,this.mModel.Identity();var m=new u.Point3d(n.x*a*1,n.y,n.z);this.mModel.Scale(m),this.mModel.Rotate(this.mAngle),this.mModel.Translate(r),this.mModel.draw(i),this.mModel.Identity(),this.mModel.Rotate(this.mAngle),this.mModel.Scale(n),this.mModel.Translate(r)}},{key:"run",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this),this.setPos(this.mSegmentStream[0].pos),this.setAngle(this.mSegmentStream[0].angle);for(var e=h-2;e>=0;e--)this.mSegmentStream[e+1].pos=this.mSegmentStream[e].pos,this.mSegmentStream[e+1].angle=this.mSegmentStream[e].angle;this.mTail<h-1&&(this.mTail+=.1,this.mTail>h-1&&(this.mTail=h-1))}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.mTail=h-1}},{key:"postSpawnTransition",value:function(){for(var e=0;e<h;e++)this.mSegmentStream[e].pos=this.mPos,this.mSegmentStream[e].angle=this.mAngle}},{key:"destroyTransition",value:function(){this.setState(ENTITY_STATE_DESTROYED),this.mStateTimer=this.mDestroyTime;var e=new u.Point3d(this.mPos.x,this.mPos.y,this.mPos.z),t=new u.Point3d(0,0,0),i=2*PI,n=this.mPen;n.r*=1.2,n.g*=1.2,n.b*=1.2,n.a=.8,n.lineRadius=5,this.mParticles.emitter(e,t,1.2,i,10,n,150,!0,!0,.98,!0),this.mEnemies.explodeEntity(this)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"hit",value:function(e){}}]),t})(m.entity),t.entitySnake=function(e){function t(e,i){o(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.mPlayers=e,r.mEnemies=i,r.mParticles=i.mParticles;var a=r;r.mScale=1,r.mRadius=1,r.mScoreValue=0,r.mTail=0,r.mDestroyTime=0,r.mType=m.ENTITY_TYPE_SNAKE_SEGMENT,r.mPen=new d.pen(1,1,.8,.5,12);var s=0;r.mModel.mNumVertex=3,r.mModel.mVertexList=[],r.mModel.mVertexList[s++]=new u.Point3d(0,.8),r.mModel.mVertexList[s++]=new u.Point3d(.5,-.5),r.mModel.mVertexList[s++]=new u.Point3d(-.5,-.5),r.mModel.mNumEdges=3,r.mModel.mEdgeList=[];for(var c=0;c<r.mModel.mNumEdges;c++)r.mModel.mEdgeList.push(new l.Edge);s=0,r.mModel.mEdgeList[s].from=0,r.mModel.mEdgeList[s++].to=1,r.mModel.mEdgeList[s].from=1,r.mModel.mEdgeList[s++].to=2,r.mModel.mEdgeList[s].from=2,r.mModel.mEdgeList[s++].to=0,r.mSegmentStream=[];for(var f=0;f<h;f++){var _=new p;_.pos.x=a.mPos.x,_.pos.y=a.mPos.y,_.pos.z=a.mPos.z,_.angle=a.mAngle,a.mSegmentStream.push(_)}return r}return r(t,e),a(t,[{key:"runTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"runTransition",this).call(this)}},{key:"run",value:function(){var e=this;if(e.getEnabled()){(0,c.calculate2dDistance)(e.mPos,mTarget)<10&&e.updateTarget();var i=calculate2dAngle(e.mPos,mTarget)-(0,c.DegreesToRads)(90);Math.abs(i)>.1&&(e.mAngle<i?e.mRotationRate+=.005:e.mAngle>i&&(e.mRotationRate-=.005)),e.mRotationRate*=.98;var n=2;e.mRotationRate>n?e.mRotationRate=n:mRotationRate<-n&&(e.mRotationRate=-n);var r=new u.Point3d(0,1,0);r=(0,c.rotate2dPoint)(r,mAngle),e.mSpeed.add(r),e.mSpeed=(0,c.clamp2dVector)(e.mSpeed,.5),e.mSpeed.multiply(.95);var o=new p;o.pos=mPos,o.angle=mAngle,mSegments[0].setStreamHead(o);for(var a=_-2;a>=0;a--){var m=e.mSegments[a];e.mSegments[a+1].setStreamHead(m.getStreamTail())}for(var l=0;l<_;l++)e.mSegments[l].run()}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"draw",value:function(){if(this.getState()==m.ENTITY_STATE_INDICATING)1&(parseInt(mStateTimer/10),10)&&this.mModel.draw(this.mPen);else if(this.getEnabled()){var e=this.mPen;if(this.getState()==m.ENTITY_STATE_SPAWNING){var t=this.mScale,i=this.mPos,n=1/this.mSpawnTime,r=this.mStateTimer*n;r=1-r;var o=r;o<0&&(o=0),o>1&&(o=1),e.a=o,this.mModel.Identity(),this.mModel.Scale(t*r*1),this.mModel.Rotate(this.mAngle),this.mModel.Translate(i),this.mModel.emit(e),this.mModel.Identity(),this.mModel.Rotate(this.mAngle),this.mModel.Scale(t),this.mModel.Translate(i)}this.mModel.draw(e)}if(this.getState()==m.ENTITY_STATE_SPAWNING)for(var a=0;a<_;a++);else for(var s=0;s<_;s++);}},{key:"spawnTransition",value:function(){var e=this;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),e.mAngle=calculate2dAngle(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos())+(0,c.DegreesToRads)(-90),e.updateTarget();for(var i=0;i<_;i++){e.mSegments[i].spawnTransition();var n=new u.Point3d(0,(i+1)*-.2,0);n=(0,c.rotate2dPoint)(n,e.mAngle),e.mSegments[i].setPos(e.mPos.copy().add(n)),e.mSegments[i].setAngle(mAngle),e.mSegments[i].postSpawnTransition()}}},{key:"spawn",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawn",this).call(this);for(var e=0;e<_;e++)this.mSegments[e].spawn()}},{key:"hitTest",value:function(e,i){var n=s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hitTest",this).call(this,e,i);if(n)return n;for(var r=this,o=0;o<_;o++){var a=r.mSegments[o],m=new u.Point3d(0,0,0);a.getModel().mMatrix.TransformVertex(new u.Point3d(0,0,0),m);if((0,c.calculate2dDistance)(e,m)<i+a.getRadius())return a}return null}},{key:"destroyTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this);for(var e=0;e<_;e++)this.mSegments[e].destroyTransition()}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this);for(var e=0;e<_;e++)this.mSegments[e].destroy()}},{key:"indicateTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"indicateTransition",this).call(this);for(var e=0;e<_;e++)this.mSegments[e].setState(m.ENTITY_STATE_INDICATING)}},{key:"updateTarget",value:function(){var e=Math.random()*(2*PI);this.mTarget=new u.Point3d(40,0,0),this.mTarget=(0,c.rotate2dPoint)(this.mTarget,e),this.mTarget.add(this.mPos);var t=15,i=t,n=t,r=this.mGrid.extentX()-1-t,o=this.mGrid.extentY()-1-t;this.mTarget.x<i?this.mTarget.x=i:this.mTarget.x>r&&(this.mTarget.x=r),this.mTarget.y<n?this.mTarget.y=n:this.mTarget.y>o&&(this.mTarget.y=o)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entitySpinner=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(1);t.entitySpinner=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=1.6,o.mRadius=2.5,o.mScoreValue=100,o.mType=m.ENTITY_TYPE_SPINNER,o.setState(m.ENTITY_STATE_INACTIVE),o.mAnimationIndex=0,o.mPen=new d.pen(1,.5,1,.7,12);var a=0;o.mModel.mNumVertex=5,o.mModel.mVertexList=[],o.mModel.mVertexList[a++]=new u.Point3d(0,0),o.mModel.mVertexList[a++]=new u.Point3d(-1,1),o.mModel.mVertexList[a++]=new u.Point3d(1,1),o.mModel.mVertexList[a++]=new u.Point3d(1,-1),o.mModel.mVertexList[a++]=new u.Point3d(-1,-1),o.mModel.mNumEdges=8,o.mModel.mEdgeList=[];for(var s=0;s<o.mModel.mNumEdges;s++)o.mModel.mEdgeList.push(new l.Edge);return a=0,o.mModel.mEdgeList[a].from=1,o.mModel.mEdgeList[a++].to=0,o.mModel.mEdgeList[a].from=0,o.mModel.mEdgeList[a++].to=3,o.mModel.mEdgeList[a].from=4,o.mModel.mEdgeList[a++].to=0,o.mModel.mEdgeList[a].from=0,o.mModel.mEdgeList[a++].to=2,o.mModel.mEdgeList[a].from=2,o.mModel.mEdgeList[a++].to=3,o.mModel.mEdgeList[a].from=3,o.mModel.mEdgeList[a++].to=4,o.mModel.mEdgeList[a].from=4,o.mModel.mEdgeList[a++].to=1,o.mModel.mEdgeList[a].from=1,o.mModel.mEdgeList[a++].to=2,o}return o(t,e),a(t,[{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this)}},{key:"run",value:function(){var e=this;if(e.getEnabled()){var i=(0,c.calculate2dAngle)(e.mPos,e.mPlayers.mPlayer1.getPos()),n=new u.Point3d(1,0,0);n=(0,c.rotate2dPoint)(n,i),e.mSpeed.add(n.multiply(.2)),e.mSpeed=(0,c.clamp2dVector)(e.mSpeed,.6*e.mAggression),e.mSpeed.multiply(.9),e.mAnimationIndex+=.12,e.mAngle=.5*Math.sin(e.mAnimationIndex)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"destroyTransition",value:function(){var e=this,i=e.mPos;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this);var n=new u.Point3d(12,0,0),r=(0,c.calculate2dAngle)(i,e.mPlayers.mPlayer1.getPos());n=(0,c.rotate2dPoint)(n,r+(0,c.DegreesToRads)(90));var o=e.mEnemies.getUnusedEnemyOfType(m.ENTITY_TYPE_TINYSPINNER);o&&(o.setPos(n.copy().add(i)),o.setSpeed(n.copy().multiply(.2)),o.setState(m.ENTITY_STATE_SPAWN_TRANSITION)),n=(0,c.rotate2dPoint)(n,r-(0,c.DegreesToRads)(90)),(o=e.mEnemies.getUnusedEnemyOfType(m.ENTITY_TYPE_TINYSPINNER))&&(o.setPos(n.copy().add(i)),o.setSpeed(n.copy().multiply(.2)),o.setState(m.ENTITY_STATE_SPAWN_TRANSITION))}},{key:"hit",value:function(e){if(e){if(e)return void s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"hit",this).call(this,e)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityTinySpinner=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(0),d=i(3),u=i(1);t.entityTinySpinner=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=1,o.mRadius=2.2,o.mScoreValue=50,o.mVirtualPos=new l.Point3d(0,0,0),o.mAnimationIndex=0,o.mType=m.ENTITY_TYPE_TINYSPINNER,o}return o(t,e),a(t,[{key:"draw",value:function(){this.getState()==m.ENTITY_STATE_INDICATING?1&(parseInt(this.mStateTimer/10),10)&&this.mModel.draw(this.mPen):this.getEnabled()&&(this.mModel.Identity(),this.mModel.Scale(this.mScale),this.mModel.Rotate(this.mAngle),this.mModel.Translate(this.mVirtualPos),this.mModel.draw(this.mPen))}},{key:"run",value:function(){if(this.getEnabled()){var e=(0,u.calculate2dAngle)(this.mPos,this.mPlayers.getPlayerClosestToPosition(this.mPos).getPos()),i=new l.Point3d(1,0,0);i=(0,u.rotate2dPoint)(i,e),this.mSpeed.add(i).multiply(.02),this.mSpeed=(0,u.clamp2dVector)(this.mSpeed,.3*mAggression),this.mSpeed.multiply(.9),this.mAnimationIndex+=.1;var n=new l.Point3d(4,0,0);n=(0,u.rotate2dPoint)(n,this.mAnimationIndex),this.mVirtualPos=this.mPos+n,this.mAngle=2*this.mAnimationIndex}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this)}},{key:"spawn",value:function(){if(s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawn",this).call(this),this.mStateTimer>0){var e=this.mStateTimer/this.mSpawnTime;e=1*e+.5*(1-e),this.mPen=new d.pen(1,e,1,.5,12),this.mStateTimer-=1,this.run()}mStateTimer<=0&&(this.mPen=new d.pen(1,.5,1,.5,12))}},{key:"destroyTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroyTransition",this).call(this)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityWanderer=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(7),f=i(1);t.entityWanderer=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mGrid=o.mPlayers.mGrid;var a=o;o.mScale=1.7,o.mRadius=2.6,o.mScoreValue=25,o.mEdgeBounce=!0,o.mType=m.ENTITY_TYPE_WANDERER,o.setState(m.ENTITY_STATE_INACTIVE),o.mAnimationIndex=0,o.mPen=new d.pen(.65,.5,1,.7,12);var s=0;if(o.mModel.mNumVertex=9,o.mModel.mVertexList=[],o.mModel.mVertexList[s++]=new u.Point3d(0,0),o.mModel.mVertexList[s++]=new u.Point3d(0,1),o.mModel.mVertexList[s++]=new u.Point3d(1,1),o.mModel.mVertexList[s++]=new u.Point3d(1,0),o.mModel.mVertexList[s++]=new u.Point3d(1,-1),o.mModel.mVertexList[s++]=new u.Point3d(0,-1),o.mModel.mVertexList[s++]=new u.Point3d(-1,-1),o.mModel.mVertexList[s++]=new u.Point3d(-1,0),o.mModel.mVertexList[s++]=new u.Point3d(-1,1),o.mFlipped=Math.random()<.5,o.mFlipped)for(var c=0;c<a.mModel.mNumVertex;c++){var f=a.mModel.mVertexList[c].y;a.mModel.mVertexList[c].y=a.mModel.mVertexList[c].x,a.mModel.mVertexList[c].x=f}o.mModel.mNumEdges=12,o.mModel.mEdgeList=[];for(var _=0;_<o.mModel.mNumEdges;_++)o.mModel.mEdgeList.push(new l.Edge);return s=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=1,o.mModel.mEdgeList[s].from=1,o.mModel.mEdgeList[s++].to=2,o.mModel.mEdgeList[s].from=2,o.mModel.mEdgeList[s++].to=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=3,o.mModel.mEdgeList[s].from=3,o.mModel.mEdgeList[s++].to=4,o.mModel.mEdgeList[s].from=4,o.mModel.mEdgeList[s++].to=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=5,o.mModel.mEdgeList[s].from=5,o.mModel.mEdgeList[s++].to=6,o.mModel.mEdgeList[s].from=6,o.mModel.mEdgeList[s++].to=0,o.mModel.mEdgeList[s].from=0,o.mModel.mEdgeList[s++].to=7,o.mModel.mEdgeList[s].from=7,o.mModel.mEdgeList[s++].to=8,o.mModel.mEdgeList[s].from=8,o.mModel.mEdgeList[s++].to=0,o}return o(t,e),a(t,[{key:"run",value:function(){var e=this;if(e.getEnabled()){if(40*Math.random()<1){var i=1.5;e.mCurrentHeading=e.mCurrentHeading+(Math.random()*i-i/2)}var n=new u.Point3d(1,0,0);n=(0,f.rotate2dPoint)(n,e.mCurrentHeading),n.multiply(.8),e.mSpeed.add(n).multiply(.02),e.mSpeed=(0,f.clamp2dVector)(e.mSpeed,.3),e.mSpeed.multiply(.98),e.mGrid.hitTest(e.mPos,2*this.getRadius())&&(e.mCurrentHeading=Math.random()*(2*c.PI))}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.mSpeed=new u.Point3d(0,0,0),this.mAngle=0,this.mCurrentHeading=Math.random()*(2*c.PI),this.mAngle=0,this.mRotationRate=this.mFlipped?-.12:.12}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.entityWeaver=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},m=i(2),l=i(4),d=i(3),u=i(0),c=i(1);t.entityWeaver=function(e){function t(e,i){n(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.mPlayers=e,o.mEnemies=i,o.mParticles=i.mParticles,o.mScale=1.5,o.mRadius=2.4,o.mScoreValue=100,o.mType=m.ENTITY_TYPE_WEAVER,o.setState(m.ENTITY_STATE_INACTIVE),o.mAnimationIndex=0,o.mPen=new d.pen(.3,1,.35,.5,12);var a=0;o.mModel.mNumVertex=8,o.mModel.mVertexList=[],o.mModel.mVertexList[a++]=new u.Point3d(0,1),o.mModel.mVertexList[a++]=new u.Point3d(1,0),o.mModel.mVertexList[a++]=new u.Point3d(0,-1),o.mModel.mVertexList[a++]=new u.Point3d(-1,0),o.mModel.mVertexList[a++]=new u.Point3d(-1,1),o.mModel.mVertexList[a++]=new u.Point3d(1,1),o.mModel.mVertexList[a++]=new u.Point3d(1,-1),o.mModel.mVertexList[a++]=new u.Point3d(-1,-1),o.mModel.mNumEdges=8,o.mModel.mEdgeList=[];for(var s=0;s<o.mModel.mNumEdges;s++)o.mModel.mEdgeList.push(new l.Edge);return a=0,o.mModel.mEdgeList[a].from=0,o.mModel.mEdgeList[a++].to=1,o.mModel.mEdgeList[a].from=1,o.mModel.mEdgeList[a++].to=2,o.mModel.mEdgeList[a].from=2,o.mModel.mEdgeList[a++].to=3,o.mModel.mEdgeList[a].from=3,o.mModel.mEdgeList[a++].to=0,o.mModel.mEdgeList[a].from=4,o.mModel.mEdgeList[a++].to=5,o.mModel.mEdgeList[a].from=5,o.mModel.mEdgeList[a++].to=6,o.mModel.mEdgeList[a].from=6,o.mModel.mEdgeList[a++].to=7,o.mModel.mEdgeList[a].from=7,o.mModel.mEdgeList[a++].to=4,o}return o(t,e),a(t,[{key:"run",value:function(){var e=this;if(e.getEnabled()){for(var i=0;i<e.mMaxMissiles;i++){var n=e.mPlayers.mPlayer1.missiles[i];if(n.getEnabled()){var r=(0,c.calculate2dAngle)(n.getPos(),e.mPos),o=(0,c.calculate2dAngle)(new u.Point3d(0,0,0),n.getSpeed()),a=(0,c.diffAngles)(r,o);if(Math.abs(a)<1){if((0,c.calculate2dDistance)(n.getPos(),e.mPos)<25){var m=(0,c.calculate2dAngle)(mPos,e.mPlayers.mPlayer1.getPos()),l=new u.Point3d(.8,a>0?1.1:-1.1,0);l=(0,c.rotate2dPoint)(l,m+(0,c.DegreesToRads)(180)),l=(0,c.clamp2dVector)(l,.08),e.mDrift.add(l)}}}}var d=(0,c.calculate2dAngle)(e.mPos,e.mPlayers.getPlayerClosestToPosition(e.mPos).getPos()),f=new u.Point3d(1,0,0);f=(0,c.rotate2dPoint)(f,d),f=(0,c.clamp2dVector)(f,.08),e.mSpeed.add(f),e.mSpeed=(0,c.clamp2dVector)(e.mSpeed,.6*e.mAggression),e.mSpeed.multiply(.95)}s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"run",this).call(this)}},{key:"spawnTransition",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"spawnTransition",this).call(this),this.mRotationRate=-.06}}]),t}(m.entity)},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.grid=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(3),s=i(0),m=i(8),l=i(1),d=i(7),u=0,c=1,f=2,_=new s.Point3d(0,0,1),h=function(e){return 0!=e.z},p=function(e,t,i){return i.mGridInfo.grid[e+t*i.mGridInfo.divsX]},y=function e(t,i){n(this,e),this.pos=(0,m.v2d_new)(t,i),this.vel=0,this.isAnchor=!1,this.isVisible=!1};t.grid=function(){function e(t){n(this,e),this.mAttractors=t,this.mBrightness=0,this.mFadeStatus=u,this.mLevel=0,this.q=30,this.damping=2.6,this.mGridInfo={grid:null},this.initGrid(0)}return r(e,[{key:"initGrid",value:function(e){var t=this;t.mGridInfo.grid&&(t.mGridInfo.grid=null);var i=e>=14;if(e%=14,i&&0==e&&(e=1),0==[0,1,12,13,2,4,11,3,5,8,15,14,9,6][e]){var n=new s.Point3d(0,0),r=new s.Point3d(0,8),o=new s.Point3d(15,8),d=new s.Point3d(15,0),u=[n,r,o,d,n];t.mGridInfo.poly=u,t.mGridInfo.polyPoints=5,t.mGridInfo.scale=9,t.mGridInfo.divsX=81,t.mGridInfo.divsY=41,t.mGridInfo.brightGridColor=new a.pen(.2,.2,1,.4,0),t.mGridInfo.dimGridColor=new a.pen(.2,.2,1,.12,0)}t.mGridPointScaleX=0,t.mGridPointScaleY=0;for(var c=0,f=0,E=t.mGridInfo.poly[0].copy().multiply(t.mGridInfo.scale),T=1;T<t.mGridInfo.polyPoints;T++){var g=t.mGridInfo.poly[T].copy().multiply(t.mGridInfo.scale);h(g)?(T++,E=t.mGridInfo.poly[T].copy().multiply(t.mGridInfo.scale)):(E.x>c&&(c=E.x),g.x>c&&(c=g.x),E.y>f&&(f=E.y),g.y>f&&(f=g.y),E=g)}t.mGridExtentX=c,t.mGridExtentY=f,t.mGridPointScaleX=c/(t.mGridInfo.divsX-1),t.mGridPointScaleY=f/(t.mGridInfo.divsY-1),t.mGridInfo.grid=[];for(var v=0,P=t.mGridInfo.divsX*t.mGridInfo.divsY;v<P;v++)t.mGridInfo.grid.push(new y);for(var S=0;S<t.mGridInfo.divsY;++S)for(var I=0;I<t.mGridInfo.divsX;++I)p(I,S,t).pos=new s.Point3d(I,S,0),p(I,S,t).vel=new s.Point3d(0,0,0),p(I,S,t).isAnchor=!1;for(var w=0;w<t.mGridInfo.divsY;++w)for(var b=0;b<t.mGridInfo.divsX;++b){var M=new s.Point3d(b*t.mGridPointScaleX,w*t.mGridPointScaleX,0);p(b,w,t).isVisible=(0,l.pointInPolygon)(M,t.mGridInfo.poly,t.mGridInfo.polyPoints,t.mGridInfo.scale)}for(var N=0;N<t.mGridInfo.divsY;++N)for(var L=0;L<t.mGridInfo.divsX;++L)for(var A=new s.Point3d(L*t.mGridPointScaleX,N*t.mGridPointScaleX,0),x=t.mGridInfo.poly[0].copy().multiply(t.mGridInfo.scale),O=1;O<t.mGridInfo.polyPoints;O++){var Y=t.mGridInfo.poly[O].copy().multiply(t.mGridInfo.scale);h(Y)?(O++,x=t.mGridInfo.poly[O].copy().multiply(t.mGridInfo.scale)):((0,l.isPointOnLine)(x,Y,A)&&(p(L,N,t).isVisible=!0,p(L,N,t).isAnchor=!0),x=Y)}for(var R=[],G=0;G<300;++G)R.push((0,m.v2d_new)());t.mGridInfo.polyInner=R;for(var k=t.getNumShapes(),C=0;C<k;C++){var D=void 0,V=void 0,j=t.getShapeIndexes(C,D,V);D=j.start,V=j.end;var W=void 0;for(W=D;W<=V;W++){var B=new s.Point3d(t.mGridInfo.poly[W<=0?V:W-1]),H=new s.Point3d(t.mGridInfo.poly[W]),F=new s.Point3d(t.mGridInfo.poly[W>=V?D:W+1]),U=(0,l.calculate2dAngle)(B,F)+(0,l.DegreesToRads)(90),X=new s.Point3d(-.2,0,0);X=(0,l.rotate2dPoint)(X,U);var z=new s.Point3d(H.x+X.x,H.y+X.y,H.z);t.mGridInfo.polyInner[W]=z}var K=t.mGridInfo.polyInner[D],Z=t.mGridInfo.polyInner[V],q=new s.Point3d((K.x+Z.x)/2,(K.y+Z.y)/2,0);t.mGridInfo.polyInner[D]=q,t.mGridInfo.polyInner[V]=q}for(var $=0;$<t.mGridInfo.polyPoints;$++){h(t.mGridInfo.poly[$].copy().multiply(t.mGridInfo.scale))&&(t.mGridInfo.polyInner[$]=_)}}},{key:"getNumShapes",value:function(){for(var e=this,t=1,i=0;i<e.mGridInfo.polyPoints;i++){h(e.mGridInfo.poly[i].copy().multiply(e.mGridInfo.scale))&&++t}return t}},{key:"getShapeIndexes",value:function(e,t,i){var n=this;if(t=0,i=n.mGridInfo.polyPoints-1,1==n.getNumShapes())return{start:t,end:i};for(var r=0,o=0;o<n.mGridInfo.polyPoints;o++){if(h(new s.Point3d(n.mGridInfo.poly[o]))&&(++r,++o),r==e){t=o;break}}for(var a=t;a<n.mGridInfo.polyPoints;a++){if(h(new s.Point3d(n.mGridInfo.poly[a]))&&(++r,++a),r==e+1){i=a-2;break}}return{start:t,end:i}}},{key:"hitTest",value:function(e,t,i,n){var r=this;return i&&(i=e),n&&(n=0),0==t?!(0,l.pointInPolygon)(e,r.mGridInfo.poly,r.mGridInfo.polyPoints,r.mGridInfo.scale)&&(i&&(i=r.getHitPoint(e,t)),n&&(n=r.getHitAngle(e)),{hitPoint:i,angle:n}):!(0,l.pointInPolygon)(e,r.mGridInfo.polyInner,r.mGridInfo.polyPoints,r.mGridInfo.scale)&&(i&&(i=r.getHitPoint(e,t)),n&&(n=r.getHitAngle(e)),{hitPoint:i,angle:n})}},{key:"getHitPoint",value:function(e,t){var i=this;if(0==t){for(var n=new s.Point3d,r=new s.Point3d,o=d.MAXINT,a=i.mGridInfo.poly[0].copy().multiply(i.mGridInfo.scale),m=1;m<i.mGridInfo.polyPoints;m++){var u=i.mGridInfo.poly[m].copy().multiply(i.mGridInfo.scale),c=(0,l.pointLineDistance)(a,u,e);c<o&&(o=c,n=new s.Point3d(a.x,a.y,a.z),r=new s.Point3d(u.x,u.y,u.z)),a=new s.Point3d(u.x,u.y,u.z)}return(0,l.closestPointOnLineSegment)(n,r,e)}for(var f=new s.Point3d,_=new s.Point3d,p=d.MAXINT,y=i.mGridInfo.poly[0].copy().multiply(i.mGridInfo.scale),E=1;E<i.mGridInfo.polyPoints;E++){var T=i.mGridInfo.poly[E].copy().multiply(i.mGridInfo.scale);if(h(T))E++,y=i.mGridInfo.poly[E].copy().multiply(i.mGridInfo.scale);else{var g=(0,l.pointLineDistance)(y,T,e);g<p&&(p=g,f=y,_=T),y=T}}return(0,l.closestPointOnLineSegment)(f,_,e)}},{key:"getHitAngle",value:function(e){for(var t=this,i=void 0,n=void 0,r=d.MAXINT,o=t.mGridInfo.poly[0].copy().multiply(t.mGridInfo.scale),a=1;a<t.mGridInfo.polyPoints;a++){var s=t.mGridInfo.poly[a].copy().multiply(t.mGridInfo.scale),m=(0,l.pointLineDistance)(o,s,e);m<r&&(r=m,i=o,n=s),o=s}return(0,l.calculate2dAngle)(i,n)-(0,l.DegreesToRads)(90)}},{key:"run",value:function(){for(var e=.1,t=this,i=0;i<this.mAttractors.mNumAttractors;i++){var n=t.mAttractors.mAttractors[i];if(n.enabled){var r=n.pos.x/t.mGridPointScaleX,o=n.pos.y/t.mGridPointScaleY,a=n.radius/t.mGridPointScaleX,m=r-2*a,d=r+2*a;if(m>d){var _=d;d=m,m=_}m<1?m=1:m>t.mGridInfo.divsX-2&&(m=t.mGridInfo.divsX-2),d<1?d=1:d>t.mGridInfo.divsX-2&&(d=t.mGridInfo.divsX-2);var h=o-2*a,y=o+2*a;if(h>y){var E=y;y=h,h=E}h<1?h=1:h>t.mGridInfo.divsY-2&&(h=t.mGridInfo.divsY-2),y<1?y=1:y>t.mGridInfo.divsY-2&&(y=t.mGridInfo.divsY-2),m=parseInt(m,10),d=parseInt(d,10),h=parseInt(h,10),y=parseInt(y,10);for(var T=h;T<y;++T)for(var g=m;g<d;++g){var v=p(g,T,t).pos,P=new s.Point3d(n.pos.x/t.mGridPointScaleX,n.pos.y/t.mGridPointScaleY),S=(0,l.calculate2dAngle)(v,P),I=(0,l.calculate2dDistance)(v,P),w=n.strength,b=n.zStrength,M=I;if(M<n.radius/t.mGridPointScaleX){M*=M,M<1&&(M+=.1);var N=new s.Point3d(-M*w,0,0),L=(0,l.rotate2dPoint)(N,S);p(g,T,t).vel.x+=.008*L.x,p(g,T,t).vel.y+=.008*L.y,p(g,T,t).vel.z+=b}}}}switch(t.mFadeStatus){case u:break;case c:t.mBrightness>0&&(t.mBrightness*=.98);break;case f:t.mBrightness<1&&(t.mBrightness+=.005)}for(var A=-t.q*e,x=Math.exp(-e*t.damping),O=1;O<t.mGridInfo.divsY-1;++O)for(var Y=1;Y<t.mGridInfo.divsX-1;++Y){var R=p(Y-1,O,t).pos,G=p(Y+1,O,t).pos,k=p(Y,O-1,t).pos,C=p(Y,O+1,t).pos,D=(new s.Point3d).add(R).add(G).add(k).add(C).multiply(.25);p(Y,O,t).isAnchor||(p(Y,O,t).vel.add(p(Y,O,t).pos.copy().subtract(D).multiply(A)),p(Y,O,t).vel.multiply(x),p(Y,O,t).pos.add(p(Y,O,t).vel.copy().multiply(e)))}}},{key:"draw",value:function(){var e=this;if(!(e.mBrightness<=.01)){e.mBrightness=1;var t=e.mBrightness;(0,o.glLineWidth)(5),(0,o.glPointSize)(3);for(var i=0;i<e.mGridInfo.divsY;++i){i%5==0?(0,o.glColor4f)(e.mGridInfo.brightGridColor.r,e.mGridInfo.brightGridColor.g,e.mGridInfo.brightGridColor.b,e.mGridInfo.brightGridColor.a*t):(0,o.glColor4f)(e.mGridInfo.dimGridColor.r,e.mGridInfo.dimGridColor.g,e.mGridInfo.dimGridColor.b,e.mGridInfo.dimGridColor.a*t),(0,o.glBegin)(o.GL_LINES);for(var n=0;n<e.mGridInfo.divsX-1;++n)if(p(n,i,e).isVisible&&p(n+1,i,e).isVisible){var r=p(n,i,e).pos,a=p(n+1,i,e).pos;(0,o.glVertex3d)(r.x*e.mGridPointScaleX,r.y*e.mGridPointScaleY,0),(0,o.glVertex3d)(a.x*e.mGridPointScaleX,a.y*e.mGridPointScaleY,0)}(0,o.glEnd)()}for(var s=0;s<e.mGridInfo.divsX;++s){s%5==0?(0,o.glColor4f)(e.mGridInfo.brightGridColor.r,e.mGridInfo.brightGridColor.g,e.mGridInfo.brightGridColor.b,e.mGridInfo.brightGridColor.a*t):(0,o.glColor4f)(e.mGridInfo.dimGridColor.r,e.mGridInfo.dimGridColor.g,e.mGridInfo.dimGridColor.b,e.mGridInfo.dimGridColor.a*t),(0,o.glBegin)(o.GL_LINES);for(var m=0;m<e.mGridInfo.divsY-1;++m)if(p(s,m,e).isVisible&&p(s,m+1,e).isVisible){var l=p(s,m,e).pos,d=p(s,m+1,e).pos;(0,o.glVertex3d)(l.x*e.mGridPointScaleX,l.y*e.mGridPointScaleY,0),(0,o.glVertex3d)(d.x*e.mGridPointScaleX,d.y*e.mGridPointScaleY,0)}(0,o.glEnd)()}(0,o.glColor4f)(1,1,1,1*t),(0,o.glLineWidth)(5),(0,o.glBegin)(o.GL_LINES);for(var u=e.mGridInfo.poly[0].copy().multiply(e.mGridInfo.scale),c=1;c<e.mGridInfo.polyPoints;c++){var f=e.mGridInfo.poly[c].copy().multiply(e.mGridInfo.scale);h(f)?(c++,u=e.mGridInfo.poly[c].copy().multiply(e.mGridInfo.scale)):((0,o.glVertex3d)(u.x,u.y,0),(0,o.glVertex3d)(f.x,f.y,0),u=f)}(0,o.glEnd)()}}},{key:"startLevel",value:function(e){this.mLevel=e,this.initGrid(this.mLevel),this.mBrightness=0,this.mFadeStatus=f}},{key:"endLevel",value:function(){this.mFadeStatus=c}},{key:"extentX",value:function(){return this.mGridExtentX}},{key:"extentY",value:function(){return this.mGridExtentY}},{key:"brightness",value:function(){return this.mBrightness}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.hyperspace=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(0),a=i(3),s=i(5),m=2e3,l=200,d=function e(){n(this,e),this.lastPos=new o.Point3d,this.pos=new o.Point3d,this.lastProjected=new o.Point3d,this.projected=new o.Point3d,this.color=new a.pen};t.hyperspace=function(){function e(t){n(this,e);var i=this;i.mCamera=t,i.mStars=[];for(var r=0;r<m;r++)i.mStars.push(new d),i.mStars[r].lastPos.x=i.mStars[r].pos.x=Math.random()*l-l/2,i.mStars[r].lastPos.y=i.mStars[r].pos.y=Math.random()*l-l/2,i.mStars[r].lastPos.z=i.mStars[r].pos.z=Math.random()*l-l/2,i.mStars[r].color=new a.pen(Math.random()+.5,Math.random()+.5,Math.random()+.5,1,1);i.mCurrentBrightness=i.mTargetBrightness=0}return r(e,[{key:"run",value:function(){for(var e=this,t=0;t<m;t++)e.mStars[t].lastPos.z=e.mStars[t].pos.z,e.mStars[t].pos.z+=2*e.mCurrentBrightness,e.mStars[t].pos.z>100&&(e.mStars[t].lastPos.x=e.mStars[t].pos.x=Math.random()*l-l/2,e.mStars[t].lastPos.y=e.mStars[t].pos.y=Math.random()*l-l/2,e.mStars[t].lastPos.z=e.mStars[t].pos.z=Math.random()*l-l/2,e.mStars[t].color=new a.pen(Math.random()+.5,Math.random()+.5,Math.random()+.5,1,1));e.mCurrentBrightness<e.mTargetBrightness?e.mCurrentBrightness+=.005:e.mCurrentBrightness>e.mTargetBrightness&&(e.mCurrentBrightness*=.99)}},{key:"draw",value:function(){var e=this;(0,s.glColor4f)(1,1,1,1),(0,s.glBegin)(s.GL_LINES);for(var t=0;t<m;t++)(0,s.glColor4f)(1,1,1,.5*e.mCurrentBrightness),(0,s.glVertex3d)(e.mStars[t].lastPos.x+e.mCamera.mCurrentPos.x,e.mStars[t].lastPos.y+e.mCamera.mCurrentPos.y,e.mStars[t].lastPos.z+e.mCamera.mCurrentPos.z),(0,s.glVertex3d)(e.mStars[t].pos.x+e.mCamera.mCurrentPos.x,e.mStars[t].pos.y+e.mCamera.mCurrentPos.y,e.mStars[t].pos.z+e.mCamera.mCurrentPos.z);(0,s.glEnd)()}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.linkedList=function(){function e(){n(this,e),this.start=null,this.end=null}return r(e,[{key:"makeNode",value:function(){return{data:null,next:null}}},{key:"add",value:function(e){null===this.start?(this.start=this.makeNode(),this.end=this.start):(this.end.next=this.makeNode(),this.end=this.end.next),this.end.data=e}},{key:"remove",value:function(e){for(var t=this.start,i=this.start;null!==t;){if(e===t.data)return t===this.start?void(this.start=t.next):(t==this.end&&(this.end=i),void(i.next=t.next));i=t,t=t.next}}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.particle=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(0),s=i(28),m=i(1),l=7,d=function e(){n(this,e),this.posStream=[];for(var t=0;t<l;t++)this.posStream.push(new a.Point3d);this.speedX=0,this.speedY=0,this.speedZ=0,this.color=null,this.timeToLive=0,this.fadeStep=0,this.gravity=!1,this.gridBound=!1,this.drag=0,this.hitGrid=!1,this.glowPass=!1};t.particle=function(){function e(){n(this,e);var t=this;t.mNumParticles=1e3,t.mParticles=[];for(var i=0;i<t.mNumParticles;i++)t.mParticles.push(new d);if(t.mParticles)for(var r=0;r<t.mNumParticles;r++)t.mParticles[r].timeToLive=0}return r(e,[{key:"emitter",value:function(e,t,i,n,r,o,m,l,d,u,c){for(var f=this,_=0;_<r;_++){var h=new a.Point3d,p=new a.Point3d;h.x=0,h.y=i+(.5*Math.random()-.25),h.z=0;var y=new s.matrix;y.Identity(),y.Rotate(0,0,t.y+(Math.random()*n-n/2)),y.TransformVertex(h,p),f.assignParticle(e,p.x,p.y,p.z,m,o,l,d,u,c)}}},{key:"assignParticle",value:function(e,t,i,n,r,o,s,m,d,u){var c=this,f=null,_=void 0;if(c.mParticles)for(_=0;_<c.mNumParticles;_++)if(c.mParticles[_].timeToLive<=0){f=c.mParticles[_];break}if(!f){var h=32e4,p=0;for(_=0;_<c.mNumParticles;_++)c.mParticles[_].timeToLive<=h&&(p=_,h=c.mParticles[_].timeToLive);f=c.mParticles[p]}if(f){for(var y=new a.Point3d(e.x,e.y,e.z),E=0;E<l;E++)f.posStream[E]=new a.Point3d(y.x,y.y,y.z);f.speedX=t,f.speedY=i,f.speedZ=n,f.color=o,f.timeToLive=r*Math.random(),f.fadeStep=1/f.timeToLive,f.gravity=s,f.gridBound=m,f.drag=d,f.glowPass=u,f.hitGrid=!1}}},{key:"draw",value:function(){var e=this;if(e.mParticles){(0,o.glBegin)(o.GL_LINES);for(var t=0;t<e.mNumParticles;t++)if(e.mParticles[t].timeToLive>0){var i=e.mParticles[t],n=i.color.a,r=(0,m.calculate2dDistance)(new a.Point3d(0,0,0),new a.Point3d(i.speedX,i.speedY,i.speedZ));n*=.8*r,(0,o.glColor4f)(i.color.r,i.color.g,i.color.b,n);for(var s=0;s<l-1;s++){var d=new a.Point3d(i.posStream[s].x,i.posStream[s].y,i.posStream[s].z),u=new a.Point3d(i.posStream[s+1].x,i.posStream[s+1].y,i.posStream[s+1].z);i.color;(0,o.glVertex3d)(d.x,d.y,0),(0,o.glVertex3d)(u.x,u.y,0)}}(0,o.glEnd)()}}},{key:"run",value:function(){var e=this,t=void 0;if(e.mParticles)for(t=0;t<e.mNumParticles;t++){var i=e.mParticles[t];if(i.timeToLive>0)if(--i.timeToLive<=0)i.timeToLive=0;else{new a.Point3d(i.posStream[0].x,i.posStream[0].y,i.posStream[0].z);i.speedX*=i.drag,i.speedY*=i.drag,i.posStream[0].x+=i.speedX,i.posStream[0].y+=i.speedY,i.posStream[0].z=0;for(var n=l-2;n>=0;n--)i.posStream[n+1]=new a.Point3d(i.posStream[n].x,i.posStream[n].y,i.posStream[n].z)}}}},{key:"killAll",value:function(){var e=this;if(e.mParticles)for(var t=0;t<e.mNumParticles;t++)e.mParticles[t].timeToLive=0}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.players=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(2),a=i(26),s=(i(27),i(1)),m=i(14);t.players=function(){function e(t,i){n(this,e),this.mPlayer1=new a.entityPlayer1(t,i),this.mPlayer1.setState(o.ENTITY_STATE_INACTIVE),this.mNumPlayers=1,this.mGrid=i}return r(e,[{key:"setEnemies",value:function(e){this.mEnemies=e}},{key:"run",value:function(){var e=this,t=this.mPlayer1;switch(t.runMissiles(),t.getState()){case o.ENTITY_STATE_INACTIVE||o.ENTITY_STATE_SPAWN_TRANSITION:t.spawnTransition();break;case o.ENTITY_STATE_SPAWNING:t.spawn();break;case o.ENTITY_STATE_RUN_TRANSITION:t.runTransition();break;case o.ENTITY_STATE_RUNNING:t.run();var i=e.mEnemies.hitTestEnemiesAtPosition(t.getPos(),.75*t.getRadius());if(i)if(i=i.getParent(),t.shields())i.hit(t);else if(t.setState(o.ENTITY_STATE_DESTROY_TRANSITION),i.setState(o.ENTITY_STATE_INDICATE_TRANSITION),i.incGenId(),1==e.mNumPlayers||2==e.mNumPlayers&&e.m2PlayerNumLives<=1)for(var n=0;n<m.NUM_ENEMIES;n++)e.mEnemies.mEnemies[n].getState()!==o.ENTITY_STATE_INACTIVE&&e.mEnemies.mEnemies[n].getState()!==o.ENTITY_STATE_INDICATING&&e.mEnemies.mEnemies[n].getState()!==o.ENTITY_STATE_INDICATE_TRANSITION&&(e.mEnemies.mEnemies[n].hit(null),e.mEnemies.mEnemies[n].incGenId());break;case o.ENTITY_STATE_DESTROY_TRANSITION:t.destroyTransition();break;case o.ENTITY_STATE_DESTROYED:t.destroy()}}},{key:"draw",value:function(){this.mPlayer1.draw()}},{key:"getPlayerClosestToPosition",value:function(){var e=this;if(1==e.mNumPlayers)return e.mPlayer1;if(e.mPlayer1.getEnabled()&&e.mPlayer2.getEnabled()){return(0,s.calculate2dDistance)(point,e.mPlayers.mPlayer1.getPos())<(0,s.calculate2dDistance)(point,e.mPlayers.mPlayer2.getPos())?mPlayer1:mPlayer2}return e.mPlayer2.getEnabled()?e.mPlayer2:e.mPlayer1}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.spawner=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(2),a=i(1),s=i(0),m=i(15),l=200,d=1,u=2,c=function e(){n(this,e),this.e=null,this.genId=-1};t.spawner=function(){function e(t,i,r){n(this,e),this.mNumPlayers=1,this.mPlayers=t,this.mEnemies=i,this.mGrid=r,this.mWaveList=[];for(var o=0;o<l;o++)this.mWaveList.push(new c);this.clearWaveListEntities()}return r(e,[{key:"init",value:function(){this.mSpawnIndex=0,this.mLastSpawnIndex=0,this.mSpawnCheckTimer=100,this.mWaveIntervalTimer=0,this.mWaveStartTimer=0,this.mWaveEntityCounter=0,this.mWaveEntity=o.ENTITY_TYPE_UNDEF,this.mWaveType=d,this.clearWaveListEntities(),this.transition()}},{key:"getSpawnIndex",value:function(){return Math.floor(this.mSpawnIndex)}},{key:"run",value:function(){var e=this;e.mSpawnIndex+=.002,e.mSpawnIndex>15&&(e.mSpawnIndex=15),e.getSpawnIndex()>e.mLastSpawnIndex&&(e.mLastSpawnIndex=e.getSpawnIndex(),e.transition()),0==e.mLevel&&mSpawnIndex>1&&(mSpawnIndex=1);var t=0;if(e.mPlayers.mPlayer1.getState()===o.ENTITY_STATE_INACTIVE?(0,e.mPlayers.mPlayer1.getNumLives()>0?(e.mPlayers.mPlayer1.takeLife(),e.mPlayers.mPlayer1.getNumLives()>0?e.mPlayers.mPlayer1.setState(o.ENTITY_STATE_SPAWN_TRANSITION):e.mGameMode=m.GAMEMODE_GAMEOVER_TRANSITION):e.mGameMode=m.GAMEMODE_GAMEOVER_TRANSITION):++t,t==e.mNumPlayers){var i=e.getSpawnIndex();++e.mSpawnCheckTimer>100&&(e.mSpawnCheckTimer=0,i<=1?e.spawnEntities(o.ENTITY_TYPE_WANDERER,2):i>1&&i<3&&e.spawnEntities(o.ENTITY_TYPE_WANDERER,4),i<=1?e.spawnEntities(o.ENTITY_TYPE_GRUNT,2):i>1&&e.spawnEntities(o.ENTITY_TYPE_GRUNT,4),i>=1&&e.spawnEntities(o.ENTITY_TYPE_SPINNER,2),i>=1&&e.spawnEntities(o.ENTITY_TYPE_WEAVER,2)),e.runWaveListEntities();if(e.numWaveListEntities()<=0&&i>=2&&(--e.mWaveStartTimer,e.mWaveStartTimer<0&&(e.mWaveStartTimer=0),0==e.mWaveStartTimer&&e.mWaveEntity===o.ENTITY_TYPE_UNDEF))switch(e.mWaveStartTimer=100,parseInt(16*Math.random()),10){default:case 0:case 1:case 11:e.mWaveEntity=o.ENTITY_TYPE_GRUNT,e.mWaveType=d,e.mWaveEntityCounter=i>=10?60:40;break;case 2:case 12:e.mWaveEntity=o.ENTITY_TYPE_WEAVER,e.mWaveType=d,e.mWaveEntityCounter=i>=10?24:12;break;case 3:case 13:e.mWaveEntity=o.ENTITY_TYPE_SNAKE,e.mWaveType=d,e.mWaveEntityCounter=i>=10?16:8;break;case 4:case 14:e.mWaveEntity=o.ENTITY_TYPE_SPINNER,e.mWaveType=d,e.mWaveEntityCounter=i>=10?16:8;break;case 10:case 15:e.mWaveEntity=o.ENTITY_TYPE_BLACKHOLE,e.mWaveType=d,e.mWaveEntityCounter=4*Math.random();break;case 5:e.mWaveEntity=o.ENTITY_TYPE_GRUNT,e.mWaveType=u,e.mWaveEntityCounter=8;break;case 6:e.mWaveEntity=o.ENTITY_TYPE_WEAVER,e.mWaveType=u,e.mWaveEntityCounter=8;break;case 7:e.mWaveEntity=o.ENTITY_TYPE_SNAKE,e.mWaveType=u,e.mWaveEntityCounter=i>=10?8:4;break;case 8:e.mWaveEntity=o.ENTITY_TYPE_SPINNER,e.mWaveType=u,e.mWaveEntityCounter=i>=10?8:4;break;case 9:i>=8&&(e.mWaveEntity=o.ENTITY_TYPE_MAYFLY,e.mWaveType=d,e.mWaveEntityCounter=50)}e.mWaveEntity!==o.ENTITY_TYPE_UNDEF&&++e.mWaveIntervalTimer>10&&(e.mWaveIntervalTimer=0,e.runWaves())}else e.mSpawnCheckTimer=0}},{key:"transition",value:function(){}},{key:"spawnEntities",value:function(e,t){var i=this,n=15,r=n,m=n,l=i.mGrid.extentX()-1-n,d=i.mGrid.extentY()-1-n;if(i.mEnemies.getNumActiveEnemiesOfType(e)<t){var u=i.mEnemies.getUnusedEnemyOfType(e);if(u){var c=Math.random()*(l-r)+r,f=Math.random()*(d-m)+m,_=new s.Point3d(c,f,0);u.setPos(_),(0,a.calculate2dDistance)(_,i.mPlayers.mPlayer1.getPos()),u.setState(o.ENTITY_STATE_SPAWN_TRANSITION)}}}},{key:"runWaves",value:function(){var e=this;if(e.mWaveEntity!==o.ENTITY_TYPE_UNDEF){var t=2;e.mGrid.extentX(),e.mGrid.extentY();if(e.mWaveType==u);else for(var i=0,n=0;n<4;n++){if(e.mWaveEntityCounter>0){var r=e.mEnemies.getUnusedEnemyOfType(e.mWaveEntity);if(r){e.addToWaveList(r);var a=(Math.random(),Math.random(),new s.Point3d);a.x=50,a.y=50;var m=r.getRadius();e.mWaveEntity==o.ENTITY_TYPE_BLACKHOLE&&(m=20);var l=m,d=m,c=e.mGrid.extentX()-m-1,f=e.mGrid.extentY()-m-1;a.x<l?a.x=l:a.x>c&&(a.x=c),a.y<d?a.y=d:a.y>f&&(a.y=f);var _=new s.Point3d;e.mGrid.hitTest(a,1,_)&&(a=_),r.setPos(a),r.setState(o.ENTITY_STATE_SPAWN_TRANSITION)}--e.mWaveEntityCounter,e.mWaveEntityCounter<=0&&(e.mWaveEntity=o.ENTITY_TYPE_UNDEF)}++i}}}},{key:"addToWaveList",value:function(e){for(var t=this,i=0;i<l;i++)if(null==t.mWaveList[i].e)return t.mWaveList[i].e=e,void(t.mWaveList[i].genId=e.getGenId())}},{key:"numWaveListEntities",value:function(){for(var e=this,t=0,i=0;i<l;i++)e.mWaveList[i].e&&e.mWaveList[i].e.getGenId()==e.mWaveList[i].genId&&++t;return t}},{key:"runWaveListEntities",value:function(){for(var e=this,t=0;t<l;t++)e.mWaveList[t].e&&e.mWaveList[t].e.getGenId()!=e.mWaveList[t].genId&&(e.mWaveList[t].e=null,e.mWaveList[t].genId=-1)}},{key:"clearWaveListEntities",value:function(){for(var e=this,t=0;t<l;t++)e.mWaveList[t].e=null,e.mWaveList[t].genId=-1}}]),e}()},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.stars=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(5),a=i(1),s=i(0),m=i(15),l=8e3,d=function e(){n(this,e),this.pos=new s.Point3d(0,0,0),this.radius=0};t.stars=function(){function e(t){n(this,e);var i=this;this.mGrid=t;var r=700,o=0-r,s=0-r,m=this.mGrid.extentX()+r,u=this.mGrid.extentY()+r;i.mStars=[];for(var c=0;c<l;c++)i.mStars.push(new d);for(var f=0;f<l;f++){var _=void 0;_=f<2e3?-20:f<4e3?-40:f<6e3?-60:-80,i.mStars[f].pos.x=(0,a.randFromTo)(o,m),i.mStars[f].pos.y=(0,a.randFromTo)(s,u),i.mStars[f].pos.z=_,i.mStars[f].radius=.5*(0,a.frandFrom0To1)()+.25}}return r(e,[{key:"run",value:function(){}},{key:"draw",value:function(){var e=this,t=2*(e.mGrid.brightness()-.5);if(t>1&&(t=1),e.mGameMode!=m.GAMEMODE_ATTRACT&&e.mGameMode!=m.GAMEMODE_CREDITED||(t=1),!(t<=0)){(0,o.glPointSize)(1),(0,o.glBegin)(o.GL_POINTS);for(var i=0;i<l;i++)(0,o.glColor4f)(1,1,1,(e.mStars[i].radius+.5)*t),(0,o.glVertex3d)(e.mStars[i].pos.x,e.mStars[i].pos.y,e.mStars[i].pos.z);(0,o.glEnd)()}}}]),e}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gw_release=t.gw_render=t.gw_update=t.gw_init=void 0;var n=i(16),r=new n.scene;t.gw_init=function(){r.init()},t.gw_update=function(){r.run()},t.gw_render=function(){r.draw(n.RENDERPASS_PRIMARY)},t.gw_release=function(){}},function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var r;(0,i(30).engine_init)((r={Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null},n(r,"Xlevel","data/levels/blue_ocean_3.json"),n(r,"Xquest",null),n(r,"Xquest","data/quests/tutorial.json"),n(r,"Xlanguage",null),n(r,"Xlanguage","data/languages/italiano.json"),r))}]);